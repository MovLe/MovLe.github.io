<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Movle</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="https://img-blog.csdnimg.cn/20200609161448519.jpg" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="https://img-blog.csdnimg.cn/2020060916514052.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Movle</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['种一棵树，最好的时机是十年前，其次是现在', '人必有痴，而后有成', '今天，我没有浑浑噩噩的度过'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-ffmpeg音视频加速"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/22/ffmpeg%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F/"
    >ffmpeg音视频加速</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/22/ffmpeg%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F/" class="article-date">
  <time datetime="2020-01-22T03:55:00.000Z" itemprop="datePublished">2020-01-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/ffmpeg/">ffmpeg</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-变速视频原理"><a href="#1-变速视频原理" class="headerlink" title="1.变速视频原理"></a>1.变速视频原理</h4><p>修改视频的pts，dts</p>
<h4 id="2-修改视频速率"><a href="#2-修改视频速率" class="headerlink" title="2.修改视频速率"></a>2.修改视频速率</h4><p>视频变为2倍速</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -an -filter:v &quot;setpts=0.5*PTS&quot; output.mp4</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li>调整速度倍率范围[0.25, 4]</li>
<li>如果只调整视频的话最好把音频禁掉</li>
<li>对视频进行加速时，如果不想丢帧，可以用-r 参数指定输出视频FPS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -an -r 60 -filter:v &quot;setpts=2.0*PTS&quot; output.mp4</span><br></pre></td></tr></table></figure>

<h4 id="3-变速音频原理"><a href="#3-变速音频原理" class="headerlink" title="3.变速音频原理"></a>3.变速音频原理</h4><p>简单的方法是调整音频采样率，但是这种方法会改变音色，一般采用通过对原音进行冲采样，差值等方法</p>
<h4 id="4-修改音频速率"><a href="#4-修改音频速率" class="headerlink" title="4.修改音频速率"></a>4.修改音频速率</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -filter:a &quot;atempo=2.0&quot; -vn output.mp4</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>倍率调整范围为[0.5, 2.0]</li>
<li>如果需要调整4倍可采用以下方法：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -filter:a &quot;atempo=2.0,atempo=2.0&quot; -vn output.mp4</span><br></pre></td></tr></table></figure>

<h4 id="5-音频视频同时变速"><a href="#5-音频视频同时变速" class="headerlink" title="5.音频视频同时变速"></a>5.音频视频同时变速</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -filter_complex &quot;[0:v]setpts=0.5*PTS[v];[0:a]atempo=2.0[a]&quot; -map &quot;[v]&quot; -map &quot;[a]&quot; output.mp4</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ffmpeg/" rel="tag">ffmpeg</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-ElasticSearch实战-使用java连接elasticsearch集群并操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/ElasticSearch%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8java%E8%BF%9E%E6%8E%A5elasticsearch%E9%9B%86%E7%BE%A4%E5%B9%B6%E6%93%8D%E4%BD%9C/"
    >ElasticSearch实战-使用java连接elasticsearch集群并操作</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/ElasticSearch%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8java%E8%BF%9E%E6%8E%A5elasticsearch%E9%9B%86%E7%BE%A4%E5%B9%B6%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2020-01-12T07:00:00.000Z" itemprop="datePublished">2020-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-需求："><a href="#1-需求：" class="headerlink" title="1.需求："></a>1.需求：</h4><p>使用java连接elasticsearch集群，并进行相关操作</p>
<h4 id="2-代码："><a href="#2-代码：" class="headerlink" title="2.代码："></a>2.代码：</h4><h5 id="1-pom-xml"><a href="#1-pom-xml" class="headerlink" title="(1)pom.xml"></a>(1)pom.xml</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">4.10</span>&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">5.6</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;transport&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">5.6</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">2.9</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-ES-test-java"><a href="#2-ES-test-java" class="headerlink" title="(2)ES_test.java"></a>(2)ES_test.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.MultiGetItemResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.MultiGetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.Requests;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentFactory;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.transport.client.PreBuiltTransportClient;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ES_test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TransportClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getClient</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 设置连接的集群名称</span></span><br><span class="line">        Settings settings = Settings.builder().put(<span class="string">&quot;cluster.name&quot;</span>, <span class="string">&quot;my-application&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 连接集群</span></span><br><span class="line">        client = <span class="keyword">new</span> PreBuiltTransportClient(settings);</span><br><span class="line">        client.addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(<span class="string">&quot;192.168.1.121&quot;</span>), <span class="number">9300</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 打印集群名称</span></span><br><span class="line">         <span class="comment">//System.out.println(client.toString());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndex_blog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建索引</span></span><br><span class="line"></span><br><span class="line">        client.admin().indices().prepareCreate(<span class="string">&quot;blog&quot;</span>).get();</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 删除索引</span></span><br><span class="line">        client.admin().indices().prepareDelete(<span class="string">&quot;blog&quot;</span>).get();</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertByJson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用json常见document</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、文档数据准备</span></span><br><span class="line">        String json = <span class="string">&quot;&#123;&quot;</span> + <span class="string">&quot;\&quot;id\&quot;:\&quot;1\&quot;,&quot;</span> + <span class="string">&quot;\&quot;title\&quot;:\&quot;基于Lucene的搜索服务器\&quot;,&quot;</span></span><br><span class="line">                + <span class="string">&quot;\&quot;content\&quot;:\&quot;它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口\&quot;&quot;</span> + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 在es中创建文档</span></span><br><span class="line">        IndexResponse indexResponse = client.prepareIndex(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;1&quot;</span>).setSource(json).execute().actionGet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 打印返回结果</span></span><br><span class="line">        System.out.println(<span class="string">&quot;index: &quot;</span> + indexResponse.getIndex());</span><br><span class="line">        System.out.println(<span class="string">&quot;type: &quot;</span> + indexResponse.getType());</span><br><span class="line">        System.out.println(<span class="string">&quot;id: &quot;</span> + indexResponse.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;result: &quot;</span> + indexResponse.getResult());</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertByMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用Map创建document</span></span><br><span class="line">        <span class="comment">// 1、文档数据准备</span></span><br><span class="line">        Map&lt;String, Object&gt; json = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        json.put(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">        json.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;基于Lucene的搜索服务器&quot;</span>);</span><br><span class="line">        json.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建文档</span></span><br><span class="line">        IndexResponse indexResponse = client.prepareIndex(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;2&quot;</span>).setSource(json).execute().actionGet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 打印返回结果</span></span><br><span class="line">        System.out.println(<span class="string">&quot;index: &quot;</span> + indexResponse.getIndex());</span><br><span class="line">        System.out.println(<span class="string">&quot;type: &quot;</span> + indexResponse.getType());</span><br><span class="line">        System.out.println(<span class="string">&quot;id: &quot;</span> + indexResponse.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;result: &quot;</span> + indexResponse.getResult());</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertByXContent</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// 使用XContentBuilder创建document</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 通过es自带的帮助类，构建json数据</span></span><br><span class="line">        XContentBuilder builder = XContentFactory.jsonBuilder().startObject().field(<span class="string">&quot;id&quot;</span>, <span class="number">5</span>)</span><br><span class="line">                .field(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;基于Lucene的搜索服务器&quot;</span>).field(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;sdfs它sdfsdfsdf提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。&quot;</span>)</span><br><span class="line">                .endObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建文档</span></span><br><span class="line">        IndexResponse indexResponse = client.prepareIndex(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;3&quot;</span>).setSource(builder).get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 打印返回结果</span></span><br><span class="line">        System.out.println(<span class="string">&quot;index: &quot;</span> + indexResponse.getIndex());</span><br><span class="line">        System.out.println(<span class="string">&quot;type: &quot;</span> + indexResponse.getType());</span><br><span class="line">        System.out.println(<span class="string">&quot;id: &quot;</span> + indexResponse.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;result: &quot;</span> + indexResponse.getResult());</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查询文档</span></span><br><span class="line">        GetResponse response = client.prepareGet(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;1&quot;</span>).get();</span><br><span class="line"></span><br><span class="line">        System.out.println(response.getSourceAsString());</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMultiData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查询多个文档</span></span><br><span class="line"></span><br><span class="line">        MultiGetResponse response = client.prepareMultiGet()</span><br><span class="line">                .add(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .add(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">                .add(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;2&quot;</span>).get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (MultiGetItemResponse multiGetItemResponse : response) &#123;</span><br><span class="line">            GetResponse getResponse = multiGetItemResponse.getResponse();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取查询结果</span></span><br><span class="line">            <span class="keyword">if</span> (getResponse.isExists()) &#123;</span><br><span class="line">                String sourceAsString = getResponse.getSourceAsString();</span><br><span class="line">                System.out.println(sourceAsString);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateData</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1 创建更新数据的请求对象</span></span><br><span class="line">		UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest();</span><br><span class="line">		updateRequest.index(<span class="string">&quot;blog&quot;</span>);</span><br><span class="line">		updateRequest.type(<span class="string">&quot;article&quot;</span>);</span><br><span class="line">		updateRequest.id(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">		updateRequest.doc(XContentFactory.jsonBuilder().startObject()</span><br><span class="line">				<span class="comment">// 对没有的字段添加, 对已有的字段替换</span></span><br><span class="line">				.field(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;基于Lucene的搜索服务器&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。大数据前景无限&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;createDate&quot;</span>, <span class="string">&quot;2017-8-22&quot;</span>)</span><br><span class="line">				.endObject());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 获取更新后的值</span></span><br><span class="line">		UpdateResponse indexResponse = client.update(updateRequest).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 打印返回的结果</span></span><br><span class="line">		System.out.println(<span class="string">&quot;index:&quot;</span> + indexResponse.getIndex());</span><br><span class="line">		System.out.println(<span class="string">&quot;type:&quot;</span> + indexResponse.getType());</span><br><span class="line">		System.out.println(<span class="string">&quot;id:&quot;</span> + indexResponse.getId());</span><br><span class="line">		System.out.println(<span class="string">&quot;version:&quot;</span> + indexResponse.getVersion());</span><br><span class="line">		System.out.println(<span class="string">&quot;create:&quot;</span> + indexResponse.getResult());<span class="comment">// NOOP = NO</span></span><br><span class="line">																	<span class="comment">// OPeration</span></span><br><span class="line">																	<span class="comment">// ;</span></span><br><span class="line">																	<span class="comment">// result=updated</span></span><br><span class="line">																	<span class="comment">// 表示更新成功</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 4 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置查询条件, 查找不到则添加</span></span><br><span class="line">		IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line">				.source(XContentFactory.jsonBuilder().startObject().field(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;搜索服务器&quot;</span>)</span><br><span class="line">						.field(<span class="string">&quot;content&quot;</span>,</span><br><span class="line">								<span class="string">&quot;它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。&quot;</span>)</span><br><span class="line">				.endObject());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置更新, 查找到更新下面的设置</span></span><br><span class="line">		UpdateRequest upsert = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line">				.doc(XContentFactory.jsonBuilder().startObject().field(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;李四&quot;</span>).endObject()).upsert(indexRequest);</span><br><span class="line"></span><br><span class="line">		client.update(upsert).get();</span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1 删除文档数据</span></span><br><span class="line">		DeleteResponse indexResponse = client.prepareDelete(<span class="string">&quot;blog&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;5&quot;</span>).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 打印返回的结果</span></span><br><span class="line">		System.out.println(<span class="string">&quot;index:&quot;</span> + indexResponse.getIndex());</span><br><span class="line">		System.out.println(<span class="string">&quot;type:&quot;</span> + indexResponse.getType());</span><br><span class="line">		System.out.println(<span class="string">&quot;id:&quot;</span> + indexResponse.getId());</span><br><span class="line">		System.out.println(<span class="string">&quot;version:&quot;</span> + indexResponse.getVersion());</span><br><span class="line">		System.out.println(<span class="string">&quot;found:&quot;</span> + indexResponse.getResult());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">matchAllQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 查询所有</span></span><br><span class="line">		<span class="comment">// 1 执行查询</span></span><br><span class="line">		SearchResponse searchResponse = client.prepareSearch(<span class="string">&quot;blog&quot;</span>).setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.setQuery(QueryBuilders.matchAllQuery()).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 打印查询结果</span></span><br><span class="line">		SearchHits hits = searchResponse.getHits(); <span class="comment">// 获取命中次数，查询结果有多少对象</span></span><br><span class="line">		System.out.println(<span class="string">&quot;查询结果有：&quot;</span> + hits.getTotalHits() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">			System.out.println(hit.getSourceAsString());<span class="comment">// 打印出每条结果</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 1 条件查询</span></span><br><span class="line">		SearchResponse searchResponse = client.prepareSearch(<span class="string">&quot;blog&quot;</span>).setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.setQuery(QueryBuilders.queryStringQuery(<span class="string">&quot;大数据&quot;</span>)).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 打印查询结果</span></span><br><span class="line">		SearchHits hits = searchResponse.getHits(); <span class="comment">// 获取命中次数，查询结果有多少对象</span></span><br><span class="line">		System.out.println(<span class="string">&quot;查询结果有：&quot;</span> + hits.getTotalHits() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">			System.out.println(hit.getSourceAsString());<span class="comment">// 打印出每条结果</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wildcardQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1 通配符查询</span></span><br><span class="line">		SearchResponse searchResponse = client.prepareSearch(<span class="string">&quot;blog&quot;</span>).setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.setQuery(QueryBuilders.wildcardQuery(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;*全*&quot;</span>)).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 打印查询结果</span></span><br><span class="line">		SearchHits hits = searchResponse.getHits(); <span class="comment">// 获取命中次数，查询结果有多少对象</span></span><br><span class="line">		System.out.println(<span class="string">&quot;查询结果有：&quot;</span> + hits.getTotalHits() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">			System.out.println(hit.getSourceAsString());<span class="comment">// 打印出每条结果</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">termQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 类似于 mysql 中 = </span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1 第一field查询</span></span><br><span class="line">		SearchResponse searchResponse = client.prepareSearch(<span class="string">&quot;blog&quot;</span>).setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.setQuery(QueryBuilders.termQuery(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;全文&quot;</span>)).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 打印查询结果</span></span><br><span class="line">		SearchHits hits = searchResponse.getHits(); <span class="comment">// 获取命中次数，查询结果有多少对象</span></span><br><span class="line">		System.out.println(<span class="string">&quot;查询结果有：&quot;</span> + hits.getTotalHits() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">			System.out.println(hit.getSourceAsString());<span class="comment">// 打印出每条结果</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1 模糊查询</span></span><br><span class="line">		SearchResponse searchResponse = client.prepareSearch(<span class="string">&quot;blog&quot;</span>).setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.setQuery(QueryBuilders.fuzzyQuery(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;lucene&quot;</span>)).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 打印查询结果</span></span><br><span class="line">		SearchHits hits = searchResponse.getHits(); <span class="comment">// 获取命中次数，查询结果有多少对象</span></span><br><span class="line">		System.out.println(<span class="string">&quot;查询结果有：&quot;</span> + hits.getTotalHits() + <span class="string">&quot;条&quot;</span>);</span><br><span class="line"></span><br><span class="line">		Iterator&lt;SearchHit&gt; iterator = hits.iterator();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">			SearchHit searchHit = iterator.next(); <span class="comment">// 每个查询对象</span></span><br><span class="line"></span><br><span class="line">			System.out.println(searchHit.getSourceAsString()); <span class="comment">// 获取字符串格式打印</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭连接</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createMapping</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1设置mapping</span></span><br><span class="line">		XContentBuilder builder = XContentFactory.jsonBuilder().startObject().startObject(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">				.startObject(<span class="string">&quot;id1&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;true&quot;</span>).endObject()</span><br><span class="line">				.startObject(<span class="string">&quot;title2&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;false&quot;</span>).endObject()</span><br><span class="line">				.startObject(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;true&quot;</span>).endObject()</span><br><span class="line">				.endObject().endObject().endObject();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 添加mapping</span></span><br><span class="line">		PutMappingRequest mapping = Requests.putMappingRequest(<span class="string">&quot;blog4&quot;</span>).type(<span class="string">&quot;article&quot;</span>).source(builder);</span><br><span class="line"></span><br><span class="line">		client.admin().indices().putMapping(mapping).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭资源</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建使用ik分词器的mapping</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createMapping_ik</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1设置mapping</span></span><br><span class="line">		XContentBuilder builder = XContentFactory.jsonBuilder().startObject().startObject(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">				.startObject(<span class="string">&quot;id1&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;analyzer&quot;</span>, <span class="string">&quot;ik_smart&quot;</span>)</span><br><span class="line">				.endObject()</span><br><span class="line">				.startObject(<span class="string">&quot;title2&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;false&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>, <span class="string">&quot;ik_smart&quot;</span>).</span><br><span class="line">				endObject().startObject(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">				.field(<span class="string">&quot;analyzer&quot;</span>, <span class="string">&quot;ik_smart&quot;</span>).endObject().endObject()</span><br><span class="line">				.endObject().endObject();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2 添加mapping</span></span><br><span class="line">		PutMappingRequest mapping = Requests.putMappingRequest(<span class="string">&quot;blog4&quot;</span>).type(<span class="string">&quot;article&quot;</span>).source(builder);</span><br><span class="line">		client.admin().indices().putMapping(mapping).get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3 关闭资源</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建文档,以map形式</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createDocumentByMap_forik</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;id1&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">		map.put(<span class="string">&quot;title2&quot;</span>, <span class="string">&quot;Lucene&quot;</span>);</span><br><span class="line">		map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;它提供了一个分布式的web接口&quot;</span>);</span><br><span class="line"></span><br><span class="line">		IndexResponse response = client.prepareIndex(<span class="string">&quot;blog4&quot;</span>, <span class="string">&quot;article&quot;</span>, <span class="string">&quot;3&quot;</span>).setSource(map).execute().actionGet();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 打印返回的结果</span></span><br><span class="line">		System.out.println(<span class="string">&quot;结果:&quot;</span> + response.getResult());</span><br><span class="line">		System.out.println(<span class="string">&quot;id:&quot;</span> + response.getId());</span><br><span class="line">		System.out.println(<span class="string">&quot;index:&quot;</span> + response.getIndex());</span><br><span class="line">		System.out.println(<span class="string">&quot;type:&quot;</span> + response.getType());</span><br><span class="line">		System.out.println(<span class="string">&quot;版本:&quot;</span> + response.getVersion());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 关闭资源</span></span><br><span class="line">		client.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 词条查询</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryTerm_forik</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 分析结果：因为是默认被standard analyzer分词器分词，大写字母全部转为了小写字母，并存入了倒排索引以供搜索。term是确切查询， 必须要匹配到大写的Name。</span></span><br><span class="line">		SearchResponse response = client.prepareSearch(<span class="string">&quot;blog4&quot;</span>)</span><br><span class="line">				.setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">				.setQuery(QueryBuilders.termQuery(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;web&quot;</span>))</span><br><span class="line">				.get();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取查询命中结果</span></span><br><span class="line">		SearchHits hits = response.getHits();</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;结果条数:&quot;</span> + hits.getTotalHits());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">			System.out.println(hit.getSourceAsString());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-结果："><a href="#3-结果：" class="headerlink" title="3.结果："></a>3.结果：</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTNjNjJkNDdkMTk1ODc2OTAucG5n?x-oss-process=image/format,png"></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFjZTEyY2RjODU3NTRiYmEucG5n?x-oss-process=image/format,png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch%E5%AE%9E%E6%88%98/" rel="tag">Elasticsearch实战</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch head插件安装"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/Elasticsearch%20head%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/"
    >Elasticsearch head插件安装</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/Elasticsearch%20head%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/" class="article-date">
  <time datetime="2020-01-12T06:00:00.000Z" itemprop="datePublished">2020-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-下载插件："><a href="#1-下载插件：" class="headerlink" title="1.下载插件："></a>1.下载插件：</h4><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></li>
</ul>
<h4 id="2-下载nodejs："><a href="#2-下载nodejs：" class="headerlink" title="2.下载nodejs："></a>2.下载nodejs：</h4><ul>
<li>nodejs官网下载安装包：<a target="_blank" rel="noopener" href="https://nodejs.org/dist/">https://nodejs.org/dist/</a></li>
<li>node-v6.9.2-linux-x64.tar.xz</li>
</ul>
<h4 id="3-安装nodejs："><a href="#3-安装nodejs：" class="headerlink" title="3.安装nodejs："></a>3.安装nodejs：</h4><h5 id="1-解压"><a href="#1-解压" class="headerlink" title="(1)解压"></a>(1)解压</h5><h5 id="2-配置环境变量"><a href="#2-配置环境变量" class="headerlink" title="(2)配置环境变量"></a>(2)配置环境变量</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export NODE_HOME=/usr/local/node-v6.9.2-linux-x64</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:$NODE_HOME/bin</span><br></pre></td></tr></table></figure>
<h5 id="3-查看node和npm版本："><a href="#3-查看node和npm版本：" class="headerlink" title="(3)查看node和npm版本："></a>(3)查看node和npm版本：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line"></span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<h4 id="4-解压head插件到-opt-module目录下："><a href="#4-解压head插件到-opt-module目录下：" class="headerlink" title="4.解压head插件到/opt/module目录下："></a>4.解压head插件到/opt/module目录下：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-head-master.zip</span><br></pre></td></tr></table></figure>
<h4 id="5-查看当前head插件目录下有无node-modules-grunt目录："><a href="#5-查看当前head插件目录下有无node-modules-grunt目录：" class="headerlink" title="5.查看当前head插件目录下有无node_modules/grunt目录："></a>5.查看当前head插件目录下有无node_modules/grunt目录：</h4><ul>
<li>如果没有，执行命令创建：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install grunt --save --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<h4 id="6-安装head插件："><a href="#6-安装head插件：" class="headerlink" title="6.安装head插件："></a>6.安装head插件：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<h4 id="7-安装grunt"><a href="#7-安装grunt" class="headerlink" title="7.安装grunt"></a>7.安装grunt</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g grunt-cli --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<h4 id="8-编辑Gruntfile-js"><a href="#8-编辑Gruntfile-js" class="headerlink" title="8.编辑Gruntfile.js"></a>8.编辑Gruntfile.js</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim Gruntfile.js</span><br></pre></td></tr></table></figure>
<p>文件93行添加：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname:&#x27;0.0.0.0&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="9-检查head根目录下是否存在base文件夹"><a href="#9-检查head根目录下是否存在base文件夹" class="headerlink" title="9.检查head根目录下是否存在base文件夹"></a>9.检查head根目录下是否存在base文件夹</h4><ul>
<li>没有：将 _site下的base文件夹及其内容复制到head根目录下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir base</span><br><span class="line"></span><br><span class="line">cp base/* ../base/</span><br></pre></td></tr></table></figure>

<h4 id="10-启动grunt-server："><a href="#10-启动grunt-server：" class="headerlink" title="10.启动grunt server："></a>10.启动grunt server：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt server -d</span><br></pre></td></tr></table></figure>
<h4 id="11-如果提示grunt的模块没有安装："><a href="#11-如果提示grunt的模块没有安装：" class="headerlink" title="11.如果提示grunt的模块没有安装："></a>11.如果提示grunt的模块没有安装：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Local Npm module “grunt-contrib-clean” not found. Is it installed? </span><br><span class="line"></span><br><span class="line">Local Npm module “grunt-contrib-concat” not found. Is it installed? </span><br><span class="line"></span><br><span class="line">Local Npm module “grunt-contrib-watch” not found. Is it installed? </span><br><span class="line"></span><br><span class="line">Local Npm module “grunt-contrib-connect” not found. Is it installed? </span><br><span class="line"></span><br><span class="line">Local Npm module “grunt-contrib-copy” not found. Is it installed? </span><br><span class="line"></span><br><span class="line">Local Npm module “grunt-contrib-jasmine” not found. Is it installed? </span><br></pre></td></tr></table></figure>

<p>执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install grunt-contrib-clean -registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm install grunt-contrib-concat -registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm install grunt-contrib-watch -registry=https://registry.npm.taobao.org </span><br><span class="line"></span><br><span class="line">npm install grunt-contrib-connect -registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm install grunt-contrib-copy -registry=https://registry.npm.taobao.org </span><br><span class="line"></span><br><span class="line">npm install grunt-contrib-jasmine -registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>最后一个模块可能安装不成功，但是不影响使用。</strong></li>
</ul>
<h4 id="12-浏览器访问head插件：http-192-168-109-133-9100"><a href="#12-浏览器访问head插件：http-192-168-109-133-9100" class="headerlink" title="12.浏览器访问head插件：http://192.168.109.133:9100"></a>12.浏览器访问head插件：<a target="_blank" rel="noopener" href="http://192.168.109.133:9100/">http://192.168.109.133:9100</a></h4> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" rel="tag">安装部署</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch集群安装部署"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/Elasticsearch%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"
    >Elasticsearch集群安装部署</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/Elasticsearch%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" class="article-date">
  <time datetime="2020-01-12T05:00:00.000Z" itemprop="datePublished">2020-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-前提：安装好jdk"><a href="#1-前提：安装好jdk" class="headerlink" title="1.前提：安装好jdk"></a>1.前提：安装好jdk</h4><h4 id="2-下载安装包："><a href="#2-下载安装包：" class="headerlink" title="2.下载安装包："></a>2.下载安装包：</h4><h4 id="3-上传到linux"><a href="#3-上传到linux" class="headerlink" title="3.上传到linux"></a>3.上传到linux</h4><h4 id="4-解压"><a href="#4-解压" class="headerlink" title="4.解压"></a>4.解压</h4><h4 id="5-新建data，logs文件夹"><a href="#5-新建data，logs文件夹" class="headerlink" title="5.新建data，logs文件夹"></a>5.新建data，logs文件夹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/elasticsearch-5.6.2</span><br><span class="line"></span><br><span class="line">mkdir data</span><br><span class="line"></span><br><span class="line">mkdir logs</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWZkYTg5MmMwNWQ5ZDU1NGMucG5n?x-oss-process=image/format,png" alt="新建目录"></p>
<h4 id="6-修改配置文件-root用户-三台机器都需要改"><a href="#6-修改配置文件-root用户-三台机器都需要改" class="headerlink" title="6.修改配置文件(root用户)三台机器都需要改"></a>6.修改配置文件(root用户)三台机器都需要改</h4><h5 id="1-修改elasticsearch-yml文件"><a href="#1-修改elasticsearch-yml文件" class="headerlink" title="(1).修改elasticsearch.yml文件"></a>(1).修改elasticsearch.yml文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/module/elasticsearch-5.6.2/conf/elasticsearch.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>修改内容如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------- Cluster -------------------------------------</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">my-application</span></span><br><span class="line"><span class="comment"># ------------------------------------ Node --------------------------------------</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">JBS1</span></span><br><span class="line"><span class="comment"># ----------------------------------- Paths ---------------------------------------</span></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/opt/module/elasticsearch-5.6.2/data</span></span><br><span class="line"><span class="attr">path.logs:</span> <span class="string">/opt/module/elasticsearch-5.6.2/logs</span></span><br><span class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">bootstrap.system_call_filter:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># ---------------------------------- Network ------------------------------------</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">192.168</span><span class="number">.127</span><span class="number">.121</span> </span><br><span class="line"><span class="comment"># --------------------------------- Discovery ------------------------------------</span></span><br><span class="line"><span class="attr">discovery.zen.ping.unicast.hosts:</span> [<span class="string">&quot;bigdata121&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>cluster.name ：如果要配置集群需要两个节点上的 elasticsearch 配置的 cluster.name 相同，都启动可以自动组成集群，这里如果不改 cluster.name 则默认是 cluster.name=my-application。</li>
<li>nodename 随意取但是集群内的各节点不能相同</li>
<li>node.master:设置为主节点</li>
<li>node.data:</li>
</ul>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWY3YWY5MjZjYWZjZDg2MjUucG5n?x-oss-process=image/format,png" alt="elasticsearch.yml"></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU1YjUyMjRkNDM4NGQyZGYucG5n?x-oss-process=image/format,png" alt="elasticsearch.yml"></p>
<h5 id="2-修改limits-conf文件"><a href="#2-修改limits-conf文件" class="headerlink" title="(2).修改limits.conf文件"></a>(2).修改limits.conf文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">//在文件末尾添加如下内容</span><br><span class="line"></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 4096</span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTlhY2YyNmRhOGYxMWZhODkucG5n?x-oss-process=image/format,png" alt="limits.conf"></p>
<h5 id="3-修改limits-d文件"><a href="#3-修改limits-d文件" class="headerlink" title="(3).修改limits.d文件"></a>(3).修改limits.d文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line"></span><br><span class="line">//修改内容如下</span><br><span class="line">//*    soft    nproc    1024</span><br><span class="line">//改为</span><br><span class="line">*    soft    nproc    4096</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTU5NDg4ZjE3MWYxMjYyYTAucG5n?x-oss-process=image/format,png" alt="20-nproc.conf"></p>
<h5 id="4-修改配置sysctl-conf"><a href="#4-修改配置sysctl-conf" class="headerlink" title="(4).修改配置sysctl.conf"></a>(4).修改配置sysctl.conf</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">//添加内容</span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTExODZkOGZjODM3ZTY0NmYucG5n?x-oss-process=image/format,png" alt="sysctl.conf"></p>
<h4 id="5-新建linux用户-es不能以root用户启动"><a href="#5-新建linux用户-es不能以root用户启动" class="headerlink" title="5.新建linux用户:es不能以root用户启动"></a>5.新建linux用户:es不能以root用户启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">useradd kai</span><br><span class="line"></span><br><span class="line">passwd kai</span><br><span class="line">输入密码</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /opt/module/elasticsearch-5.6.2       //进入的elasticsearch目录</span><br><span class="line"></span><br><span class="line">chown -R kai:users *      //修改权限</span><br><span class="line"></span><br><span class="line">su kai        //切换到kai用户，启动es</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTU4ZDI1NjVmM2Q1OTMyNzEucG5n?x-oss-process=image/format,png" alt="新建用户"></p>
<h4 id="6-将elasticsearch发送到bigdata122，bigdata123"><a href="#6-将elasticsearch发送到bigdata122，bigdata123" class="headerlink" title="6.将elasticsearch发送到bigdata122，bigdata123"></a>6.将elasticsearch发送到bigdata122，bigdata123</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module</span><br><span class="line">scp -r elasticsearch-5.6.2/ bigdata122:/opt/module</span><br><span class="line"></span><br><span class="line">scp -r elasticsearch-5.6.2/ bigdata123:/opt/module</span><br></pre></td></tr></table></figure>

<h4 id="7-再在bigdata122，bigdata123中修改elasticsearch-yml"><a href="#7-再在bigdata122，bigdata123中修改elasticsearch-yml" class="headerlink" title="7.再在bigdata122，bigdata123中修改elasticsearch.yml"></a>7.再在bigdata122，bigdata123中修改elasticsearch.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ------------------------------------ Node --------------------------------------</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">JBS2</span></span><br><span class="line"><span class="comment"># ---------------------------------- Network ------------------------------------</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">192.168</span><span class="number">.127</span><span class="number">.122</span>     <span class="string">//bigdata123改为：192.168.127.123</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>其实和单节点安装差不多，只是elasticsearch.yml文件有细微不同</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWRkMWY4MGMyOGEzMTBiNjcucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTIzYjJkNjkxOGQ5MGUxYWYucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h4 id="8-再在bigdata122，bigdata123中修改linux配置文件，和bigdata121一样，以及新建用户"><a href="#8-再在bigdata122，bigdata123中修改linux配置文件，和bigdata121一样，以及新建用户" class="headerlink" title="8.再在bigdata122，bigdata123中修改linux配置文件，和bigdata121一样，以及新建用户"></a>8.再在bigdata122，bigdata123中修改linux配置文件，和bigdata121一样，以及新建用户</h4><h4 id="9-重启bigdata121-bigdata122-bigdata123-因为修改linux配置文件后需要重启后才生效"><a href="#9-重启bigdata121-bigdata122-bigdata123-因为修改linux配置文件后需要重启后才生效" class="headerlink" title="9.重启bigdata121,bigdata122,bigdata123,因为修改linux配置文件后需要重启后才生效"></a>9.重启bigdata121,bigdata122,bigdata123,因为修改linux配置文件后需要重启后才生效</h4><h4 id="10-启动ES集群："><a href="#10-启动ES集群：" class="headerlink" title="10.启动ES集群："></a>10.启动ES集群：</h4><h5 id="1-切换用户："><a href="#1-切换用户：" class="headerlink" title="(1)切换用户："></a>(1)切换用户：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su kai</span><br></pre></td></tr></table></figure>
<h5 id="2-先启动bigdata121，再启动bigdata122-bigdata123"><a href="#2-先启动bigdata121，再启动bigdata122-bigdata123" class="headerlink" title="(2)先启动bigdata121，再启动bigdata122,bigdata123"></a>(2)先启动bigdata121，再启动bigdata122,bigdata123</h5><p>bigdata121</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/elasticsearch-6.1.1/</span><br><span class="line"></span><br><span class="line">bin/elasticsearch</span><br></pre></td></tr></table></figure>
<p>bigdata122</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/elasticsearch-6.1.1/</span><br><span class="line"></span><br><span class="line">bin/elasticsearch</span><br></pre></td></tr></table></figure>
<p>bigdata123</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/elasticsearch-6.1.1/</span><br><span class="line"></span><br><span class="line">bin/elasticsearch</span><br></pre></td></tr></table></figure>
<h4 id="11-集群安装参照："><a href="#11-集群安装参照：" class="headerlink" title="11.集群安装参照："></a>11.集群安装参照：</h4><p>【链接】手把手教你搭建一个Elasticsearch集群<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1189282">https://cloud.tencent.com/developer/article/1189282</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" rel="tag">安装部署</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch单节点安装部署"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/Elasticsearch%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"
    >Elasticsearch单节点安装部署</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/Elasticsearch%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" class="article-date">
  <time datetime="2020-01-12T04:00:00.000Z" itemprop="datePublished">2020-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-安装"><a href="#一-安装" class="headerlink" title="一.安装"></a>一.安装</h3><h4 id="1-先前条件："><a href="#1-先前条件：" class="headerlink" title="1.先前条件："></a>1.先前条件：</h4><ul>
<li>安装java8</li>
<li>下载es安装包</li>
</ul>
<h4 id="2-上传到linux：-opt-software"><a href="#2-上传到linux：-opt-software" class="headerlink" title="2.上传到linux：/opt/software"></a>2.上传到linux：/opt/software</h4><h4 id="3-解压"><a href="#3-解压" class="headerlink" title="3.解压"></a>3.解压</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software</span><br><span class="line"></span><br><span class="line">tar -zxvf elasticsearch-5.6.2.tar.gz -C /opt/module</span><br></pre></td></tr></table></figure>
<h4 id="4-新建data，logs文件夹"><a href="#4-新建data，logs文件夹" class="headerlink" title="4.新建data，logs文件夹"></a>4.新建data，logs文件夹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/elasticsearch-5.6.2</span><br><span class="line"></span><br><span class="line">mkdir data</span><br><span class="line"></span><br><span class="line">mkdir logs</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWI2YzM2NTM2NmFkNzIyYWYucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h4 id="5-修改配置文件-root用户"><a href="#5-修改配置文件-root用户" class="headerlink" title="5.修改配置文件(root用户)"></a>5.修改配置文件(root用户)</h4><h5 id="1-修改elasticsearch-yml文件"><a href="#1-修改elasticsearch-yml文件" class="headerlink" title="(1).修改elasticsearch.yml文件"></a>(1).修改elasticsearch.yml文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/module/elasticsearch-5.6.2/conf/elasticsearch.yml</span><br></pre></td></tr></table></figure>
<p>修改内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ---------------------------------- Cluster -------------------------------------</span></span><br><span class="line">cluster.name: my-application</span><br><span class="line"><span class="meta">#</span><span class="bash"> ------------------------------------ Node --------------------------------------</span></span><br><span class="line">node.name: JBS</span><br><span class="line"><span class="meta">#</span><span class="bash"> ----------------------------------- Paths ---------------------------------------</span></span><br><span class="line">path.data: /opt/module/elasticsearch-5.6.1/data</span><br><span class="line">path.logs: /opt/module/elasticsearch-5.6.1/logs</span><br><span class="line"><span class="meta">#</span><span class="bash"> ----------------------------------- Memory -----------------------------------</span></span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line"><span class="meta">#</span><span class="bash"> ---------------------------------- Network ------------------------------------</span></span><br><span class="line">network.host: 192.168.127.121 </span><br><span class="line"><span class="meta">#</span><span class="bash"> --------------------------------- Discovery ------------------------------------</span></span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;bigdata121&quot;]</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU2MjI1MDY3MTI1YWU0NDQucG5n?x-oss-process=image/format,png" alt="elasticsearch.yml"></p>
<p>说明：</p>
<ul>
<li>cluster.name ：如果要配置集群需要两个节点上的 elasticsearch 配置的 cluster.name 相同，都启动可以自动组成集群，这里如果不改 cluster.name 则默认是 cluster.name=my-application。</li>
<li>nodename 随意取但是集群内的各节点不能相同</li>
</ul>
<h5 id="2-修改limits-conf文件"><a href="#2-修改limits-conf文件" class="headerlink" title="(2).修改limits.conf文件"></a>(2).修改limits.conf文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">//在文件末尾添加如下内容</span><br><span class="line"></span><br><span class="line">* soft nofile 655360</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 4096</span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWM5NjFiNTRlY2ExMzM3ZGMucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h5 id="3-修改limits-d文件"><a href="#3-修改limits-d文件" class="headerlink" title="(3).修改limits.d文件"></a>(3).修改limits.d文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line"></span><br><span class="line">//修改内容如下</span><br><span class="line">*    soft    nproc    1024</span><br><span class="line">//改为</span><br><span class="line">*    soft    nproc    4096</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTA4YmIwMzgyMTU4Njg2MDIucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h5 id="4-修改配置sysctl-conf"><a href="#4-修改配置sysctl-conf" class="headerlink" title="(4).修改配置sysctl.conf"></a>(4).修改配置sysctl.conf</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">//添加内容</span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThmZmQ4MWI5MjE4NzRkOTIucG5n?x-oss-process=image/format,png" alt="sysctl.conf"></p>
<h4 id="5-新建linux用户-es不能以root用户启动"><a href="#5-新建linux用户-es不能以root用户启动" class="headerlink" title="5.新建linux用户:es不能以root用户启动"></a>5.新建linux用户:es不能以root用户启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">useradd kai</span><br><span class="line"></span><br><span class="line">passwd kai</span><br><span class="line">输入密码</span><br><span class="line"></span><br><span class="line">cd /opt/module/elasticsearch-5.6.2       //进入的elasticsearch目录</span><br><span class="line"></span><br><span class="line">chown -R kai:users *      //修改权限</span><br><span class="line"></span><br><span class="line">su kai        //切换到kai用户，启动es</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTA4OTU5ZTM2Y2I4MmI0OGEucG5n?x-oss-process=image/format,png" alt="新建用户"></p>
<h4 id="6-重启linux-因为修改linux配置文件后需要重启后才生效"><a href="#6-重启linux-因为修改linux配置文件后需要重启后才生效" class="headerlink" title="6.重启linux,因为修改linux配置文件后需要重启后才生效"></a>6.重启linux,因为修改linux配置文件后需要重启后才生效</h4><h3 id="二-启动："><a href="#二-启动：" class="headerlink" title="二.启动："></a>二.启动：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su kai      //切换到kai用户</span><br><span class="line">cd /opt/module/elasticsearch-5.6.2</span><br><span class="line"></span><br><span class="line">bin/elasticsearch       //启动</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWUwOGI0MzI4YzlhMjI2ZDAucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<p>注意：can not run elasticsearch as root</p>
<h3 id="三-验证："><a href="#三-验证：" class="headerlink" title="三.验证："></a>三.验证：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://192.168.127.121:9200&#x27;</span><br><span class="line"></span><br><span class="line">curl -XGET &#x27;192.168.127.121:9200/_cat/health?v&amp;pretty&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTJmNWI3OTYzZTE4Mzk1ODQucG5n?x-oss-process=image/format,png" alt="验证"></p>
<p>当看到status是green时，证明启动成功</p>
<ul>
<li>Green - 一切运行正常(集群功能齐全)</li>
<li>Yellow - 所有数据是可以获取的，但是一些复制品还没有被分配(集群功能齐全)</li>
<li>Red - 一些数据因为一些原因获取不到(集群部分功能不可用)</li>
</ul>
<h3 id="四-当启动es，报错："><a href="#四-当启动es，报错：" class="headerlink" title="四.当启动es，报错："></a>四.当启动es，报错：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</span><br><span class="line"></span><br><span class="line">[2]: max number of threads [1024] for user [hduser] is too low, increase to at least [4096]</span><br><span class="line"></span><br><span class="line">[3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span><br><span class="line"></span><br><span class="line">[4]: system call filters failed to install; check the logs and fix your configuration or disable system </span><br></pre></td></tr></table></figure>

<h4 id="1-配置linux系统环境："><a href="#1-配置linux系统环境：" class="headerlink" title="1.配置linux系统环境："></a>1.配置linux系统环境：</h4><h4 id="2-切换到-root-用户，编辑-limits-conf-添加类似如下内容"><a href="#2-切换到-root-用户，编辑-limits-conf-添加类似如下内容" class="headerlink" title="2.切换到 root 用户，编辑 limits.conf 添加类似如下内容"></a>2.切换到 root 用户，编辑 limits.conf 添加类似如下内容</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br></pre></td></tr></table></figure>

<p>新增内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 4096</span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure>
<h4 id="3-进入-limits-d-目录下修改配置文件。"><a href="#3-进入-limits-d-目录下修改配置文件。" class="headerlink" title="3.进入 limits.d 目录下修改配置文件。"></a>3.进入 limits.d 目录下修改配置文件。</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.d/90-nproc.conf</span><br></pre></td></tr></table></figure>
<p>把 *          soft    nproc     1024 改成4096</p>
<h4 id="5-修改配置-sysctl-conf"><a href="#5-修改配置-sysctl-conf" class="headerlink" title="5.修改配置 sysctl.conf"></a>5.修改配置 sysctl.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf </span><br></pre></td></tr></table></figure>
<p>添加内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>
<p>执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<h4 id="6-重新登录kai用户，重新启动es-如果还有报错，则需重启虚拟机"><a href="#6-重新登录kai用户，重新启动es-如果还有报错，则需重启虚拟机" class="headerlink" title="6.重新登录kai用户，重新启动es,如果还有报错，则需重启虚拟机"></a>6.重新登录kai用户，重新启动es,如果还有报错，则需重启虚拟机</h4><ul>
<li>查看集群状态命令：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;http://192.168.127.121:9200/_cat/health?v&amp;pretty&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>查看所有数据命令：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;ip地址:9200/index名称/_search?pretty&#x27; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" rel="tag">安装部署</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch核心概念"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/Elasticsearch%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/"
    >Elasticsearch核心概念</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/Elasticsearch%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/" class="article-date">
  <time datetime="2020-01-12T03:00:00.000Z" itemprop="datePublished">2020-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-近实时"><a href="#1-近实时" class="headerlink" title="1.近实时"></a>1.近实时</h4><p>近实时，两个意思，从写入数据到数据可以被搜索到有一个小延迟（大概1秒）；基于es执行搜索和分析可以达到秒级。</p>
<h4 id="2-Cluster（集群）"><a href="#2-Cluster（集群）" class="headerlink" title="2 Cluster（集群）"></a>2 Cluster（集群）</h4><p>集群包含多个节点，每个节点属于哪个集群是通过一个配置（集群名称，默认是elasticsearch）来决定的，对于中小型应用来说，刚开始一个集群就一个节点很正常。</p>
<h4 id="3-Node（节点）"><a href="#3-Node（节点）" class="headerlink" title="3 Node（节点）"></a>3 Node（节点）</h4><p>集群中的一个节点，节点也有一个名称(默认是随机分配的)，节点名称很重要(在执行运维管理操作的时候)，默认节点会去加入一个名称为“elasticsearch”的集群，如果直接启动一堆节点，那么它们会自动组成一个elasticsearch集群，当然一个节点也可以组成一个elasticsearch集群。</p>
<h4 id="4-Index（索引-数据库）"><a href="#4-Index（索引-数据库）" class="headerlink" title="4 Index（索引-数据库）"></a>4 Index（索引-数据库）</h4><p>索引包含一堆有相似结构的文档数据，比如可以有一个客户索引，商品分类索引，订单索引，索引有一个名称。一个index包含很多document，一个index就代表了一类类似的或者相同的document。比如说建立一个product index，商品索引，里面可能就存放了所有的商品数据，所有的商品document。</p>
<h4 id="5-Type（类型-表）"><a href="#5-Type（类型-表）" class="headerlink" title="5 Type（类型-表）"></a>5 Type（类型-表）</h4><p>每个索引里都可以有一个或多个type，type是index中的一个逻辑数据分类，一个type下的document，都有相同的field，比如博客系统，有一个索引，可以定义用户数据type，博客数据type，评论数据type。</p>
<p>商品index，里面存放了所有的商品数据，商品document</p>
<p>但是商品分很多种类，每个种类的document的field可能不太一样，比如说电器商品，可能还包含一些诸如售后时间范围这样的特殊field；生鲜商品，还包含一些诸如生鲜保质期之类的特殊field</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type，日化商品type，电器商品type，生鲜商品type</span><br><span class="line"></span><br><span class="line">日化商品type：product_id，product_name，product_desc，category_id，category_name</span><br><span class="line"></span><br><span class="line">电器商品type：product_id，product_name，product_desc，category_id，category_name，service_period</span><br><span class="line"></span><br><span class="line">生鲜商品type：product_id，product_name，product_desc，category_id，category_name，eat_period</span><br></pre></td></tr></table></figure>
<p>每一个type里面，都会包含一堆document</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_name&quot;</span>: <span class="string">&quot;长虹电视机&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_desc&quot;</span>: <span class="string">&quot;4k高清&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;category_id&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;category_name&quot;</span>: <span class="string">&quot;电器&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;service_period&quot;</span>: <span class="string">&quot;1年&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_name&quot;</span>: <span class="string">&quot;基围虾&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_desc&quot;</span>: <span class="string">&quot;纯天然，冰岛产&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;category_id&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;category_name&quot;</span>: <span class="string">&quot;生鲜&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;eat_period&quot;</span>: <span class="string">&quot;7天&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-Document（文档-行）"><a href="#6-Document（文档-行）" class="headerlink" title="6 Document（文档-行）"></a>6 Document（文档-行）</h4><p>文档是es中的最小数据单元，一个document可以是一条客户数据，一条商品分类数据，一条订单数据，通常用JSON数据结构表示，每个index下的type中，都可以去存储多个document。</p>
<h4 id="7-Field（字段-列）"><a href="#7-Field（字段-列）" class="headerlink" title="7 Field（字段-列）"></a>7 Field（字段-列）</h4><p>Field是Elasticsearch的最小单位。一个document里面有多个field，每个field就是一个数据字段。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">product document</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_name&quot;</span>: <span class="string">&quot;高露洁牙膏&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;product_desc&quot;</span>: <span class="string">&quot;高效美白&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;category_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;category_name&quot;</span>: <span class="string">&quot;日化用品&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-mapping（映射-约束）"><a href="#8-mapping（映射-约束）" class="headerlink" title="8 mapping（映射-约束）"></a>8 mapping（映射-约束）</h4><p>数据如何存放到索引对象上，需要有一个映射配置，包括：数据类型、是否存储、是否分词等。</p>
<p>这样就创建了一个名为blog的Index。Type不用单独创建，在创建Mapping 时指定就可以。Mapping用来定义Document中每个字段的类型，即所使用的 analyzer、是否索引等属性，非常关键等。创建Mapping 的代码示例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">client.indices.putMapping(&#123;</span><br><span class="line"></span><br><span class="line">    index : &#x27;blog&#x27;,</span><br><span class="line"></span><br><span class="line">    type : &#x27;article&#x27;,</span><br><span class="line"></span><br><span class="line">    body : &#123;</span><br><span class="line"></span><br><span class="line">        article: &#123;</span><br><span class="line"></span><br><span class="line">            properties: &#123;</span><br><span class="line"></span><br><span class="line">                id: &#123;</span><br><span class="line"></span><br><span class="line">                    type: &#x27;string&#x27;,</span><br><span class="line"></span><br><span class="line">                    analyzer: &#x27;ik&#x27;,</span><br><span class="line"></span><br><span class="line">                    store: &#x27;yes&#x27;,</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">                title: &#123;</span><br><span class="line"></span><br><span class="line">                    type: &#x27;string&#x27;,</span><br><span class="line"></span><br><span class="line">                    analyzer: &#x27;ik&#x27;,</span><br><span class="line"></span><br><span class="line">                    store: &#x27;no&#x27;,</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">                content: &#123;</span><br><span class="line"></span><br><span class="line">                    type: &#x27;string&#x27;,</span><br><span class="line"></span><br><span class="line">                    analyzer: &#x27;ik&#x27;,</span><br><span class="line"></span><br><span class="line">                    store: &#x27;yes&#x27;,</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="9-elasticsearch与数据库的类比"><a href="#9-elasticsearch与数据库的类比" class="headerlink" title="9.elasticsearch与数据库的类比"></a>9.elasticsearch与数据库的类比</h4><table>
<thead>
<tr>
<th align="center">关系型数据库（比如Mysql）</th>
<th align="center">非关系型数据库（Elasticsearch）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数据库Database</td>
<td align="center">索引Index</td>
</tr>
<tr>
<td align="center">表Table</td>
<td align="center">类型Type</td>
</tr>
<tr>
<td align="center">数据行Row</td>
<td align="center">文档Document</td>
</tr>
<tr>
<td align="center">数据列Column</td>
<td align="center">字段Field</td>
</tr>
<tr>
<td align="center">约束 Schema</td>
<td align="center">映射Mapping</td>
</tr>
</tbody></table>
<h4 id="10-ES存入数据和搜索数据机制"><a href="#10-ES存入数据和搜索数据机制" class="headerlink" title="10.ES存入数据和搜索数据机制"></a>10.ES存入数据和搜索数据机制</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTkyZWUwNDViYWIzYWVkZDYucG5n?x-oss-process=image/format,png"></p>
<h5 id="1-索引对象-index-："><a href="#1-索引对象-index-：" class="headerlink" title="(1)索引对象(index)："></a>(1)索引对象(index)：</h5><p>存储数据的表结构 ，任何搜索数据，存放在索引对象上 </p>
<h5 id="2-映射-mapping-："><a href="#2-映射-mapping-：" class="headerlink" title="(2)映射(mapping)："></a>(2)映射(mapping)：</h5><p>数据如何存放到索引对象上，需要有一个映射配置， 包括：数据类型、是否存储、是否分词等</p>
<h5 id="3-文档-document-："><a href="#3-文档-document-：" class="headerlink" title="(3)文档(document)："></a>(3)文档(document)：</h5><p>一条数据记录，存在索引对象上 </p>
<h5 id="4-文档类型-type-："><a href="#4-文档类型-type-：" class="headerlink" title="(4)文档类型(type)："></a>(4)文档类型(type)：</h5><p>一个索引对象，存放多种类型数据，数据用文档类型进行标识</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Elasticsearch概览"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/Elasticsearch%E6%A6%82%E8%A7%88/"
    >Elasticsearch概览</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/Elasticsearch%E6%A6%82%E8%A7%88/" class="article-date">
  <time datetime="2020-01-12T02:00:00.000Z" itemprop="datePublished">2020-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-什么是Elasticsearch"><a href="#1-什么是Elasticsearch" class="headerlink" title="1.什么是Elasticsearch"></a>1.什么是Elasticsearch</h4><p>(1)Elasticsearch，基于lucene，隐藏复杂性，提供简单易用的restful api接口、java api接口（还有其他语言的api接口）。</p>
<p>(2)Elasticsearch是一个实时分布式搜索和分析引擎。它用于全文搜索、结构化搜索、分析。</p>
<p>(3)全文检索：将非结构化数据中的一部分信息提取出来,重新组织,使其变得有一定结构,然后对此有一定结构的数据进行搜索,从而达到搜索相对较快的目的。</p>
<h4 id="2-Elasticsearch适用场景"><a href="#2-Elasticsearch适用场景" class="headerlink" title="2.Elasticsearch适用场景"></a>2.Elasticsearch适用场景</h4><p>(1)维基百科，类似百度百科，全文检索，高亮，搜索推荐。<br>(2)The Guardian（国外新闻网站），用户行为日志（点击，浏览，收藏，评论）+ 社交网络数据（对某某新闻的相关看法），数据分析，给到每篇新闻文章的作者，让他知道他的文章的公众反馈（好，坏，热门，垃圾，鄙视，崇拜）。<br>(3)Stack Overflow，全文检索，搜索相关问题和答案，程序报错了，就会将报错信息粘贴到里面去，搜索有没有对应的答案。<br>(4)GitHub（开源代码管理），搜索上千亿行代码。</p>
<p>(5)国内：站内搜索（电商，招聘，门户，等等），IT系统搜索（OA，CRM，ERP，等等），数据分析（ES热门的一个使用场景）。</p>
<h4 id="3-Elasticsearch特点"><a href="#3-Elasticsearch特点" class="headerlink" title="3.Elasticsearch特点"></a>3.Elasticsearch特点</h4><p>(1)可以作为一个大型分布式集群（数百台服务器）技术，处理PB级数据，服务大公司；也可以运行在单机上，服务小公司；树莓派</p>
<p>(2)Elasticsearch不是什么新技术，主要是将全文检索、数据分析以及分布式技术，合并在了一起，才形成了独一无二的ES；lucene（全文检索），商用的数据分析软件（也是有的），分布式数据库(mycat)；</p>
<p>(3)对用户而言，是开箱即用的，非常简单，作为中小型的应用，直接3分钟部署一下ES，就可以作为生产环境的系统来使用了，数据量不大，操作不是太复杂；</p>
<p>(4)数据库的功能面对很多领域是不够用的（事务，还有各种联机事务型的操作）；特殊的功能，比如全文检索，同义词处理，相关度排名，复杂数据分析，海量数据的近实时处理；Elasticsearch作为传统数据库的一个补充，提供了数据库所不能提供的很多功能。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-CentOS7(单节点)安装elasticsearch"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/11/CentOS7(%E5%8D%95%E8%8A%82%E7%82%B9)%E5%AE%89%E8%A3%85elasticsearch/"
    >CentOS7(单节点)安装elasticsearch</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/11/CentOS7(%E5%8D%95%E8%8A%82%E7%82%B9)%E5%AE%89%E8%A3%85elasticsearch/" class="article-date">
  <time datetime="2020-01-11T07:00:00.000Z" itemprop="datePublished">2020-01-11</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Elasticsearch/">Elasticsearch</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-下载安装包"><a href="#1-下载安装包" class="headerlink" title="1.下载安装包"></a>1.下载安装包</h4><h4 id="2-上传到linux"><a href="#2-上传到linux" class="headerlink" title="2.上传到linux"></a>2.上传到linux</h4><h4 id="3-解压："><a href="#3-解压：" class="headerlink" title="3.解压："></a>3.解压：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/tars</span><br><span class="line"></span><br><span class="line">tar -zxvf elasticsearch-5.6.2.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>

<h4 id="4-新建目录"><a href="#4-新建目录" class="headerlink" title="4.新建目录"></a>4.新建目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/elasticsearch-5.6.2</span><br><span class="line"></span><br><span class="line">mkdir data                    </span><br><span class="line">mkdir logs     </span><br></pre></td></tr></table></figure>

<h4 id="5-修改配置文件："><a href="#5-修改配置文件：" class="headerlink" title="5.修改配置文件："></a>5.修改配置文件：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/elasticsearch-5.6.2/config</span><br><span class="line"></span><br><span class="line">vi elasticsearch.yml</span><br></pre></td></tr></table></figure>

<p>修改内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: my-application</span><br><span class="line"></span><br><span class="line">node.name: hadoop1</span><br><span class="line"></span><br><span class="line">path.data: /usr/local/elasticsearch-5.6.2/data</span><br><span class="line"></span><br><span class="line">path.logs: /usr/local/elasticsearch-5.6.2/logs</span><br><span class="line"></span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line"></span><br><span class="line">network.host: hadoop1</span><br><span class="line"></span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;hadoop1&quot;]</span><br></pre></td></tr></table></figure>
<h4 id="6-修改limits-conf-文件"><a href="#6-修改limits-conf-文件" class="headerlink" title="6.修改limits.conf 文件"></a>6.修改limits.conf 文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">//在文件末尾添加如下内容</span><br><span class="line"></span><br><span class="line">* soft nofile 655360</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 4096</span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU3MjllYjlhYzhjNWUwN2EucG5n?x-oss-process=image/format,png"></p>
<h4 id="7-修改limit-d下的文件"><a href="#7-修改limit-d下的文件" class="headerlink" title="7.修改limit.d下的文件"></a>7.修改limit.d下的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line"></span><br><span class="line">//修改内容如下</span><br><span class="line">*    soft    nproc    1024</span><br><span class="line">//改为</span><br><span class="line">*    soft    nproc    4096</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTc3MWQxYjljOGVlMTVhY2IuanBn?x-oss-process=image/format,png" alt="20-nproc.conf"></p>
<h4 id="8-修改sysctl-conf文件"><a href="#8-修改sysctl-conf文件" class="headerlink" title="8.修改sysctl.conf文件"></a>8.修改sysctl.conf文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">//添加内容</span><br><span class="line">vm.max_map_count=655360</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTRmYjE0NzhiNmM3MjNkODcuanBn?x-oss-process=image/format,png" alt="sysct;.conf"></p>
<h4 id="9-新建用户，elasticsearch不能以root用户启动"><a href="#9-新建用户，elasticsearch不能以root用户启动" class="headerlink" title="9.新建用户，elasticsearch不能以root用户启动"></a>9.新建用户，elasticsearch不能以root用户启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useradd hduser</span><br><span class="line"></span><br><span class="line">cd /user/local</span><br><span class="line"></span><br><span class="line">chown -R hduser ./elasticsearch-5.6.2/</span><br><span class="line">chgrp -R hduser ./elasticsearch-5.6.2/</span><br></pre></td></tr></table></figure>
<h4 id="10-切换到hduser用户，启动elasticsearch"><a href="#10-切换到hduser用户，启动elasticsearch" class="headerlink" title="10.切换到hduser用户，启动elasticsearch"></a>10.切换到hduser用户，启动elasticsearch</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su hduser</span><br><span class="line"></span><br><span class="line">cd /usr/local/elasticsearch-5.6.2</span><br><span class="line"></span><br><span class="line">./bin/elasticsearch -d                              //后台启动</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CentOS/" rel="tag">CentOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" rel="tag">安装部署</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-编程常用命令"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/10/%E7%BC%96%E7%A8%8B%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"
    >编程常用命令</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/10/%E7%BC%96%E7%A8%8B%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-date">
  <time datetime="2020-01-10T01:12:00.000Z" itemprop="datePublished">2020-01-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%80%9F%E6%9F%A5/">速查</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-redis"><a href="#1-redis" class="headerlink" title="1.redis"></a>1.redis</h4><h5 id="1-启动："><a href="#1-启动：" class="headerlink" title="(1)启动："></a>(1)启动：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis</span><br><span class="line"></span><br><span class="line">./bin/redis-server ./redis.conf </span><br></pre></td></tr></table></figure>
<h5 id="2-查看"><a href="#2-查看" class="headerlink" title="(2)查看"></a>(2)查看</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>
<h5 id="3-启动客户端："><a href="#3-启动客户端：" class="headerlink" title="(3)启动客户端："></a>(3)启动客户端：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis</span><br><span class="line"></span><br><span class="line">./bin/redis-cli</span><br><span class="line"></span><br><span class="line">./bin/redis-cli -h 192.168.31.141</span><br></pre></td></tr></table></figure>

<h5 id="4-插入数据"><a href="#4-插入数据" class="headerlink" title="(4)插入数据:"></a>(4)插入数据:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lpush uid:1 1129:2.0 1172:4.0 1263:2.0 1287:2.0 1293:2.0 1339:3.5 1343:2.0 1371:2.5</span><br></pre></td></tr></table></figure>
<h5 id="5-查询数据："><a href="#5-查询数据：" class="headerlink" title="(5)查询数据："></a>(5)查询数据：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrange uid:1 0 20</span><br></pre></td></tr></table></figure>
<h4 id="2-Mongodb"><a href="#2-Mongodb" class="headerlink" title="2.Mongodb"></a>2.Mongodb</h4><h5 id="1-启动"><a href="#1-启动" class="headerlink" title="(1)启动"></a>(1)启动</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mongodb</span><br><span class="line"></span><br><span class="line">./bin/mongod -config ./data/mongodb.conf </span><br></pre></td></tr></table></figure>
<h5 id="2-关闭："><a href="#2-关闭：" class="headerlink" title="(2)关闭："></a>(2)关闭：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mongodb</span><br><span class="line"></span><br><span class="line">./bin/mongod -shutdown -config ./data/mongodb.conf     </span><br></pre></td></tr></table></figure>
<h4 id="3-kafka"><a href="#3-kafka" class="headerlink" title="3.kafka"></a>3.kafka</h4><h5 id="1-启动-1"><a href="#1-启动-1" class="headerlink" title="(1)启动"></a>(1)启动</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh config/server.properties &amp;</span><br></pre></td></tr></table></figure>
<h5 id="2-关闭"><a href="#2-关闭" class="headerlink" title="(2)关闭"></a>(2)关闭</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-stop.sh stop</span><br></pre></td></tr></table></figure>
<h5 id="3-生产消息"><a href="#3-生产消息" class="headerlink" title="(3)生产消息"></a>(3)生产消息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh --broker-list bigdata11:9092 --topic first</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">hello world</span></span><br></pre></td></tr></table></figure>
<h5 id="4-消费消息"><a href="#4-消费消息" class="headerlink" title="(4)消费消息"></a>(4)消费消息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --zookeeper bigdata11:2181 --from-beginning --topic first</span><br><span class="line"></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server 192.168.31.141:9092 --topic first</span><br></pre></td></tr></table></figure>
<h5 id="5-查看所有topic"><a href="#5-查看所有topic" class="headerlink" title="(5)查看所有topic"></a>(5)查看所有topic</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --zookeeper bigdata13:2181 --list</span><br></pre></td></tr></table></figure>

<h4 id="4-HBase"><a href="#4-HBase" class="headerlink" title="4.HBase"></a>4.HBase</h4><h5 id="1-启动方式一"><a href="#1-启动方式一" class="headerlink" title="(1)启动方式一"></a>(1)启动方式一</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/hbase-daemon.sh start master</span><br><span class="line"></span><br><span class="line">bin/hbase-daemon.sh start regionserver</span><br></pre></td></tr></table></figure>
<h5 id="2-启动方式二"><a href="#2-启动方式二" class="headerlink" title="(2)启动方式二"></a>(2)启动方式二</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/start-hbase.sh</span><br></pre></td></tr></table></figure>
<h5 id="3-停止服务"><a href="#3-停止服务" class="headerlink" title="(3)停止服务"></a>(3)停止服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/stop-hbase.sh</span><br></pre></td></tr></table></figure>

<h4 id="5-Spark"><a href="#5-Spark" class="headerlink" title="5.Spark"></a>5.Spark</h4><h5 id="1-启动-2"><a href="#1-启动-2" class="headerlink" title="(1)启动"></a>(1)启动</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-all.sh</span><br></pre></td></tr></table></figure>
<h5 id="2-停止"><a href="#2-停止" class="headerlink" title="(2)停止"></a>(2)停止</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/stop-all.sh</span><br></pre></td></tr></table></figure>

<h4 id="6-ZooKeeper"><a href="#6-ZooKeeper" class="headerlink" title="6.ZooKeeper"></a>6.ZooKeeper</h4><h5 id="1-分别启动"><a href="#1-分别启动" class="headerlink" title="(1)分别启动"></a>(1)分别启动</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh start</span><br></pre></td></tr></table></figure>
<h5 id="2-分别停止"><a href="#2-分别停止" class="headerlink" title="(2)分别停止"></a>(2)分别停止</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh stop</span><br></pre></td></tr></table></figure>

<h4 id="7-Hive"><a href="#7-Hive" class="headerlink" title="7.Hive"></a>7.Hive</h4><h5 id="1-启动-3"><a href="#1-启动-3" class="headerlink" title="(1)启动"></a>(1)启动</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive</span><br></pre></td></tr></table></figure>
<h5 id="2-退出hive"><a href="#2-退出hive" class="headerlink" title="(2)退出hive"></a>(2)退出hive</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quit;</span><br><span class="line"></span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>
<h5 id="3-“-e”不进入hive的交互窗口执行sql语句"><a href="#3-“-e”不进入hive的交互窗口执行sql语句" class="headerlink" title="(3).“-e”不进入hive的交互窗口执行sql语句"></a>(3).“-e”不进入hive的交互窗口执行sql语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -e &quot;select id from student;&quot;</span><br></pre></td></tr></table></figure>

<h5 id="4-“-f”执行脚本中sql语句-执行文件中的sql语句"><a href="#4-“-f”执行脚本中sql语句-执行文件中的sql语句" class="headerlink" title="(4).“-f”执行脚本中sql语句,执行文件中的sql语句"></a>(4).“-f”执行脚本中sql语句,执行文件中的sql语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -f /opt/module/datas/hive.sql</span><br></pre></td></tr></table></figure>
<h5 id="5-在hive-cli命令窗口中如何查看hdfs文件系统"><a href="#5-在hive-cli命令窗口中如何查看hdfs文件系统" class="headerlink" title="(5).在hive cli命令窗口中如何查看hdfs文件系统"></a>(5).在hive cli命令窗口中如何查看hdfs文件系统</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs -ls /;</span><br></pre></td></tr></table></figure>
<h5 id="6-在hive-cli命令窗口中如何查看linux本地系统"><a href="#6-在hive-cli命令窗口中如何查看linux本地系统" class="headerlink" title="(6).在hive cli命令窗口中如何查看linux本地系统"></a>(6).在hive cli命令窗口中如何查看linux本地系统</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! ls /opt/module/datas;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%80%9F%E6%9F%A5/" rel="tag">速查</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-利用FRP实现内网穿透"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/09/%E5%88%A9%E7%94%A8FRP%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"
    >利用FRP实现内网穿透</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/09/%E5%88%A9%E7%94%A8FRP%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="article-date">
  <time datetime="2020-01-09T03:00:00.000Z" itemprop="datePublished">2020-01-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%89%E7%94%A8%E9%A1%B9%E7%9B%AE/">有用项目</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>情况：<br>自己有两台电脑，一台16G内存的Dell，和一台8G内存的MacBook Pro，因为自己学的是大数据开发，所以需要搭建大数据集群，因此在MacBook Pro开发的话内存太小了，既要用虚拟机搭建大数据集群，又要用IDEA开发的话，内存是肯定不够的，所以之前是在Dell上面创建虚拟机，搭建大数据集群，然后再在MacBook Pro上开发，因为虚拟机使用的桥接法上网，Macbook Pro和Dell又在同一个局域网里，所以还可以，但是如果需要离开，区别的地方的话，自己就需要带两台电脑了，太沉了，所以就打算用内网穿透，让MacBook 在外网，也可以访问Dell里的虚拟机</p>
</blockquote>
<h3 id="一-介绍"><a href="#一-介绍" class="headerlink" title="一.介绍"></a>一.介绍</h3><h4 id="1-FRP介绍："><a href="#1-FRP介绍：" class="headerlink" title="1.FRP介绍："></a>1.FRP介绍：</h4><p>frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透。</p>
<h4 id="2-FRP项目地址："><a href="#2-FRP项目地址：" class="headerlink" title="2.FRP项目地址："></a>2.FRP项目地址：</h4><p><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p>
<h4 id="3-环境："><a href="#3-环境：" class="headerlink" title="3.环境："></a>3.环境：</h4><h5 id="1-带外网IP的云主机-腾讯云：49-xxx-xxx-xx"><a href="#1-带外网IP的云主机-腾讯云：49-xxx-xxx-xx" class="headerlink" title="(1)带外网IP的云主机-腾讯云：49.xxx.xxx.xx"></a>(1)带外网IP的云主机-腾讯云：49.xxx.xxx.xx</h5><h5 id="2-内网的CentOS7-Windows搭建的虚拟机-：192-168-0-161"><a href="#2-内网的CentOS7-Windows搭建的虚拟机-：192-168-0-161" class="headerlink" title="(2)内网的CentOS7(Windows搭建的虚拟机)：192.168.0.161"></a>(2)内网的CentOS7(Windows搭建的虚拟机)：192.168.0.161</h5><h3 id="二-搭建过程"><a href="#二-搭建过程" class="headerlink" title="二.搭建过程"></a>二.搭建过程</h3><h5 id="1-在云主机上搭建FRP服务端："><a href="#1-在云主机上搭建FRP服务端：" class="headerlink" title="1.在云主机上搭建FRP服务端："></a>1.在云主机上搭建FRP服务端：</h5><h5 id="1-下载对应的FTP包："><a href="#1-下载对应的FTP包：" class="headerlink" title="(1)下载对应的FTP包："></a>(1)下载对应的FTP包：</h5><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWNmYTRmNzA3N2NjNzYwMGEucG5n?x-oss-process=image/format,png"></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWEzNjM1M2NlOGQ1YWUzN2QucG5n?x-oss-process=image/format,png" alt="拷贝链接"></p>
<p>下载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /mnt</span><br><span class="line"></span><br><span class="line">wget https://github.com/fatedier/frp/releases/download/v0.31.1/frp_0.31.1_linux_386.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="2-解压："><a href="#2-解压：" class="headerlink" title="(2).解压："></a>(2).解压：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.31.1_linux_386.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="3-重命名："><a href="#3-重命名：" class="headerlink" title="(3).重命名："></a>(3).重命名：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv frp_0.31.1_linux_386 frp </span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWM4MzZiMjI3NmVjNzA4YzMucG5n?x-oss-process=image/format,png"></p>
<h5 id="4-修改配置文件-服务端"><a href="#4-修改配置文件-服务端" class="headerlink" title="(4).修改配置文件(服务端)"></a>(4).修改配置文件(服务端)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ftp</span><br><span class="line"></span><br><span class="line">vi frps.ini </span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTUzOGFkNTliY2I3YjMwYWIucG5n?x-oss-process=image/format,png"></p>
<p>修改内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">frps.ini</span></span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000 </span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQ4OTE2MzNiMDRkOTU4MmEucG5n?x-oss-process=image/format,png" alt="frpc.ini"></p>
<h5 id="5-关闭防火墙，或者打开6000端口："><a href="#5-关闭防火墙，或者打开6000端口：" class="headerlink" title="(5)关闭防火墙，或者打开6000端口："></a>(5)关闭防火墙，或者打开6000端口：</h5><h5 id="6-运行"><a href="#6-运行" class="headerlink" title="(6)运行"></a>(6)运行</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTY2NGNiYzVjNmY1M2JhOGYucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-在内网CentOS7虚拟机配置FRP客户端"><a href="#2-在内网CentOS7虚拟机配置FRP客户端" class="headerlink" title="2.在内网CentOS7虚拟机配置FRP客户端"></a>2.在内网CentOS7虚拟机配置FRP客户端</h4><h5 id="1-下载："><a href="#1-下载：" class="headerlink" title="(1)下载："></a>(1)下载：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /mnt</span><br><span class="line"></span><br><span class="line">wget https://github.com/fatedier/frp/releases/download/v0.31.1/frp_0.31.1_linux_386.tar.gz</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTM2ODZiYjEyMGIyNjIyYmQucG5n?x-oss-process=image/format,png"></p>
<h5 id="2-解压，重命名："><a href="#2-解压，重命名：" class="headerlink" title="(2)解压，重命名："></a>(2)解压，重命名：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.31.1_linux_386.tar.gz</span><br><span class="line"></span><br><span class="line">mv frp_0.31.1_linux_386 frp</span><br></pre></td></tr></table></figure>
<h5 id="3-修改客户端配置文件frpc-ini"><a href="#3-修改客户端配置文件frpc-ini" class="headerlink" title="(3)修改客户端配置文件frpc.ini"></a>(3)修改客户端配置文件frpc.ini</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /mnt/frp</span><br><span class="line"></span><br><span class="line">vi frpc.ini</span><br></pre></td></tr></table></figure>
<p>修改内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> frpc.ini</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 49.x.x.x</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22</span><br><span class="line">remote_port = 6000</span><br></pre></td></tr></table></figure>
<ul>
<li>server_addr填写的是云服务器IP</li>
<li>remote_port 填写的是远程访问的端口号</li>
</ul>
<h5 id="4-启动frpc"><a href="#4-启动frpc" class="headerlink" title="(4)启动frpc"></a>(4)启动frpc</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c ./frpc.ini</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTg0NmQ1ZmI2YWJjZTA2Y2EucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h4 id="3-测试："><a href="#3-测试：" class="headerlink" title="3.测试："></a>3.测试：</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWY5YzA0ZjZkYmZmMDczY2EucG5n?x-oss-process=image/format,png" alt="1"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTg3MDA5OGViZWZlMTdlOTYucG5n?x-oss-process=image/format,png" alt="2"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FRP/" rel="tag">FRP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">内网穿透</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/10/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/12/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> Movle
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="https://img-blog.csdnimg.cn/20200609161448519.jpg" alt="Movle"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>
<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Movle</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="https://img-blog.csdnimg.cn/20200609161448519.jpg" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="https://img-blog.csdnimg.cn/2020060916514052.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Movle</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['种一棵树，最好的时机是十年前，其次是现在', '人必有痴，而后有成', '今天，我没有浑浑噩噩的度过'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Sqoop集成HBase：Mysql TO HBase"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/10/Sqoop%E9%9B%86%E6%88%90HBase%EF%BC%9AMysql%20TO%20HBase/"
    >Sqoop集成HBase：Mysql TO HBase</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/10/Sqoop%E9%9B%86%E6%88%90HBase%EF%BC%9AMysql%20TO%20HBase/" class="article-date">
  <time datetime="2019-04-10T07:00:00.000Z" itemprop="datePublished">2019-04-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-Sqoop集成HBase"><a href="#一-Sqoop集成HBase" class="headerlink" title="一.Sqoop集成HBase"></a>一.Sqoop集成HBase</h3><h4 id="1-利用Sqoop在HBase和RDBMS中进行数据的转储。"><a href="#1-利用Sqoop在HBase和RDBMS中进行数据的转储。" class="headerlink" title="1.利用Sqoop在HBase和RDBMS中进行数据的转储。"></a>1.利用Sqoop在HBase和RDBMS中进行数据的转储。</h4><h4 id="2-相关参数："><a href="#2-相关参数：" class="headerlink" title="2.相关参数："></a>2.相关参数：</h4><table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">–column-family &lt;family&gt;</td>
<td align="center">设置导入的目标列族</td>
</tr>
<tr>
<td align="center">–hbase-create-table</td>
<td align="center">是否自动创建不存在的HBase表(这就意味着，不需要手动提前在HBase中先建立表)</td>
</tr>
<tr>
<td align="center">–hbase-row-key &lt;col&gt;</td>
<td align="center">mysql中哪一列的值作为HBase的rowkey，如果rowkey是个组合键，则以逗号分隔(注：避免rowkey的重复)</td>
</tr>
<tr>
<td align="center">–hbase-table &lt;table-name&gt;</td>
<td align="center">指定数据将要导入到HBase中的哪张表中</td>
</tr>
<tr>
<td align="center">–hbase-bulkload</td>
<td align="center">是否允许bulk形式的导入</td>
</tr>
</tbody></table>
<h3 id="二-案例"><a href="#二-案例" class="headerlink" title="二. 案例"></a>二. 案例</h3><h4 id="1-目标：将RDBMS中的数据抽取到HBase中"><a href="#1-目标：将RDBMS中的数据抽取到HBase中" class="headerlink" title="1.目标：将RDBMS中的数据抽取到HBase中"></a>1.目标：将RDBMS中的数据抽取到HBase中</h4><h4 id="2-分步实现："><a href="#2-分步实现：" class="headerlink" title="2.分步实现："></a>2.分步实现：</h4><h5 id="1-配置sqoop-env-sh，添加如下内容："><a href="#1-配置sqoop-env-sh，添加如下内容：" class="headerlink" title="(1) 配置sqoop-env.sh，添加如下内容："></a>(1) 配置sqoop-env.sh，添加如下内容：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HBASE_HOME=/opt/module/hbase-1.3.1</span><br></pre></td></tr></table></figure>
<h5 id="2-在Mysql中新建一个数据库db-library，一张表book"><a href="#2-在Mysql中新建一个数据库db-library，一张表book" class="headerlink" title="(2) 在Mysql中新建一个数据库db_library，一张表book"></a>(2) 在Mysql中新建一个数据库db_library，一张表book</h5><p>进入mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p000000</span><br></pre></td></tr></table></figure>
<p>建库建表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE db_library;</span><br><span class="line"></span><br><span class="line">CREATE TABLE db_library.book(</span><br><span class="line">id int(4) PRIMARY KEY NOT NULL AUTO_INCREMENT, </span><br><span class="line">name VARCHAR(255) NOT NULL, </span><br><span class="line">price VARCHAR(255) NOT NULL);</span><br></pre></td></tr></table></figure>
<h5 id="3-向表中插入一些数据"><a href="#3-向表中插入一些数据" class="headerlink" title="(3) 向表中插入一些数据"></a>(3) 向表中插入一些数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO db_library.book (name, price) VALUES(&#x27;Lie Sporting&#x27;, &#x27;30&#x27;);  </span><br><span class="line">INSERT INTO db_library.book (name, price) VALUES(&#x27;Pride &amp; Prejudice&#x27;, &#x27;70&#x27;);  </span><br><span class="line">INSERT INTO db_library.book (name, price) VALUES(&#x27;Fall of Giants&#x27;, &#x27;50&#x27;);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQzOTg5OWQ5Mjg2NTZjZWUucG5n?x-oss-process=image/format,png" alt="mysql"></p>
<h5 id="4-执行Sqoop导入数据的操作"><a href="#4-执行Sqoop导入数据的操作" class="headerlink" title="(4) 执行Sqoop导入数据的操作"></a>(4) 执行Sqoop导入数据的操作</h5><p>手动创建HBase表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> create <span class="string">&#x27;hbase_book&#x27;</span>,<span class="string">&#x27;info&#x27;</span></span></span><br></pre></td></tr></table></figure>
<h5 id="5-在HBase中scan这张表得到如下内容"><a href="#5-在HBase中scan这张表得到如下内容" class="headerlink" title="(5) 在HBase中scan这张表得到如下内容"></a>(5) 在HBase中scan这张表得到如下内容</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> scan <span class="string">&#x27;hbase_book&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>思考：尝试使用复合键作为导入数据时的rowkey。</p>
<h5 id="6-利用sqoop导入"><a href="#6-利用sqoop导入" class="headerlink" title="(6)利用sqoop导入"></a>(6)利用sqoop导入</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop2:3306/db_library \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--table book \</span><br><span class="line">--columns &quot;id,name,price&quot; \</span><br><span class="line">--column-family &quot;info&quot; \</span><br><span class="line">--hbase-create-table \</span><br><span class="line">--hbase-row-key &quot;id&quot; \</span><br><span class="line">--hbase-table &quot;hbase_book&quot; \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--split-by id</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTAwMzgzMGFmMzQyMzRjZmIucG5n?x-oss-process=image/format,png" alt="sqoop导入"></p>
<p>提示：sqoop1.4.6只支持HBase1.0.1之前的版本的自动创建HBase表的功能</p>
<h5 id="7-结果："><a href="#7-结果：" class="headerlink" title="(7)结果："></a>(7)结果：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> scan <span class="string">&#x27;hbase_book&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWVmZWQyZTY0ZTE2Nzc5MjgucG5n?x-oss-process=image/format,png" alt="结果"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase%E5%AE%9E%E6%88%98/" rel="tag">HBase实战</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sqoop/" rel="tag">Sqoop</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase与Hive的集成"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/10/HBase%E4%B8%8EHive%E7%9A%84%E9%9B%86%E6%88%90/"
    >HBase与Hive的集成</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/10/HBase%E4%B8%8EHive%E7%9A%84%E9%9B%86%E6%88%90/" class="article-date">
  <time datetime="2019-04-10T05:00:00.000Z" itemprop="datePublished">2019-04-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-HBase与Hive的对比"><a href="#一-HBase与Hive的对比" class="headerlink" title="一.HBase与Hive的对比"></a>一.HBase与Hive的对比</h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">Hive</th>
<th align="center">Hbase</th>
</tr>
</thead>
<tbody><tr>
<td align="center">特点</td>
<td align="center">类SQL 数据仓库</td>
<td align="center">NoSQL (Key-value)</td>
</tr>
<tr>
<td align="center">适用场景</td>
<td align="center">离线数据分析和清洗</td>
<td align="center">适合在线业务</td>
</tr>
<tr>
<td align="center">延迟</td>
<td align="center">延迟高</td>
<td align="center">延迟低</td>
</tr>
<tr>
<td align="center">存储位置</td>
<td align="center">存储在HDFS</td>
<td align="center">存储在HDFS</td>
</tr>
</tbody></table>
<h3 id="二-HBase与Hive集成使用"><a href="#二-HBase与Hive集成使用" class="headerlink" title="二.HBase与Hive集成使用"></a>二.HBase与Hive集成使用</h3><h4 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.环境准备"></a>1.环境准备</h4><p>因为后续会在操作Hive的同时对HBase也会产生影响，所以Hive需要持有操作HBase的Jar，那么接下来拷贝Hive所依赖的Jar包(或者使用软连接的形式),记得还有把zookeeper的jar包考入到hive的lib目录下。</p>
<h5 id="1-在-etc-profile文件中添加环境变量"><a href="#1-在-etc-profile文件中添加环境变量" class="headerlink" title="(1)在/etc/profile文件中添加环境变量"></a>(1)在/etc/profile文件中添加环境变量</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">环境变量/etc/profile</span></span><br><span class="line">export HBASE_HOME=/opt/module/hbase-1.3.1</span><br><span class="line">export HIVE_HOME=/opt/module/hive-1.2.1</span><br></pre></td></tr></table></figure>
<h5 id="2-进入hive的lib目录"><a href="#2-进入hive的lib目录" class="headerlink" title="(2)进入hive的lib目录"></a>(2)进入hive的lib目录</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hive-1.2.1/lib/</span><br></pre></td></tr></table></figure>
<h5 id="3-进行软连接"><a href="#3-进行软连接" class="headerlink" title="(3)进行软连接"></a>(3)进行软连接</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ln -s $HBASE_HOME/lib/hbase-common-1.3.1.jar  $HIVE_HOME/lib/hbase-common-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-server-1.3.1.jar $HIVE_HOME/lib/hbase-server-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-client-1.3.1.jar $HIVE_HOME/lib/hbase-client-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-protocol-1.3.1.jar $HIVE_HOME/lib/hbase-protocol-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-it-1.3.1.jar $HIVE_HOME/lib/hbase-it-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/htrace-core-3.1.0-incubating.jar $HIVE_HOME/lib/htrace-core-3.1.0-incubating.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-hadoop2-compat-1.3.1.jar $HIVE_HOME/lib/hbase-hadoop2-compat-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-hadoop-compat-1.3.1.jar $HIVE_HOME/lib/hbase-hadoop-compat-1.3.1.jar</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTgyNGIxOGMzYTA0MTExMWYucG5n?x-oss-process=image/format,png" alt="软连接"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWVlNzFmMDEwNDNlNmY4ZjgucG5n?x-oss-process=image/format,png" alt="软连接"></p>
<h5 id="4-同时在hive-site-xml中修改zookeeper的属性，如下："><a href="#4-同时在hive-site-xml中修改zookeeper的属性，如下：" class="headerlink" title="(4)同时在hive-site.xml中修改zookeeper的属性，如下："></a>(4)同时在hive-site.xml中修改zookeeper的属性，如下：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop2,hadoop3,hadoop4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The list of ZooKeeper servers to talk to. This is only needed for read/write locks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.client.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The port of ZooKeeper servers to talk to. This is only needed for read/write locks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWRjYTExMWI0OTBlZjVmZDQucG5n?x-oss-process=image/format,png" alt="hive-site.xml"></p>
<h3 id="三-案例"><a href="#三-案例" class="headerlink" title="三.案例"></a>三.案例</h3><h4 id="1-案例一"><a href="#1-案例一" class="headerlink" title="1.案例一"></a>1.案例一</h4><p>目标：建立Hive表，关联HBase表，插入数据到Hive表的同时能够影响HBase表。<br>分步实现：</p>
<h5 id="1-在Hive中创建表同时关联HBase"><a href="#1-在Hive中创建表同时关联HBase" class="headerlink" title="(1) 在Hive中创建表同时关联HBase"></a>(1) 在Hive中创建表同时关联HBase</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE hive_hbase_emp_table1(</span><br><span class="line">empno int,</span><br><span class="line">ename string,</span><br><span class="line">job string,</span><br><span class="line">mgr int,</span><br><span class="line">hiredate string,</span><br><span class="line">sal double,</span><br><span class="line">comm double,</span><br><span class="line">deptno int)</span><br><span class="line">STORED BY &#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span><br><span class="line">WITH SERDEPROPERTIES (&quot;hbase.columns.mapping&quot; = &quot;:key,info:ename,info:job,info:mgr,info:hiredate,info:sal,info:comm,info:deptno&quot;)</span><br><span class="line">TBLPROPERTIES (&quot;hbase.table.name&quot; = &quot;hbase_emp_table1&quot;);</span><br></pre></td></tr></table></figure>
<p>提示：完成之后，可以分别进入Hive和HBase查看，都生成了对应的表</p>
<p>原有的hive-hbase-handler-1.2.1.jar可能有问题，换一个<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTJlNDUxMWVlNjk2MjQ3ODUucG5n?x-oss-process=image/format,png" alt="结果"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTliY2Y2MWM4NTIzZmY0NzYucG5n?x-oss-process=image/format,png" alt="结果"></p>
<h5 id="2-在Hive中创建临时中间表，用于load文件中的数据"><a href="#2-在Hive中创建临时中间表，用于load文件中的数据" class="headerlink" title="(2) 在Hive中创建临时中间表，用于load文件中的数据"></a>(2) 在Hive中创建临时中间表，用于load文件中的数据</h5><p>提示：不能将数据直接load进Hive所关联HBase的那张表中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE emp(</span><br><span class="line">empno int,</span><br><span class="line">ename string,</span><br><span class="line">job string,</span><br><span class="line">mgr int,</span><br><span class="line">hiredate string,</span><br><span class="line">sal double,</span><br><span class="line">comm double,</span><br><span class="line">deptno int)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="3-向Hive中间表中load数据"><a href="#3-向Hive中间表中load数据" class="headerlink" title="(3) 向Hive中间表中load数据"></a>(3) 向Hive中间表中load数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> load data <span class="built_in">local</span> inpath <span class="string">&#x27;/opt/TestFolder/emp.txt&#x27;</span> into table emp;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-通过insert命令将中间表中的数据导入到Hive关联HBase的那张表中"><a href="#4-通过insert命令将中间表中的数据导入到Hive关联HBase的那张表中" class="headerlink" title="(4) 通过insert命令将中间表中的数据导入到Hive关联HBase的那张表中"></a>(4) 通过insert命令将中间表中的数据导入到Hive关联HBase的那张表中</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> insert into table hive_hbase_emp_table1 select * from emp;</span></span><br></pre></td></tr></table></figure>
<h5 id="5-查看Hive以及关联的HBase表中是否已经成功的同步插入了数据"><a href="#5-查看Hive以及关联的HBase表中是否已经成功的同步插入了数据" class="headerlink" title="(5) 查看Hive以及关联的HBase表中是否已经成功的同步插入了数据"></a>(5) 查看Hive以及关联的HBase表中是否已经成功的同步插入了数据</h5><p>Hive：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> select * from hive_hbase_emp_table1;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFkOWU1N2M3NjcxODhmNTkucG5n?x-oss-process=image/format,png" alt="hive_hbase_emp_table1"></p>
<p>HBase：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> scan <span class="string">&#x27;hbase_emp_table1&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWJmYjk4MWUwMTk4N2I3NWEucG5n?x-oss-process=image/format,png" alt="hbase_emp_table1"></p>
<h4 id="2-案例二"><a href="#2-案例二" class="headerlink" title="2.案例二"></a>2.案例二</h4><p>目标：在HBase中已经存储了某一张表hbase_emp_table，然后在Hive中创建一个外部表来关联HBase中的hbase_emp_table这张表，使之可以借助Hive来分析HBase这张表中的数据。<br>注：该案例2紧跟案例1的脚步，所以完成此案例前，请先完成案例1。<br>分步实现：</p>
<h5 id="1-在Hive中创建外部表"><a href="#1-在Hive中创建外部表" class="headerlink" title="(1) 在Hive中创建外部表"></a>(1) 在Hive中创建外部表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTERNAL TABLE relevance_hbase_emp(</span><br><span class="line">empno int,</span><br><span class="line">ename string,</span><br><span class="line">job string,</span><br><span class="line">mgr int,</span><br><span class="line">hiredate string,</span><br><span class="line">sal double,</span><br><span class="line">comm double,</span><br><span class="line">deptno int)</span><br><span class="line">STORED BY </span><br><span class="line">&#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span><br><span class="line">WITH SERDEPROPERTIES (&quot;hbase.columns.mapping&quot; = </span><br><span class="line">&quot;:key,info:ename,info:job,info:mgr,info:hiredate,info:sal,info:comm,info:deptno&quot;) </span><br><span class="line">TBLPROPERTIES (&quot;hbase.table.name&quot; = &quot;hbase_emp_table1&quot;);</span><br></pre></td></tr></table></figure>
<h5 id="2-关联后就可以使用Hive函数进行一些分析操作了"><a href="#2-关联后就可以使用Hive函数进行一些分析操作了" class="headerlink" title="(2) 关联后就可以使用Hive函数进行一些分析操作了"></a>(2) 关联后就可以使用Hive函数进行一些分析操作了</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from relevance_hbase_emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTRhZWRjNGIzZGVkOGMxMjEucG5n?x-oss-process=image/format,png" alt="外部表"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase%E5%AE%9E%E6%88%98/" rel="tag">HBase实战</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Phoenix集成HBase"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/10/Phoenix%E9%9B%86%E6%88%90HBase/"
    >Phoenix集成HBase</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/10/Phoenix%E9%9B%86%E6%88%90HBase/" class="article-date">
  <time datetime="2019-04-10T03:00:00.000Z" itemprop="datePublished">2019-04-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-Phoenix介绍"><a href="#一-Phoenix介绍" class="headerlink" title="一. Phoenix介绍"></a>一. Phoenix介绍</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;可以把Phoenix理解为Hbase的查询引擎，phoenix，由saleforce.com开源的一个项目，后又捐给了Apache。它相当于一个Java中间件，帮助开发者，像使用jdbc访问关系型数据库一些，访问NoSql数据库HBase。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;phoenix，操作的表及数据，存储在hbase上。phoenix只是需要和Hbase进行表关联起来。然后再用工具进行一些读或写操作。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;其实，可以把Phoenix只看成一种代替HBase的语法的一个工具。虽然可以用java可以用jdbc来连接phoenix，然后操作HBase，但是在生产环境中，不可以用在OLTP中。在线事务处理的环境中，需要低延迟，而Phoenix在查询HBase时，虽然做了一些优化，但<strong>延迟还是不小</strong>。所以依然是用在OLAT中，再将结果返回存储下来。</p>
<h3 id="二-安装"><a href="#二-安装" class="headerlink" title="二.安装"></a>二.安装</h3><h4 id="1-phoenix安装包解压缩，更换目录"><a href="#1-phoenix安装包解压缩，更换目录" class="headerlink" title="1.phoenix安装包解压缩，更换目录"></a>1.phoenix安装包解压缩，更换目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-phoenix-4.14.1-HBase-1.2-bin.tar.gz -C /opt/module</span><br><span class="line"></span><br><span class="line">mv apache-phoenix-4.14.1-HBase-1.2-bin phoenix-4.14.1</span><br></pre></td></tr></table></figure>
<h4 id="2-修改环境变量"><a href="#2-修改环境变量" class="headerlink" title="2.修改环境变量"></a>2.修改环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在最后两行加上如下phoenix配置</span></span><br><span class="line">export PHOENIX_HOME=/opt/module/phoenix-4.14.1</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:$PHOENIX_HOME/bin</span><br></pre></td></tr></table></figure>
<h4 id="3-使环境变量配置生效"><a href="#3-使环境变量配置生效" class="headerlink" title="3.使环境变量配置生效"></a>3.使环境变量配置生效</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<h4 id="4-将主节点的phoenix包传到从节点"><a href="#4-将主节点的phoenix包传到从节点" class="headerlink" title="4.将主节点的phoenix包传到从节点"></a>4.将主节点的phoenix包传到从节点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -r phoenix-4.14.1 root@bigdata13:/opt/module</span><br><span class="line"></span><br><span class="line">scp -r phoenix-4.14.1 root@bigdata12:/opt/module</span><br></pre></td></tr></table></figure>
<h4 id="5-拷贝hbase-site-xml（注）三台都要"><a href="#5-拷贝hbase-site-xml（注）三台都要" class="headerlink" title="5.拷贝hbase-site.xml（注）三台都要"></a>5.拷贝hbase-site.xml（注）三台都要</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp hbase-site.xml /opt/module/phoenix-4.14.1/bin/</span><br></pre></td></tr></table></figure>
<p>将如下两个jar包，目录在/opt/module/phoenix-4.14.1下，拷贝到hbase的lib目录，目录在/opt/module/hbase-1.3.1/lib/<br>（注）三台都要</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phoenix-4.10.0-HBase-1.2-server.jar</span><br><span class="line"></span><br><span class="line">phoenix-core-4.10.0-HBase-1.2.jar</span><br></pre></td></tr></table></figure>
<h4 id="6-启动Phoenix"><a href="#6-启动Phoenix" class="headerlink" title="6.启动Phoenix"></a>6.启动Phoenix</h4><p>配置好之后重启下hbase。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/sqlline.py bigdata11:2181</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTUxZGFkOGFiMDc0MThmNGYucG5n?x-oss-process=image/format,png"></p>
<h3 id="三-基本命令"><a href="#三-基本命令" class="headerlink" title="三.基本命令"></a>三.基本命令</h3><h4 id="1-展示表"><a href="#1-展示表" class="headerlink" title="1.展示表"></a>1.展示表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!table</span><br></pre></td></tr></table></figure>
<h4 id="2-创建表"><a href="#2-创建表" class="headerlink" title="2.创建表"></a>2.创建表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table test(id integer not null primary key,name varchar);</span><br><span class="line"></span><br><span class="line">create table &quot;Andy&quot;(</span><br><span class="line">id integer not null primary key,</span><br><span class="line">name varchar);</span><br></pre></td></tr></table></figure>
<h4 id="3-删除表"><a href="#3-删除表" class="headerlink" title="3.删除表"></a>3.删除表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table test;</span><br></pre></td></tr></table></figure>
<h4 id="4-插入数据"><a href="#4-插入数据" class="headerlink" title="4.插入数据"></a>4.插入数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">upsert into test values(1,&#x27;Andy&#x27;);</span><br><span class="line"></span><br><span class="line">upsert into users(name) values(&#x27;toms&#x27;);</span><br></pre></td></tr></table></figure>
<h4 id="5-查询数据"><a href="#5-查询数据" class="headerlink" title="5.查询数据"></a>5.查询数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phoenix &gt; select * from test;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase &gt; scan &#x27;test&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="6-退出phoenix"><a href="#6-退出phoenix" class="headerlink" title="6.退出phoenix"></a>6.退出phoenix</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!q</span><br></pre></td></tr></table></figure>
<h4 id="7-删除数据"><a href="#7-删除数据" class="headerlink" title="7.删除数据"></a>7.删除数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from &quot;Andy&quot; where id=4;</span><br></pre></td></tr></table></figure>
<h4 id="8-sum函数的使用"><a href="#8-sum函数的使用" class="headerlink" title="8.sum函数的使用"></a>8.sum函数的使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sum(id) from &quot;Andy&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="9-增加一列"><a href="#9-增加一列" class="headerlink" title="9.增加一列"></a>9.增加一列</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &quot;Andy&quot; add address varchar;</span><br></pre></td></tr></table></figure>
<h4 id="10-删除一列"><a href="#10-删除一列" class="headerlink" title="10.删除一列"></a>10.删除一列</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &quot;Andy&quot; drop column address;</span><br></pre></td></tr></table></figure>
<p>其他语法详见：<a target="_blank" rel="noopener" href="http://phoenix.apache.org/language/index.html">http://phoenix.apache.org/language/index.html</a></p>
<h3 id="四-表映射"><a href="#四-表映射" class="headerlink" title="四.表映射"></a>四.表映射</h3><h4 id="1-hbase中创建表"><a href="#1-hbase中创建表" class="headerlink" title="1.hbase中创建表"></a>1.hbase中创建表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create &#x27;teacher&#x27;,&#x27;info&#x27;,&#x27;contact&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="2-插入数据"><a href="#2-插入数据" class="headerlink" title="2.插入数据"></a>2.插入数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">put &#x27;teacher&#x27;,&#x27;1001&#x27;,&#x27;info:name&#x27;,&#x27;Jack&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1001&#x27;,&#x27;info:age&#x27;,&#x27;28&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1001&#x27;,&#x27;info:gender&#x27;,&#x27;male&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1001&#x27;,&#x27;contact:address&#x27;,&#x27;shanghai&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1001&#x27;,&#x27;contact:phone&#x27;,&#x27;13458646987&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1002&#x27;,&#x27;info:name&#x27;,&#x27;Jim&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1002&#x27;,&#x27;info:age&#x27;,&#x27;30&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1002&#x27;,&#x27;info:gender&#x27;,&#x27;male&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1002&#x27;,&#x27;contact:address&#x27;,&#x27;tianjian&#x27;</span><br><span class="line"></span><br><span class="line">put &#x27;teacher&#x27;,&#x27;1002&#x27;,&#x27;contact:phone&#x27;,&#x27;13512436987&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="3-在Phoenix创建映射表"><a href="#3-在Phoenix创建映射表" class="headerlink" title="3.在Phoenix创建映射表"></a>3.在Phoenix创建映射表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create view &quot;teacher&quot;(</span><br><span class="line"></span><br><span class="line">&quot;ROW&quot; varchar primary key,</span><br><span class="line"></span><br><span class="line">&quot;contact&quot;.&quot;address&quot; varchar,</span><br><span class="line"></span><br><span class="line">&quot;contact&quot;.&quot;phone&quot; varchar,</span><br><span class="line"></span><br><span class="line">&quot;info&quot;.&quot;age&quot;  varchar,</span><br><span class="line"></span><br><span class="line">&quot;info&quot;.&quot;gender&quot; varchar,</span><br><span class="line"></span><br><span class="line">&quot;info&quot;.&quot;name&quot; varchar</span><br><span class="line"></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="4-在Phoenix查找数据"><a href="#4-在Phoenix查找数据" class="headerlink" title="4.在Phoenix查找数据"></a>4.在Phoenix查找数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &quot;teacher&quot;;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase%E5%AE%9E%E6%88%98/" rel="tag">HBase实战</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Phoenix/" rel="tag">Phoenix</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase-MapReduce实战：利用MR将HDFS中的数据写入HBase中的fruit_mr2表"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/09/HBase-MapReduce%E5%AE%9E%E6%88%98%EF%BC%9A%E5%88%A9%E7%94%A8MR%E5%B0%86HDFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5HBase%E4%B8%AD%E7%9A%84fruit_mr2%E8%A1%A8/"
    >HBase-MapReduce实战：利用MR将HDFS中的数据写入HBase中的fruit_mr2表</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/09/HBase-MapReduce%E5%AE%9E%E6%88%98%EF%BC%9A%E5%88%A9%E7%94%A8MR%E5%B0%86HDFS%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5HBase%E4%B8%AD%E7%9A%84fruit_mr2%E8%A1%A8/" class="article-date">
  <time datetime="2019-04-09T06:00:00.000Z" itemprop="datePublished">2019-04-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-构建mapper"><a href="#1-构建mapper" class="headerlink" title="1.构建mapper"></a>1.构建mapper</h4><p>ReadFruitFromHDFSMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseMR.HDFSToHBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> ReadFruitFromHDFSMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO ReadFruitFromHDFSMapper功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 10:16 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadFruitFromHDFSMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//从HDFS中读取的数据</span></span><br><span class="line">        String lineValue = value.toString();</span><br><span class="line">        <span class="comment">//读取出来的每行数据使用\t进行分割，存于String数组</span></span><br><span class="line">        String[] values = lineValue.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据数据中值的含义取值</span></span><br><span class="line">        String rowKey = values[<span class="number">0</span>];</span><br><span class="line">        String name = values[<span class="number">1</span>];</span><br><span class="line">        String color = values[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化rowKey</span></span><br><span class="line">        ImmutableBytesWritable rowKeyWritable = <span class="keyword">new</span> ImmutableBytesWritable(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化put对象</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//参数分别:列族、列、值</span></span><br><span class="line">        put.add(Bytes.toBytes(<span class="string">&quot;info&quot;</span>), Bytes.toBytes(<span class="string">&quot;name&quot;</span>),  Bytes.toBytes(name));</span><br><span class="line">        put.add(Bytes.toBytes(<span class="string">&quot;info&quot;</span>), Bytes.toBytes(<span class="string">&quot;color&quot;</span>),  Bytes.toBytes(color));</span><br><span class="line"></span><br><span class="line">        context.write(rowKeyWritable, put);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-构建reducer"><a href="#2-构建reducer" class="headerlink" title="2.构建reducer"></a>2.构建reducer</h4><p>WriteFruitMRFromTxtReducer.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseMR.HDFSToHBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableReducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> WriteFruitMRFromTxtReducer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO WriteFruitMRFromTxtReducer功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 10:18 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteFruitMRFromTxtReducer</span> <span class="keyword">extends</span> <span class="title">TableReducer</span>&lt;<span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//读出来的每一行数据写入到fruit_hdfs表中</span></span><br><span class="line">        <span class="keyword">for</span>(Put put: values)&#123;</span><br><span class="line">            context.write(NullWritable.get(), put);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-构建runner"><a href="#3-构建runner" class="headerlink" title="3.构建runner"></a>3.构建runner</h4><p>Txt2FruitRunner.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseMR.HDFSToHBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configured;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Txt2FruitRunner</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO Txt2FruitRunner功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 10:19 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Txt2FruitRunner</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] strings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//得到Configuration</span></span><br><span class="line">        Configuration conf = <span class="keyword">this</span>.getConf();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建Job任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="keyword">this</span>.getClass().getSimpleName());</span><br><span class="line">        job.setJarByClass(Txt2FruitRunner.class);</span><br><span class="line">        Path inPath = <span class="keyword">new</span> Path(<span class="string">&quot;hdfs://hadoop2:9000/input_fruit/fruit.tsv&quot;</span>);</span><br><span class="line">        FileInputFormat.addInputPath(job, inPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置Mapper</span></span><br><span class="line">        job.setMapperClass(ReadFruitFromHDFSMapper.class);</span><br><span class="line">        job.setMapOutputKeyClass(ImmutableBytesWritable.class);</span><br><span class="line">        job.setMapOutputValueClass(Put.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置Reducer</span></span><br><span class="line">        TableMapReduceUtil.initTableReducerJob(<span class="string">&quot;fruit_mr2&quot;</span>, WriteFruitMRFromTxtReducer.class, job);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置Reduce数量，最少1个</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isSuccess = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (!isSuccess) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;Job running with error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSuccess ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = HBaseConfiguration.create();</span><br><span class="line">        <span class="keyword">int</span> status = ToolRunner.run(conf, <span class="keyword">new</span> Txt2FruitRunner(), args);</span><br><span class="line">        System.exit(status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-打包上传到Hbase集群并运行："><a href="#4-打包上传到Hbase集群并运行：" class="headerlink" title="4.打包上传到Hbase集群并运行："></a>4.打包上传到Hbase集群并运行：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hadoop-2.8.4/bin/yarn jar /opt/module/hbase-1.3.1/HBase-1.0-SNAPSHOT.jar  HBaseMR.HDFSToHBase.Txt2FruitRunner</span><br></pre></td></tr></table></figure>
<h4 id="5-查看结果："><a href="#5-查看结果：" class="headerlink" title="5.查看结果："></a>5.查看结果：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan &#x27;fruit_mr2&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTZjMzllZGIzZTc3MzFmYzcucG5n?x-oss-process=image/format,png" alt="结果"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase%E5%AE%9E%E6%88%98/" rel="tag">HBase实战</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase-MapReduce实战：利用MR将HBase中的fruit表导入到HBase中的fruit_mr表中"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/09/HBase-MapReduce%E5%AE%9E%E6%88%98%EF%BC%9A%E5%88%A9%E7%94%A8MR%E5%B0%86HBase%E4%B8%AD%E7%9A%84fruit%E8%A1%A8%E5%AF%BC%E5%85%A5%E5%88%B0HBase%E4%B8%AD%E7%9A%84fruit_mr%E8%A1%A8%E4%B8%AD/"
    >HBase-MapReduce实战：利用MR将HBase中的fruit表导入到HBase中的fruit_mr表中</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/09/HBase-MapReduce%E5%AE%9E%E6%88%98%EF%BC%9A%E5%88%A9%E7%94%A8MR%E5%B0%86HBase%E4%B8%AD%E7%9A%84fruit%E8%A1%A8%E5%AF%BC%E5%85%A5%E5%88%B0HBase%E4%B8%AD%E7%9A%84fruit_mr%E8%A1%A8%E4%B8%AD/" class="article-date">
  <time datetime="2019-04-09T05:00:00.000Z" itemprop="datePublished">2019-04-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-构建mapper类"><a href="#1-构建mapper类" class="headerlink" title="1.构建mapper类"></a>1.构建mapper类</h4><p>ReadFruitMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseMR.HBaseToHBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CellUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> ReadFruitMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 9:27 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadFruitMapper</span> <span class="keyword">extends</span> <span class="title">TableMapper</span>&lt;<span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(ImmutableBytesWritable key, Result value, Context context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//将fruit的name和color提取出来，相当于将每一行数据读取出来放入到Put对象中。</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(key.get());</span><br><span class="line">        <span class="comment">//遍历添加column行</span></span><br><span class="line">        <span class="keyword">for</span>(Cell cell: value.rawCells())&#123;</span><br><span class="line">            <span class="comment">//添加/克隆列族:info</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;info&quot;</span>.equals(Bytes.toString(CellUtil.cloneFamily(cell))))&#123;</span><br><span class="line">                <span class="comment">//添加/克隆列：name</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;name&quot;</span>.equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123;</span><br><span class="line">                    <span class="comment">//将该列cell加入到put对象中</span></span><br><span class="line">                    put.add(cell);</span><br><span class="line">                    <span class="comment">//添加/克隆列:color</span></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;color&quot;</span>.equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123;</span><br><span class="line">                    <span class="comment">//向该列cell加入到put对象中</span></span><br><span class="line">                    put.add(cell);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将从fruit读取到的每行数据写入到context中作为map的输出</span></span><br><span class="line">        context.write(key, put);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-构建reduce类"><a href="#2-构建reduce类" class="headerlink" title="2.构建reduce类"></a>2.构建reduce类</h4><p>WriteFruitMRReducer .java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseMR.HBaseToHBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableReducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> WriteFruitMRReducer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO WriteFruitMRReducer功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 9:29 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteFruitMRReducer</span> <span class="keyword">extends</span> <span class="title">TableReducer</span>&lt;<span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>,<span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//读出来的每一行数据写入到fruit_mr表中</span></span><br><span class="line">        <span class="keyword">for</span>(Put put: values)&#123;</span><br><span class="line">            context.write(NullWritable.get(), put);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-构建runner"><a href="#3-构建runner" class="headerlink" title="3.构建runner"></a>3.构建runner</h4><p>FruitToFruitMRRunner.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseMR.HBaseToHBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configured;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Scan;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> FruitToFruitMRRunner</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO FruitToFruitMRRunner功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 9:32 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitToFruitMRRunner</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] strings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//得到Configuration</span></span><br><span class="line">        Configuration conf = <span class="keyword">this</span>.getConf();</span><br><span class="line">        <span class="comment">//创建Job任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="keyword">this</span>.getClass().getSimpleName());</span><br><span class="line">        job.setJarByClass(FruitToFruitMRRunner.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置Job,创建一个扫描器</span></span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        scan.setCacheBlocks(<span class="keyword">false</span>);</span><br><span class="line">        scan.setCaching(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置Mapper，注意导入的是mapreduce包下的，不是mapred包下的，后者是老版本</span></span><br><span class="line">        TableMapReduceUtil.initTableMapperJob(</span><br><span class="line">                <span class="string">&quot;fruit&quot;</span>,</span><br><span class="line">                scan,</span><br><span class="line">                ReadFruitMapper.class,</span><br><span class="line">                ImmutableBytesWritable.class,</span><br><span class="line">                Put.class,</span><br><span class="line">                job</span><br><span class="line">        );</span><br><span class="line"><span class="comment">//        TableMapReduceUtil.initTableMapperJob(</span></span><br><span class="line"><span class="comment">//                &quot;fruit&quot;,  //读数据的表</span></span><br><span class="line"><span class="comment">//                scan,  //扫描器</span></span><br><span class="line"><span class="comment">//                ReadFruitMapper.class, //设置map类</span></span><br><span class="line"><span class="comment">//                ImmutableBytesWritable.class,  //设置输出的key类型</span></span><br><span class="line"><span class="comment">//                Put.class,  //设置Mapper输出value值类型</span></span><br><span class="line"><span class="comment">//                job  //配置的job</span></span><br><span class="line"><span class="comment">//        );</span></span><br><span class="line">        <span class="comment">//设置Reducer</span></span><br><span class="line">        TableMapReduceUtil.initTableReducerJob(</span><br><span class="line">                <span class="string">&quot;fruit_mr&quot;</span>,</span><br><span class="line">                WriteFruitMRReducer.class,</span><br><span class="line">                job);</span><br><span class="line"><span class="comment">//        TableMapReduceUtil.initTableReducerJob(</span></span><br><span class="line"><span class="comment">//                &quot;fruit_mr&quot;,  //将数据戏写入的表</span></span><br><span class="line"><span class="comment">//                WriteFruitMRReducer.class,  //设置reduce类</span></span><br><span class="line"><span class="comment">//                job);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置Reduce数量，最少1个</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isSuccess = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;Job running with error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSuccess ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = HBaseConfiguration.create();</span><br><span class="line">        <span class="keyword">int</span> status = ToolRunner.run(conf, <span class="keyword">new</span> FruitToFruitMRRunner(), args);</span><br><span class="line">        System.exit(status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-打包上传到HBase集群并运行"><a href="#4-打包上传到HBase集群并运行" class="headerlink" title="4.打包上传到HBase集群并运行"></a>4.打包上传到HBase集群并运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hadoop-2.8.4/bin/yarn jar /opt/module/hbase-1.3.1/HBase-1.0-SNAPSHOT.jar  HBaseMR.HBaseToHBase.FruitToFruitMRRunner</span><br></pre></td></tr></table></figure>
<p>提示：运行任务前，如果待数据导入的表不存在，则需要提前创建之</p>
<h4 id="5-查看结果："><a href="#5-查看结果：" class="headerlink" title="5.查看结果："></a>5.查看结果：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan &#x27;fruit_mr&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTUwNGNjMWMzZTE3NDc3MmQucG5n?x-oss-process=image/format,png" alt="结果"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase%E5%AE%9E%E6%88%98/" rel="tag">HBase实战</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase-MapReduce案例：统计表中数据，使用MapReduce将本地数据导入Hbase"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/09/HBase-MapReduce%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%BB%9F%E8%AE%A1%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%BF%E7%94%A8MapReduce%E5%B0%86%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5Hbase/"
    >HBase-MapReduce案例：统计表中数据，使用MapReduce将本地数据导入Hbase</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/09/HBase-MapReduce%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%BB%9F%E8%AE%A1%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%BF%E7%94%A8MapReduce%E5%B0%86%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5Hbase/" class="article-date">
  <time datetime="2019-04-09T04:00:00.000Z" itemprop="datePublished">2019-04-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-HBase的MapReduce任务过程"><a href="#一-HBase的MapReduce任务过程" class="headerlink" title="一.HBase的MapReduce任务过程"></a>一.HBase的MapReduce任务过程</h3><h4 id="1-查看HBase的MapReduce任务所需的依赖："><a href="#1-查看HBase的MapReduce任务所需的依赖：" class="headerlink" title="1.查看HBase的MapReduce任务所需的依赖："></a>1.查看HBase的MapReduce任务所需的依赖：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hbase-1.3.1</span><br><span class="line"></span><br><span class="line">bin/hbase mapredcp</span><br></pre></td></tr></table></figure>

<h4 id="2-执行环境变量的导入"><a href="#2-执行环境变量的导入" class="headerlink" title="2.执行环境变量的导入"></a>2.执行环境变量的导入</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HBASE_HOME=/opt/module/hbase-1.3.1</span><br><span class="line">export HADOOP_CLASSPATH=`$&#123;HBASE_HOME&#125;/bin/hbase mapredcp`</span><br></pre></td></tr></table></figure>
<h4 id="3-运行官方的MapReduce任务"><a href="#3-运行官方的MapReduce任务" class="headerlink" title="3.运行官方的MapReduce任务"></a>3.运行官方的MapReduce任务</h4><h3 id="二-案例一：统计default-student表中有多少行数据"><a href="#二-案例一：统计default-student表中有多少行数据" class="headerlink" title="二.案例一：统计default:student表中有多少行数据"></a>二.案例一：统计default:student表中有多少行数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hbase-1.3.1</span><br><span class="line"></span><br><span class="line">/opt/module/hadoop-2.8.4/bin/yan jar lib/hbase-server-1.3.1.jar rowcounter default:student</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWZjM2U1YjljNjkzYTMyYzcucG5n?x-oss-process=image/format,png" alt="命令"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQ5OTMxOWQyMWM5OThiM2QucG5n?x-oss-process=image/format,png" alt="结果"></p>
<h3 id="三-案例二：使用MapReduce将本地数据导入到HBase"><a href="#三-案例二：使用MapReduce将本地数据导入到HBase" class="headerlink" title="三.案例二：使用MapReduce将本地数据导入到HBase"></a>三.案例二：使用MapReduce将本地数据导入到HBase</h3><h5 id="1-在本地创建一个tsv格式的文件：fruit-tsv，自己建表用-t分割数据"><a href="#1-在本地创建一个tsv格式的文件：fruit-tsv，自己建表用-t分割数据" class="headerlink" title="(1) 在本地创建一个tsv格式的文件：fruit.tsv，自己建表用\t分割数据"></a>(1) 在本地创建一个tsv格式的文件：fruit.tsv，自己建表用\t分割数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1001	Apple	Red</span><br><span class="line">1002	Pear	Yellow</span><br><span class="line">1003	Pineapple	Yellow</span><br></pre></td></tr></table></figure>
<p>尖叫提示：上面的这个数据不要从word中直接复制，有格式错误</p>
<h5 id="2-创建HBase表"><a href="#2-创建HBase表" class="headerlink" title="(2) 创建HBase表"></a>(2) 创建HBase表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; create &#x27;fruit&#x27;,&#x27;info&#x27;</span><br></pre></td></tr></table></figure>
<h5 id="3-在HDFS中创建input-fruit文件夹并上传fruit-tsv文件"><a href="#3-在HDFS中创建input-fruit文件夹并上传fruit-tsv文件" class="headerlink" title="(3) 在HDFS中创建input_fruit文件夹并上传fruit.tsv文件"></a>(3) 在HDFS中创建input_fruit文件夹并上传fruit.tsv文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir /input_fruit/</span><br><span class="line">hdfs dfs -put fruit.tsv /input_fruit/</span><br></pre></td></tr></table></figure>
<h5 id="4-执行MapReduce到HBase的fruit表中"><a href="#4-执行MapReduce到HBase的fruit表中" class="headerlink" title="(4) 执行MapReduce到HBase的fruit表中"></a>(4) 执行MapReduce到HBase的fruit表中</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hadoop-2.8.4/bin/yarn jar lib/hbase-server-1.3.1.jar importtsv \</span><br><span class="line">-Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit \</span><br><span class="line">hdfs://hadoop2:9000/input_fruit</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTIxMDlhZTc5MGNjOTlmMzkucG5n?x-oss-process=image/format,png" alt="执行"></p>
<h5 id="5-使用scan命令查看导入后的结果"><a href="#5-使用scan命令查看导入后的结果" class="headerlink" title="(5) 使用scan命令查看导入后的结果"></a>(5) 使用scan命令查看导入后的结果</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; scan &#x27;fruit&#x27; </span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTk0OGNiNTkwY2Y2NWJhNDAucG5n?x-oss-process=image/format,png" alt="结果"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase%E5%AE%9E%E6%88%98/" rel="tag">HBase实战</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase工具类"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/09/HBase%E5%B7%A5%E5%85%B7%E7%B1%BB/"
    >HBase工具类</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/09/HBase%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="article-date">
  <time datetime="2019-04-09T03:00:00.000Z" itemprop="datePublished">2019-04-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h6 id="1-HBASEUtil-java"><a href="#1-HBASEUtil-java" class="headerlink" title="1.HBASEUtil.java"></a>1.HBASEUtil.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HColumnDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HTableDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.NamespaceDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Admin;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Connection;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.HBaseAdmin;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> HBASEUTIL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO HBASEUTIL功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 8:04 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBASEUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建命名</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">create_Namecpace</span><span class="params">(Configuration conf,String namecpace)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取hbase的客户端</span></span><br><span class="line">        Connection connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">        HBaseAdmin admin = (HBaseAdmin) connection.getAdmin();</span><br><span class="line">        <span class="comment">//创建命名描述器</span></span><br><span class="line">        NamespaceDescriptor namespaceDescriptor = NamespaceDescriptor.create(namecpace).</span><br><span class="line">                addConfiguration(<span class="string">&quot;author&quot;</span>,<span class="string">&quot;plus&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建命名空间</span></span><br><span class="line">        admin.createNamespace(namespaceDescriptor);</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化命名空间&quot;</span>);</span><br><span class="line">        close(admin, connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭资源</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Admin admin, Connection connection)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (admin != <span class="keyword">null</span>) &#123;</span><br><span class="line">            admin.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建HBase的表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> regions</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(Configuration conf, String tableName, <span class="keyword">int</span> regions, String... columnFamily)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">        Admin admin = connection.getAdmin();</span><br><span class="line">        <span class="comment">//判断表</span></span><br><span class="line">        <span class="keyword">if</span> (isExistTable(conf, tableName)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//表描述器 HTableDescriptor</span></span><br><span class="line"></span><br><span class="line">        HTableDescriptor htd = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(tableName));</span><br><span class="line">        <span class="keyword">for</span> (String cf : columnFamily) &#123;</span><br><span class="line">        <span class="comment">//列描述器 ：HColumnDescriptor</span></span><br><span class="line">            htd.addFamily(<span class="keyword">new</span> HColumnDescriptor(cf));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//htd.addCoprocessor(&quot;hbase.CalleeWriteObserver&quot;);</span></span><br><span class="line">        <span class="comment">//创建表</span></span><br><span class="line">        admin.createTable(htd,genSplitKeys(regions));</span><br><span class="line">        System.out.println(<span class="string">&quot;已建表&quot;</span>);</span><br><span class="line">        <span class="comment">//关闭对象</span></span><br><span class="line">        close(admin,connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分区键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> regions region个数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> splitKeys</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[][] genSplitKeys(<span class="keyword">int</span> regions) &#123;</span><br><span class="line">        <span class="comment">//存放分区键的数组</span></span><br><span class="line">        String[] keys = <span class="keyword">new</span> String[regions];</span><br><span class="line">        <span class="comment">//格式化分区键的形式  00 01 02</span></span><br><span class="line">        DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;000&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; regions; i++) &#123;</span><br><span class="line">            keys[i] = df.format(i*<span class="number">10</span>) + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[][] splitKeys = <span class="keyword">new</span> <span class="keyword">byte</span>[regions][];</span><br><span class="line">        <span class="comment">//排序 保证你这个分区键是有序得</span></span><br><span class="line">        TreeSet&lt;<span class="keyword">byte</span>[]&gt; treeSet = <span class="keyword">new</span> TreeSet&lt;<span class="keyword">byte</span>[]&gt;(Bytes.BYTES_COMPARATOR);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; regions; i++) &#123;</span><br><span class="line">            treeSet.add(Bytes.toBytes(keys[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出</span></span><br><span class="line">        Iterator&lt;<span class="keyword">byte</span>[]&gt; iterator = treeSet.iterator();</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] next = iterator.next();</span><br><span class="line">            splitKeys[index++]= next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> splitKeys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断表是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conf      配置 conf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isExistTable</span><span class="params">(Configuration conf, String tableName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">        Admin admin = connection.getAdmin();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> result = admin.tableExists(TableName.valueOf(tableName));</span><br><span class="line">        close(admin, connection);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-HBaseDAO-java"><a href="#2-HBaseDAO-java" class="headerlink" title="2.HBaseDAO.java"></a>2.HBaseDAO.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> HBaseDAO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 8:06 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBaseDAO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String namespace = PropertiesUtil.getProperty(<span class="string">&quot;hbase.calllog.namespace&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String tableName = PropertiesUtil.getProperty(<span class="string">&quot;hbase.calllog.tablename&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer regions = Integer.valueOf(PropertiesUtil.getProperty(<span class="string">&quot;hbase.calllog.regions&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = HBaseConfiguration.create();</span><br><span class="line">        conf.set(<span class="string">&quot;hbase.zookeeper.property.clientPort&quot;</span>, <span class="string">&quot;2181&quot;</span>);</span><br><span class="line">        conf.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;hadoop2&quot;</span>);</span><br><span class="line">        conf.set(<span class="string">&quot;zookeeper.znode.parent&quot;</span>, <span class="string">&quot;/hbase&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!HBASEUtil.isExistTable(conf, tableName)) &#123;</span><br><span class="line">            HBASEUtil.create_Namecpace(conf, namespace);</span><br><span class="line">            HBASEUtil.createTable(conf, tableName, regions, <span class="string">&quot;f1&quot;</span>, <span class="string">&quot;f2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="3-PropertiesUtil-java"><a href="#3-PropertiesUtil-java" class="headerlink" title="3.PropertiesUtil.java"></a>3.PropertiesUtil.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBaseUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> PropertiesUtil</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@MethodDesc</span>: TODO PropertiesUtil功能介绍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Movle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 5/10/20 8:07 下午</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> movle_xjk@foxmail.com</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Properties properties = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//获取配置文件、方便维护</span></span><br><span class="line">        InputStream is = ClassLoader.getSystemResourceAsStream(<span class="string">&quot;hbase_consumer.properties&quot;</span>);</span><br><span class="line">        properties = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取参数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 名字</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 参数值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getProperty</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties.getProperty(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="4-hbase-consumer-properties"><a href="#4-hbase-consumer-properties" class="headerlink" title="4.hbase_consumer.properties"></a>4.hbase_consumer.properties</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase.calllog.namespace=plus</span><br><span class="line">hbase.calllog.tablename=plus:split</span><br><span class="line">hbase.calllog.regions=5</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase之API"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/08/HBase%E4%B9%8BAPI/"
    >HBase之API</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/08/HBase%E4%B9%8BAPI/" class="article-date">
  <time datetime="2019-04-08T08:00:00.000Z" itemprop="datePublished">2019-04-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="0-用途"><a href="#0-用途" class="headerlink" title="0.用途"></a>0.用途</h4><p>通过HBase的相关JavaAPI可以实现伴随HBase操作的MapReduce过程，比如使用MapReduce将数据从本地文件系统导入到HBase的表中，比如从HBase中读取一些原始数据后使用MapReduce做数据分析</p>
<h4 id="1-pom-xml"><a href="#1-pom-xml" class="headerlink" title="1.pom.xml"></a>1.pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-编写HBaseAPI"><a href="#2-编写HBaseAPI" class="headerlink" title="2.编写HBaseAPI"></a>2.编写HBaseAPI</h4><h5 id="1-获取Configuration对象"><a href="#1-获取Configuration对象" class="headerlink" title="(1)获取Configuration对象"></a>(1)获取Configuration对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Configuration conf;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">	<span class="comment">//使用HBaseConfiguration的单例方法实例化</span></span><br><span class="line">	conf = HBaseConfiguration.create();</span><br><span class="line">    conf.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;bigdata111&quot;</span>);</span><br><span class="line">    conf.set(<span class="string">&quot;hbase.zookeeper.property.clientPort&quot;</span>, <span class="string">&quot;2181&quot;</span>);</span><br><span class="line">	conf.set(<span class="string">&quot;zookeeper.znode.parent&quot;</span>, <span class="string">&quot;/hbase&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-判断表是否存在"><a href="#2-判断表是否存在" class="headerlink" title="(2)判断表是否存在"></a>(2)判断表是否存在</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isTableExist</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> MasterNotRunningException, ZooKeeperConnectionException, IOException</span>&#123;</span><br><span class="line">	<span class="comment">//在HBase中管理、访问表需要先创建HBaseAdmin对象</span></span><br><span class="line">    Connection connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">    HBaseAdmin admin = (HBaseAdmin) connection.getAdmin();</span><br><span class="line">	<span class="comment">//HBaseAdmin admin = new HBaseAdmin(conf);</span></span><br><span class="line">	<span class="keyword">return</span> admin.tableExists(tableName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-创建表"><a href="#3-创建表" class="headerlink" title="(3)创建表"></a>(3)创建表</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(String tableName, String... columnFamily)</span> <span class="keyword">throws</span> MasterNotRunningException, ZooKeeperConnectionException, IOException</span>&#123;</span><br><span class="line">	HBaseAdmin admin = <span class="keyword">new</span> HBaseAdmin(conf);</span><br><span class="line">	<span class="comment">//判断表是否存在</span></span><br><span class="line">	<span class="keyword">if</span>(isTableExist(tableName))&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;表&quot;</span> + tableName + <span class="string">&quot;已存在&quot;</span>);</span><br><span class="line">		<span class="comment">//System.exit(0);</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//创建表属性对象,表名需要转字节</span></span><br><span class="line">		HTableDescriptor descriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(tableName));</span><br><span class="line">		<span class="comment">//创建多个列族</span></span><br><span class="line">		<span class="keyword">for</span>(String cf : columnFamily)&#123;</span><br><span class="line">			descriptor.addFamily(<span class="keyword">new</span> HColumnDescriptor(cf));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//根据对表的配置，创建表</span></span><br><span class="line">		admin.createTable(descriptor);</span><br><span class="line">		System.out.println(<span class="string">&quot;表&quot;</span> + tableName + <span class="string">&quot;创建成功！&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-删除表"><a href="#4-删除表" class="headerlink" title="(4)删除表"></a>(4)删除表</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dropTable</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	HBaseAdmin admin = <span class="keyword">new</span> HBaseAdmin(conf);</span><br><span class="line">	<span class="keyword">if</span>(isTableExist(tableName))&#123;</span><br><span class="line">		admin.disableTable(tableName);</span><br><span class="line">		admin.deleteTable(tableName);</span><br><span class="line">		System.out.println(<span class="string">&quot;表&quot;</span> + tableName + <span class="string">&quot;删除成功！&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;表&quot;</span> + tableName + <span class="string">&quot;不存在！&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-向表中插入数据"><a href="#5-向表中插入数据" class="headerlink" title="(5)向表中插入数据"></a>(5)向表中插入数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addRowData</span><span class="params">(String tableName, String rowKey, String columnFamily, String column, String value)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	<span class="comment">//创建HTable对象</span></span><br><span class="line">	HTable hTable = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">	<span class="comment">//向表中插入数据</span></span><br><span class="line">	Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">	<span class="comment">//向Put对象中组装数据</span></span><br><span class="line">	put.add(Bytes.toBytes(columnFamily), Bytes.toBytes(column), Bytes.toBytes(value));</span><br><span class="line">	hTable.put(put);</span><br><span class="line">	hTable.close();</span><br><span class="line">	System.out.println(<span class="string">&quot;插入数据成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-删除多行数据"><a href="#6-删除多行数据" class="headerlink" title="(6)删除多行数据"></a>(6)删除多行数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addRowData</span><span class="params">(String tableName, String rowKey, String columnFamily, String column, String value)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	<span class="comment">//创建HTable对象</span></span><br><span class="line">	HTable hTable = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">	<span class="comment">//向表中插入数据</span></span><br><span class="line">	Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">	<span class="comment">//向Put对象中组装数据</span></span><br><span class="line">	put.add(Bytes.toBytes(columnFamily), Bytes.toBytes(column), Bytes.toBytes(value));</span><br><span class="line">	hTable.put(put);</span><br><span class="line">	hTable.close();</span><br><span class="line">	System.out.println(<span class="string">&quot;插入数据成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="7-得到所有数据"><a href="#7-得到所有数据" class="headerlink" title="(7)得到所有数据"></a>(7)得到所有数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addRowData</span><span class="params">(String tableName, String rowKey, String columnFamily, String column, String value)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	<span class="comment">//创建HTable对象</span></span><br><span class="line">	HTable hTable = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">	<span class="comment">//向表中插入数据</span></span><br><span class="line">	Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">	<span class="comment">//向Put对象中组装数据</span></span><br><span class="line">	put.add(Bytes.toBytes(columnFamily), Bytes.toBytes(column), Bytes.toBytes(value));</span><br><span class="line">	hTable.put(put);</span><br><span class="line">	hTable.close();</span><br><span class="line">	System.out.println(<span class="string">&quot;插入数据成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="8-得到某一行所有数据"><a href="#8-得到某一行所有数据" class="headerlink" title="(8)得到某一行所有数据"></a>(8)得到某一行所有数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getRow</span><span class="params">(String tableName, String rowKey)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">	HTable table = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">	Get get = <span class="keyword">new</span> Get(Bytes.toBytes(rowKey));</span><br><span class="line">	<span class="comment">//get.setMaxVersions();显示所有版本</span></span><br><span class="line">    <span class="comment">//get.setTimeStamp();显示指定时间戳的版本</span></span><br><span class="line">	Result result = table.get(get);</span><br><span class="line">	<span class="keyword">for</span>(Cell cell : result.rawCells())&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;行键:&quot;</span> + Bytes.toString(result.getRow()));</span><br><span class="line">		System.out.println(<span class="string">&quot;列族&quot;</span> + Bytes.toString(CellUtil.cloneFamily(cell)));</span><br><span class="line">		System.out.println(<span class="string">&quot;列:&quot;</span> + Bytes.toString(CellUtil.cloneQualifier(cell)));</span><br><span class="line">		System.out.println(<span class="string">&quot;值:&quot;</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">		System.out.println(<span class="string">&quot;时间戳:&quot;</span> + cell.getTimestamp());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="9-获取某一行指定”列族-列”的数据"><a href="#9-获取某一行指定”列族-列”的数据" class="headerlink" title="(9)获取某一行指定”列族:列”的数据"></a>(9)获取某一行指定”列族:列”的数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getRowQualifier</span><span class="params">(String tableName, String rowKey, String family, String qualifier)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">	HTable table = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">	Get get = <span class="keyword">new</span> Get(Bytes.toBytes(rowKey));</span><br><span class="line">	get.addColumn(Bytes.toBytes(family), Bytes.toBytes(qualifier));</span><br><span class="line">	Result result = table.get(get);</span><br><span class="line">	<span class="keyword">for</span>(Cell cell : result.rawCells())&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;行键:&quot;</span> + Bytes.toString(result.getRow()));</span><br><span class="line">		System.out.println(<span class="string">&quot;列族&quot;</span> + Bytes.toString(CellUtil.cloneFamily(cell)));</span><br><span class="line">		System.out.println(<span class="string">&quot;列:&quot;</span> + Bytes.toString(CellUtil.cloneQualifier(cell)));</span><br><span class="line">		System.out.println(<span class="string">&quot;值:&quot;</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="10-完整代码HBASE-API-java"><a href="#10-完整代码HBASE-API-java" class="headerlink" title="(10)完整代码HBASE_API.java"></a>(10)完整代码HBASE_API.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HBase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBASE_API</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取配置文件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Configuration conf = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//使用hbaseconfiguration获取conf</span></span><br><span class="line">        conf = HBaseConfiguration.create();</span><br><span class="line">        <span class="comment">//注意使用主机名之前，确保win的hosts配置文件中配置Linux对应的ip和主机名的映射</span></span><br><span class="line">        conf.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>,<span class="string">&quot;192.168.31.132&quot;</span>);</span><br><span class="line">        conf.set(<span class="string">&quot;hbase.zookeeper.property.clientPort&quot;</span>, <span class="string">&quot;2181&quot;</span>);</span><br><span class="line">        conf.set(<span class="string">&quot;zookeeper.znode.parent&quot;</span>, <span class="string">&quot;/hbase&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断表是否存在</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">is_table_exists</span><span class="params">(String table_Name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建hbase的客户端</span></span><br><span class="line">        Connection connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">        HBaseAdmin admin = (HBaseAdmin) connection.getAdmin();</span><br><span class="line">        <span class="comment">//2.判断表是否存在meta</span></span><br><span class="line">        <span class="keyword">return</span> admin.tableExists(Bytes.toBytes(table_Name));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//System.out.println(is_table_exists(&quot;aa&quot;));;</span></span><br><span class="line">        <span class="comment">//create_table(&quot;idea1&quot;,&quot;cf1&quot;,&quot;cf2&quot;,&quot;cf3&quot;);</span></span><br><span class="line"><span class="comment">//        for (int i = 0;i&lt;100;i++)&#123;</span></span><br><span class="line"><span class="comment">//            put_table(&quot;idea1&quot;,String.valueOf(i),&quot;cf1&quot;,&quot;name&quot;,&quot;plus&quot;+i);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        scan_table(<span class="string">&quot;idea1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建表:表名，列簇可以是多个</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">create_table</span><span class="params">(String table_name,String... columnFamily)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建hbase的客户端</span></span><br><span class="line">        Connection connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">        HBaseAdmin admin = (HBaseAdmin) connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(is_table_exists(table_name))&#123;</span><br><span class="line">            System.out.println(table_name+<span class="string">&quot;已存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//创建表,创建一个表描述对象</span></span><br><span class="line">            HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(table_name));</span><br><span class="line">            <span class="comment">//创建列簇</span></span><br><span class="line">            <span class="keyword">for</span> (String cf : columnFamily)&#123;</span><br><span class="line">                hTableDescriptor.addFamily(<span class="keyword">new</span> HColumnDescriptor(cf));</span><br><span class="line">            &#125;</span><br><span class="line">            admin.createTable(hTableDescriptor);</span><br><span class="line">            System.out.println(table_name+<span class="string">&quot;创建成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入数据:表名，rowkey，列簇，列，value</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">put_table</span><span class="params">(String name,String row,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 String columnfamily,String column,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 String value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//创建Htable</span></span><br><span class="line">        HTable hTable = <span class="keyword">new</span> HTable(conf, name);</span><br><span class="line">        <span class="comment">//创建put对象</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(row));</span><br><span class="line">        <span class="comment">//添加列簇、列、数据</span></span><br><span class="line">        put.add(Bytes.toBytes(columnfamily),Bytes.toBytes(column),Bytes.toBytes(value));</span><br><span class="line">        hTable.put(put);</span><br><span class="line">        hTable.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扫描数据</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scan_table</span><span class="params">(String table_Name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HTable hTable = <span class="keyword">new</span> HTable(conf, table_Name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个scan扫描region</span></span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        <span class="comment">//用htable创建resultScanner对象</span></span><br><span class="line">        ResultScanner scanner = hTable.getScanner(scan);</span><br><span class="line">        <span class="keyword">for</span> (Result result: scanner)&#123;</span><br><span class="line">            Cell[] cells = result.rawCells();</span><br><span class="line">            <span class="keyword">for</span> (Cell cell:cells)&#123;</span><br><span class="line">                System.out.println(Bytes.toString(CellUtil.cloneRow(cell))+<span class="string">&quot;\t&quot;</span>+</span><br><span class="line">                        Bytes.toString(CellUtil.cloneFamily(cell))+<span class="string">&quot;,&quot;</span>+</span><br><span class="line">                        Bytes.toString(CellUtil.cloneQualifier(cell))+<span class="string">&quot;,&quot;</span>+</span><br><span class="line">                        Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteMultiRow</span><span class="params">(String tableName,String... rows)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HTable hTable = <span class="keyword">new</span> HTable(conf,tableName);</span><br><span class="line">        List&lt;Delete&gt; deleteList = <span class="keyword">new</span> ArrayList&lt;Delete&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(String row:rows)&#123;</span><br><span class="line">            Delete delete = <span class="keyword">new</span> Delete(Bytes.toBytes(row));</span><br><span class="line">            </span><br><span class="line">            deleteList.add(delete);</span><br><span class="line">        &#125;</span><br><span class="line">        hTable.delete(deleteList);</span><br><span class="line">        hTable.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase优化"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/08/HBase%E4%BC%98%E5%8C%96/"
    >HBase优化</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/08/HBase%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2019-04-08T07:00:00.000Z" itemprop="datePublished">2019-04-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-高可用"><a href="#1-高可用" class="headerlink" title="1.高可用"></a>1.高可用</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;在HBase中Hmaster负责监控RegionServer的生命周期，均衡RegionServer的负载，如果Hmaster挂掉了，那么整个HBase集群将陷入不健康的状态，并且此时的工作状态并不会维持太久。所以HBase支持对Hmaster的高可用配置。</p>
<h5 id="1-关闭HBase集群-如果没有开启则跳过此步"><a href="#1-关闭HBase集群-如果没有开启则跳过此步" class="headerlink" title="(1).关闭HBase集群(如果没有开启则跳过此步)"></a>(1).关闭HBase集群(如果没有开启则跳过此步)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/stop-hbase.sh</span></span><br></pre></td></tr></table></figure>

<h5 id="2-在conf目录下创建backup-masters文件"><a href="#2-在conf目录下创建backup-masters文件" class="headerlink" title="(2).在conf目录下创建backup-masters文件"></a>(2).在conf目录下创建backup-masters文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> touch conf/backup-masters</span></span><br></pre></td></tr></table></figure>
<h5 id="3-在backup-masters文件中配置高可用HMaster节点"><a href="#3-在backup-masters文件中配置高可用HMaster节点" class="headerlink" title="(3).在backup-masters文件中配置高可用HMaster节点"></a>(3).在backup-masters文件中配置高可用HMaster节点</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> hadoop2 &gt;  conf/backup-masters</span></span><br></pre></td></tr></table></figure>
<h5 id="4-将整个conf目录scp到其他节点"><a href="#4-将整个conf目录scp到其他节点" class="headerlink" title="(4).将整个conf目录scp到其他节点"></a>(4).将整个conf目录scp到其他节点</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> scp -r conf/ hadoop2:/opt/module/hbase-1.3.1</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r conf/ hadoop3:/opt/module/hbase-1.3.1</span></span><br></pre></td></tr></table></figure>

<h5 id="5-重新启动HBase后打开页面测试查看"><a href="#5-重新启动HBase后打开页面测试查看" class="headerlink" title="(5).重新启动HBase后打开页面测试查看"></a>(5).重新启动HBase后打开页面测试查看</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;0.98版本之后：<a target="_blank" rel="noopener" href="http://bigdata111:16010/">http://bigdata111:16010</a></p>
<h4 id="2-Hadoop的通用性优化"><a href="#2-Hadoop的通用性优化" class="headerlink" title="2.Hadoop的通用性优化"></a>2.Hadoop的通用性优化</h4><h5 id="1-NameNode元数据备份使用SSD"><a href="#1-NameNode元数据备份使用SSD" class="headerlink" title="(1).NameNode元数据备份使用SSD"></a>(1).NameNode元数据备份使用SSD</h5><h5 id="2-定时备份NameNode上的元数据"><a href="#2-定时备份NameNode上的元数据" class="headerlink" title="(2).定时备份NameNode上的元数据"></a>(2).定时备份NameNode上的元数据</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;每小时或者每天备份，如果数据极其重要，可以5~10分钟备份一次。备份可以通过定时任务复制元数据目录即可。</p>
<h5 id="3-为NameNode指定多个元数据目录"><a href="#3-为NameNode指定多个元数据目录" class="headerlink" title="(3).为NameNode指定多个元数据目录"></a>(3).为NameNode指定多个元数据目录</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;使用dfs.name.dir或者dfs.namenode.name.dir指定。这样可以提供元数据的冗余和健壮性，以免发生故障。</p>
<h5 id="4-NameNode的dir自恢复"><a href="#4-NameNode的dir自恢复" class="headerlink" title="(4).NameNode的dir自恢复"></a>(4).NameNode的dir自恢复</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;设置dfs.namenode.name.dir.restore为true，允许尝试恢复之前失败的dfs.namenode.name.dir目录，在创建checkpoint时做此尝试，如果设置了多个磁盘，建议允许。</p>
<h5 id="5-HDFS保证RPC调用会有较多的线程数"><a href="#5-HDFS保证RPC调用会有较多的线程数" class="headerlink" title="(5).HDFS保证RPC调用会有较多的线程数"></a>(5).HDFS保证RPC调用会有较多的线程数</h5><p>hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.namenode.handler.count</span><br><span class="line"></span><br><span class="line">解释：该属性是NameNode服务默认线程数，的默认值是10，根据机器的可用内存可以调整为50~100</span><br><span class="line"></span><br><span class="line">属性：dfs.datanode.handler.count</span><br><span class="line"></span><br><span class="line">解释：该属性默认值为10，是DataNode的处理线程数，如果HDFS客户端程序读写请求比较多，可以调高到15~20，设置的值越大，内存消耗越多，不要调整的过高，一般业务中，5~10即可。</span><br></pre></td></tr></table></figure>
<h5 id="6-HDFS副本数的调整"><a href="#6-HDFS副本数的调整" class="headerlink" title="(6).HDFS副本数的调整"></a>(6).HDFS副本数的调整</h5><p>hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.replication</span><br><span class="line"></span><br><span class="line">解释：如果数据量巨大，且不是非常之重要，可以调整为2~3，如果数据非常之重要，可以调整为3~5。</span><br></pre></td></tr></table></figure>
<h5 id="7-HDFS文件块大小的调整"><a href="#7-HDFS文件块大小的调整" class="headerlink" title="(7).HDFS文件块大小的调整"></a>(7).HDFS文件块大小的调整</h5><p>hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.blocksize</span><br><span class="line"></span><br><span class="line">解释：块大小定义，该属性应该根据存储的大量的单个文件大小来设置，如果大量的单个文件都小于100M，建议设置成64M块大小，对于大于100M或者达到GB的这种情况，建议设置成256M，一般设置范围波动在64M~256M之间。</span><br></pre></td></tr></table></figure>
<h5 id="8-MapReduce-Job任务服务线程数调整"><a href="#8-MapReduce-Job任务服务线程数调整" class="headerlink" title="(8).MapReduce Job任务服务线程数调整"></a>(8).MapReduce Job任务服务线程数调整</h5><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：mapreduce.jobtracker.handler.count</span><br><span class="line"></span><br><span class="line">解释：该属性是Job任务线程数，默认值是10，根据机器的可用内存可以调整为50~100</span><br></pre></td></tr></table></figure>
<h5 id="9-Http服务器工作线程数"><a href="#9-Http服务器工作线程数" class="headerlink" title="(9).Http服务器工作线程数"></a>(9).Http服务器工作线程数</h5><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：mapreduce.tasktracker.http.threads</span><br><span class="line"></span><br><span class="line">解释：定义HTTP服务器工作线程数，默认值为40，对于大集群可以调整到80~100</span><br></pre></td></tr></table></figure>
<h5 id="10-文件排序合并优化"><a href="#10-文件排序合并优化" class="headerlink" title="(10).文件排序合并优化"></a>(10).文件排序合并优化</h5><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：mapreduce.task.io.sort.factor</span><br><span class="line"></span><br><span class="line">解释：文件排序时同时合并的数据流的数量，这也定义了同时打开文件的个数，默认值为10，如果调高该参数，可以明显减少磁盘IO，即减少文件读取的次数。</span><br></pre></td></tr></table></figure>
<h5 id="11-设置任务并发"><a href="#11-设置任务并发" class="headerlink" title="(11).设置任务并发"></a>(11).设置任务并发</h5><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：mapreduce.map.speculative</span><br><span class="line"></span><br><span class="line">解释：该属性可以设置任务是否可以并发执行，如果任务多而小，该属性设置为true可以明显加快任务执行效率，但是对于延迟非常高的任务，建议改为false，这就类似于迅雷下载。</span><br></pre></td></tr></table></figure>
<h5 id="12-MR输出数据的压缩"><a href="#12-MR输出数据的压缩" class="headerlink" title="(12).MR输出数据的压缩"></a>(12).MR输出数据的压缩</h5><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：mapreduce.map.output.compress、mapreduce.output.fileoutputformat.compress</span><br><span class="line"></span><br><span class="line">解释：对于大集群而言，建议设置Map-Reduce的输出为压缩的数据，而对于小集群，则不需要。</span><br></pre></td></tr></table></figure>
<h5 id="13-优化Mapper和Reducer的个数"><a href="#13-优化Mapper和Reducer的个数" class="headerlink" title="(13).优化Mapper和Reducer的个数"></a>(13).优化Mapper和Reducer的个数</h5><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">属性：</span><br><span class="line"></span><br><span class="line">mapreduce.tasktracker.map.tasks.maximum</span><br><span class="line"></span><br><span class="line">mapreduce.tasktracker.reduce.tasks.maximum</span><br><span class="line"></span><br><span class="line">解释：以上两个属性分别为一个单独的Job任务可以同时运行的Map和Reduce的数量。</span><br><span class="line"></span><br><span class="line">设置上面两个参数时，需要考虑CPU核数、磁盘和内存容量。假设一个8核的CPU，业务内容非常消耗CPU，那么可以设置map数量为4，如果该业务不是特别消耗CPU类型的，那么可以设置map数量为40，reduce数量为20。这些参数的值修改完成之后，一定要观察是否有较长等待的任务，如果有的话，可以减少数量以加快任务执行，如果设置一个很大的值，会引起大量的上下文切换，以及内存与磁盘之间的数据交换，这里没有标准的配置数值，需要根据业务和硬件配置以及经验来做出选择。</span><br><span class="line"></span><br><span class="line">在同一时刻，不要同时运行太多的MapReduce，这样会消耗过多的内存，任务会执行的非常缓慢，我们需要根据CPU核数，内存容量设置一个MR任务并发的最大值，使固定数据量的任务完全加载到内存中，避免频繁的内存和磁盘数据交换，从而降低磁盘IO，提高性能。</span><br></pre></td></tr></table></figure>
<p>大概估算公式：</p>
<p>map = 2 + ⅔cpu_core<br>reduce = 2 + ⅓cpu_core</p>
<h4 id="3-Linux优化"><a href="#3-Linux优化" class="headerlink" title="3.Linux优化"></a>3.Linux优化</h4><h5 id="1-开启文件系统的预读缓存可以提高读取速度"><a href="#1-开启文件系统的预读缓存可以提高读取速度" class="headerlink" title="(1).开启文件系统的预读缓存可以提高读取速度"></a>(1).开启文件系统的预读缓存可以提高读取速度</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo blockdev --setra 32768 /dev/sda</span></span><br></pre></td></tr></table></figure>
<p>提示：ra是readahead的缩写</p>
<h5 id="2-关闭进程睡眠池"><a href="#2-关闭进程睡眠池" class="headerlink" title="(2).关闭进程睡眠池"></a>(2).关闭进程睡眠池</h5><p>即不允许后台进程进入睡眠状态，如果进程空闲，则直接kill掉释放资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo sysctl -w vm.swappiness=0</span></span><br></pre></td></tr></table></figure>
<h5 id="3-调整ulimit上限，默认值为比较小的数字"><a href="#3-调整ulimit上限，默认值为比较小的数字" class="headerlink" title="(3).调整ulimit上限，默认值为比较小的数字"></a>(3).调整ulimit上限，默认值为比较小的数字</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">ulimit</span> -n 查看允许最大进程数</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">ulimit</span> -u 查看允许打开最大文件数</span></span><br></pre></td></tr></table></figure>
<p>优化修改：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/security/limits.conf 修改打开文件数限制</span></span><br></pre></td></tr></table></figure>
<p>末尾添加：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*                soft    nofile          1024000</span><br><span class="line"></span><br><span class="line">*                hard    nofile          1024000</span><br><span class="line"></span><br><span class="line">Hive             -       nofile          1024000</span><br><span class="line"></span><br><span class="line">hive             -       nproc           1024000 </span><br></pre></td></tr></table></figure>

<p>修改用户打开进程数限制</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/security/limits.d/20-nproc.conf</span> </span><br></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">*          soft    nproc     4096</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">root       soft    nproc     unlimited</span></span><br><span class="line"></span><br><span class="line">*          soft    nproc     40960</span><br><span class="line"></span><br><span class="line">root       soft    nproc     unlimited</span><br></pre></td></tr></table></figure>

<h5 id="4-开启集群的时间同步NTP"><a href="#4-开启集群的时间同步NTP" class="headerlink" title="(4).开启集群的时间同步NTP"></a>(4).开启集群的时间同步NTP</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;集群中某台机器同步网络时间服务器的时间，集群中其他机器则同步这台机器的时间。</p>
<h5 id="5-更新系统补丁"><a href="#5-更新系统补丁" class="headerlink" title="(5).更新系统补丁"></a>(5).更新系统补丁</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;更新补丁前，请先测试新版本补丁对集群节点的兼容性。</p>
<h4 id="4-Zookeeper优化"><a href="#4-Zookeeper优化" class="headerlink" title="4.Zookeeper优化"></a>4.Zookeeper优化</h4><h5 id="1-优化Zookeeper会话超时时间"><a href="#1-优化Zookeeper会话超时时间" class="headerlink" title="(1).优化Zookeeper会话超时时间"></a>(1).优化Zookeeper会话超时时间</h5><p>hbase-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：zookeeper.session.timeout</span><br><span class="line"></span><br><span class="line">解释：In hbase-site.xml, set zookeeper.session.timeout to 30 seconds or less to bound failure detection (20-30 seconds is a good start).该值会直接关系到master发现服务器宕机的最大周期，默认值为30秒（不同的HBase版本，该默认值不一样），如果该值过小，会在HBase在写入大量数据发生而GC时，导致RegionServer短暂的不可用，从而没有向ZK发送心跳包，最终导致认为从节点shutdown。一般20台左右的集群需要配置5台zookeeper。</span><br></pre></td></tr></table></figure>
<h4 id="5-HBase优化"><a href="#5-HBase优化" class="headerlink" title="5.HBase优化"></a>5.HBase优化</h4><h5 id="1-预分区"><a href="#1-预分区" class="headerlink" title="(1).预分区"></a>(1).预分区</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;每一个region维护着startRow与endRowKey，如果加入的数据符合某个region维护的rowKey范围，则该数据交给这个region维护。那么依照这个原则，我们可以将数据索要投放的分区提前大致的规划好，以提高HBase性能。</p>
<h6 id="a-手动设定预分区"><a href="#a-手动设定预分区" class="headerlink" title="(a).手动设定预分区"></a>(a).手动设定预分区</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> create <span class="string">&#x27;staff&#x27;</span>,<span class="string">&#x27;info&#x27;</span>,<span class="string">&#x27;partition1&#x27;</span>,SPLITS =&gt; [<span class="string">&#x27;1000&#x27;</span>,<span class="string">&#x27;2000&#x27;</span>,<span class="string">&#x27;3000&#x27;</span>,<span class="string">&#x27;4000&#x27;</span>]</span></span><br></pre></td></tr></table></figure>
<h6 id="b-生成16进制序列预分区"><a href="#b-生成16进制序列预分区" class="headerlink" title="(b).生成16进制序列预分区"></a>(b).生成16进制序列预分区</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create &#x27;staff2&#x27;,&#x27;info&#x27;,&#x27;partition2&#x27;,&#123;NUMREGIONS =&gt; 15, SPLITALGO =&gt; &#x27;HexStringSplit&#x27;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="c-按照文件中设置的规则预分区"><a href="#c-按照文件中设置的规则预分区" class="headerlink" title="(c ).按照文件中设置的规则预分区"></a>(c ).按照文件中设置的规则预分区</h6><p>创建splits.txt文件内容如下：<br>spilts.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aaaa</span><br><span class="line"></span><br><span class="line">bbbb</span><br><span class="line"></span><br><span class="line">cccc</span><br><span class="line"></span><br><span class="line">dddd</span><br></pre></td></tr></table></figure>

<p>然后执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create &#x27;staff3&#x27;,&#x27;partition3&#x27;,SPLITS_FILE =&gt; &#x27;/opt/module/hbase-1.3.1/splits.txt&#x27;</span><br></pre></td></tr></table></figure>
<h6 id="d-使用JavaAPI创建预分区"><a href="#d-使用JavaAPI创建预分区" class="headerlink" title="(d).使用JavaAPI创建预分区"></a>(d).使用JavaAPI创建预分区</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//自定义算法，产生一系列Hash散列值存储在二维数组中</span><br><span class="line"></span><br><span class="line">byte[][] splitKeys = 某个散列值函数</span><br><span class="line"></span><br><span class="line">//创建HBaseAdmin实例</span><br><span class="line"></span><br><span class="line">HBaseAdmin hAdmin = new HBaseAdmin(HBaseConfiguration.create());</span><br><span class="line"></span><br><span class="line">//创建HTableDescriptor实例</span><br><span class="line"></span><br><span class="line">HTableDescriptor tableDesc = new HTableDescriptor(tableName);</span><br><span class="line"></span><br><span class="line">//通过HTableDescriptor实例和散列值二维数组创建带有预分区的HBase表</span><br><span class="line"></span><br><span class="line">hAdmin.createTable(tableDesc, splitKeys);</span><br></pre></td></tr></table></figure>

<h5 id="2-RowKey设计"><a href="#2-RowKey设计" class="headerlink" title="(2).RowKey设计"></a>(2).RowKey设计</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;一条数据的唯一标识就是rowkey，那么这条数据存储于哪个分区，取决于rowkey处于哪个一个预分区的区间内，设计rowkey的主要目的 ，就是让数据均匀的分布于所有的region中，在一定程度上防止数据倾斜。接下来我们就谈一谈rowkey常用的设计方案。</p>
<h6 id="a-生成随机数-hash、散列值"><a href="#a-生成随机数-hash、散列值" class="headerlink" title="(a).生成随机数,hash、散列值"></a>(a).生成随机数,hash、散列值</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">比如：</span><br><span class="line"></span><br><span class="line">原本rowKey为1001的，SHA1后变成：dd01903921ea24941c26a48f2cec24e0bb0e8cc7</span><br><span class="line"></span><br><span class="line">原本rowKey为3001的，SHA1后变成：49042c54de64a1e9bf0b33e00245660ef92dc7bd</span><br><span class="line"></span><br><span class="line">原本rowKey为5001的，SHA1后变成：7b61dec07e02c188790670af43e717f0f46e8913</span><br><span class="line"></span><br><span class="line">在做此操作之前，一般我们会选择从数据集中抽取样本，来决定什么样的rowKey来Hash后作为每个分区的临界值。</span><br></pre></td></tr></table></figure>
<h6 id="b-字符串反转"><a href="#b-字符串反转" class="headerlink" title="(b).字符串反转"></a>(b).字符串反转</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">20170524000001转成10000042507102</span><br><span class="line"></span><br><span class="line">20170524000002转成20000042507102</span><br></pre></td></tr></table></figure>
<p>这样也可以在一定程度上散列逐步put进来的数据。</p>
<h6 id="c-字符串拼接"><a href="#c-字符串拼接" class="headerlink" title="(c ).字符串拼接"></a>(c ).字符串拼接</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">20170524000001_a12e</span><br><span class="line"></span><br><span class="line">20170524000001_93i7</span><br></pre></td></tr></table></figure>
<h5 id="3-内存优化"><a href="#3-内存优化" class="headerlink" title="(3).内存优化"></a>(3).内存优化</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;HBase操作过程中需要大量的内存开销，毕竟Table是可以缓存在内存中的，一般会分配整个可用内存的70%给HBase的Java堆。但是不建议分配非常大的堆内存，因为GC过程持续太久会导致RegionServer处于长期不可用状态，一般16~48G内存就可以了，如果因为框架占用内存过高导致系统内存不足，框架一样会被系统服务拖死。</p>
<h5 id="4-基础优化"><a href="#4-基础优化" class="headerlink" title="(4).基础优化"></a>(4).基础优化</h5><h6 id="a-允许在HDFS的文件中追加内容"><a href="#a-允许在HDFS的文件中追加内容" class="headerlink" title="(a).允许在HDFS的文件中追加内容"></a>(a).允许在HDFS的文件中追加内容</h6><p>不是不允许追加内容么？没错，请看背景故事：</p>
<p><a target="_blank" rel="noopener" href="http://blog.cloudera.com/">http://blog.cloudera.com/blog/2009/07/file-appends-in-hdfs/</a></p>
<p>hdfs-site.xml、hbase-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.support.append</span><br><span class="line"></span><br><span class="line">解释：开启HDFS追加同步，可以优秀的配合HBase的数据同步和持久化。默认值为true。</span><br></pre></td></tr></table></figure>
<h6 id="b-优化DataNode允许的最大文件打开数"><a href="#b-优化DataNode允许的最大文件打开数" class="headerlink" title="(b).优化DataNode允许的最大文件打开数"></a>(b).优化DataNode允许的最大文件打开数</h6><p>hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.datanode.max.transfer.threads</span><br><span class="line"></span><br><span class="line">解释：HBase一般都会同一时间操作大量的文件，根据集群的数量和规模以及数据动作，设置为4096或者更高。默认值：4096</span><br></pre></td></tr></table></figure>
<h6 id="c-优化延迟高的数据操作的等待时间"><a href="#c-优化延迟高的数据操作的等待时间" class="headerlink" title="(c ).优化延迟高的数据操作的等待时间"></a>(c ).优化延迟高的数据操作的等待时间</h6><p>hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.image.transfer.timeout</span><br><span class="line"></span><br><span class="line">解释：如果对于某一次数据操作来讲，延迟非常高，socket需要等待更长的时间，建议把该值设置为更大的值（默认60000毫秒），以确保socket不会被timeout掉。</span><br></pre></td></tr></table></figure>

<h6 id="d-优化数据的写入效率"><a href="#d-优化数据的写入效率" class="headerlink" title="(d).优化数据的写入效率"></a>(d).优化数据的写入效率</h6><p>mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">属性：</span><br><span class="line"></span><br><span class="line">mapreduce.map.output.compress</span><br><span class="line"></span><br><span class="line">mapreduce.map.output.compress.codec</span><br><span class="line"></span><br><span class="line">解释：开启这两个数据可以大大提高文件的写入效率，减少写入时间。第一个属性值修改为true，第二个属性值修改为：org.apache.hadoop.io.compress.GzipCodec或者其他压缩方式。</span><br></pre></td></tr></table></figure>
<h6 id="e-优化DataNode存储"><a href="#e-优化DataNode存储" class="headerlink" title="(e).优化DataNode存储"></a>(e).优化DataNode存储</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.datanode.failed.volumes.tolerated</span><br><span class="line"></span><br><span class="line">解释： 默认为0，意思是当DataNode中有一个磁盘出现故障，则会认为该DataNode shutdown了。如果修改为1，则一个磁盘出现故障时，数据会被复制到其他正常的DataNode上，当前的DataNode继续工作。</span><br></pre></td></tr></table></figure>
<h6 id="f-设置RPC监听数量"><a href="#f-设置RPC监听数量" class="headerlink" title="(f).设置RPC监听数量"></a>(f).设置RPC监听数量</h6><p>hbase-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.regionserver.handler.count</span><br><span class="line"></span><br><span class="line">解释：默认值为30，用于指定RPC监听的数量，可以根据客户端的请求数进行调整，读写请求较多时，增加此值。</span><br></pre></td></tr></table></figure>
<h6 id="g-优化HStore文件大小"><a href="#g-优化HStore文件大小" class="headerlink" title="(g).优化HStore文件大小"></a>(g).优化HStore文件大小</h6><p>hbase-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.hregion.max.filesize</span><br><span class="line"></span><br><span class="line">解释：默认值10737418240（10GB），如果需要运行HBase的MR任务，可以减小此值，因为一个region对应一个map任务，如果单个region过大，会导致map任务执行时间过长。该值的意思就是，如果HFile的大小达到这个数值，则这个region会被切分为两个Hfile。</span><br></pre></td></tr></table></figure>
<h6 id="h-优化hbase客户端缓存"><a href="#h-优化hbase客户端缓存" class="headerlink" title="(h).优化hbase客户端缓存"></a>(h).优化hbase客户端缓存</h6><p>hbase-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.client.write.buffer</span><br><span class="line"></span><br><span class="line">解释：用于指定HBase客户端缓存，增大该值可以减少RPC调用次数，但是会消耗更多内存，反之则反之。一般我们需要设定一定的缓存大小，以达到减少RPC次数的目的。</span><br></pre></td></tr></table></figure>
<h6 id="i-指定scan-next扫描HBase所获取的行数"><a href="#i-指定scan-next扫描HBase所获取的行数" class="headerlink" title="(i).指定scan.next扫描HBase所获取的行数"></a>(i).指定scan.next扫描HBase所获取的行数</h6><p>hbase-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.client.scanner.caching</span><br><span class="line"></span><br><span class="line">解释：用于指定scan.next方法获取的默认行数，值越大，消耗内存越大。</span><br></pre></td></tr></table></figure>
<h6 id="j-flush、compact、split机制"><a href="#j-flush、compact、split机制" class="headerlink" title="(j).flush、compact、split机制"></a>(j).flush、compact、split机制</h6><p>&nbsp;&nbsp;&nbsp;当MemStore达到阈值，将Memstore中的数据Flush进Storefile；compact机制则是把flush出来的小文件合并成大的Storefile文件。split则是当Region达到阈值，会把过大的Region一分为二。</p>
<p>涉及属性：</p>
<p>即：128M就是Memstore的默认阈值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase.hregion.memstore.flush.size：134217728</span><br></pre></td></tr></table></figure>

<p>即：这个参数的作用是当单个HRegion内所有的Memstore大小总和超过指定值时，flush该HRegion的所有memstore。RegionServer的flush是通过将请求添加一个队列，模拟生产消费模型来异步处理的。那这里就有一个问题，当队列来不及消费，产生大量积压请求时，可能会导致内存陡增，最坏的情况是触发OOM。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase.regionserver.global.memstore.upperLimit：0.4</span><br><span class="line"></span><br><span class="line">hbase.regionserver.global.memstore.lowerLimit：0.38</span><br></pre></td></tr></table></figure>

<p>即：当MemStore使用内存总量达到hbase.regionserver.global.memstore.upperLimit指定值时，将会有多个MemStores flush到文件中，MemStore flush 顺序是按照大小降序执行的，直到刷新到MemStore使用内存略小于lowerLimit</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-HBase读写数据流程"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/04/08/HBase%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B/"
    >HBase读写数据流程</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/08/HBase%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B/" class="article-date">
  <time datetime="2019-04-08T06:00:00.000Z" itemprop="datePublished">2019-04-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HBase/">HBase</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一、读写流程"><a href="#一、读写流程" class="headerlink" title="一、读写流程"></a>一、读写流程</h3><h4 id="1-HBase读数据流程"><a href="#1-HBase读数据流程" class="headerlink" title="1.HBase读数据流程"></a>1.HBase读数据流程</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTVmZDI2NDI3NTNiNDg0MjcucG5n?x-oss-process=image/format,png" alt="读流程"></p>
<p>(1).HRegionServer保存着.META.的这样一张表以及表数据，要访问表数据，首先Client先去访问zookeeper，从zookeeper里面找到.META.表所在的位置信息，即找到这个.META.表在哪个HRegionServer上保存着。</p>
<p>(2) 接着Client通过刚才获取到的HRegionServer的IP来访问.META.表所在的HRegionServer，从而读取到.META.，进而获取到.META.表中存放的元数据。</p>
<p>(3)Client通过元数据中存储的信息，访问对应的HRegionServer，然后扫描(scan)所在HRegionServer的Memstore和Storefile来查询数据。</p>
<p>(4) 最后HRegionServer把查询到的数据响应给Client。</p>
<h4 id="2-HBase写数据流程"><a href="#2-HBase写数据流程" class="headerlink" title="2.HBase写数据流程"></a>2.HBase写数据流程</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTk3ZTBjMTA3NDVhYjk1NTQucG5n?x-oss-process=image/format,png" alt="写流程"></p>
<p>(1) Client也是先访问zookeeper，找到-ROOT-表，进而找到.META.表，并获取.META.表信息。</p>
<p>(2) 确定当前将要写入的数据所对应的RegionServer服务器和Region。</p>
<p>(3) Client向该RegionServer服务器发起写入数据请求，然后RegionServer收到请求并响应。</p>
<p>(4) Client先把数据写入到HLog，以防止数据丢失。</p>
<p>(5) 然后将数据写入到Memstore。</p>
<p>(6) 如果Hlog和Memstore均写入成功，则这条数据写入成功。在此过程中，如果Memstore达到阈值，会把Memstore中的数据flush到StoreFile中。</p>
<p>(7) 当Storefile越来越多，会触发Compact合并操作，把过多的Storefile合并成一个大的Storefile。当Storefile越来越大，Region也会越来越大，达到阈值后，会触发Split操作，将Region一分为二。</p>
<p>提示：因为内存空间是有限的，所以说溢写过程必定伴随着大量的小文件产生。</p>
<h3 id="二-退役-decommissioning"><a href="#二-退役-decommissioning" class="headerlink" title="二. 退役(decommissioning)"></a>二. 退役(decommissioning)</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;顾名思义，就是从当前HBase集群中删除某个RegionServer，这个过程分为如下几个过程：<br>&nbsp;&nbsp;&nbsp;&nbsp;在0.90.2之前，我们只能通过在要卸载的节点上执行</p>
<h4 id="1-第一种方案"><a href="#1-第一种方案" class="headerlink" title="1.第一种方案"></a>1.第一种方案</h4><h5 id="1-停止负载平衡器"><a href="#1-停止负载平衡器" class="headerlink" title="(1)停止负载平衡器"></a>(1)停止负载平衡器</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> balance_switch <span class="literal">false</span></span></span><br></pre></td></tr></table></figure>
<h5 id="2-在退役节点上停止RegionServer"><a href="#2-在退役节点上停止RegionServer" class="headerlink" title="(2) 在退役节点上停止RegionServer"></a>(2) 在退役节点上停止RegionServer</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase-daemon.sh stop regionserver</span><br></pre></td></tr></table></figure>
<h5 id="3-RegionServer一旦停止，会关闭维护的所有region"><a href="#3-RegionServer一旦停止，会关闭维护的所有region" class="headerlink" title="(3) RegionServer一旦停止，会关闭维护的所有region"></a>(3) RegionServer一旦停止，会关闭维护的所有region</h5><h5 id="4-Zookeeper上的该RegionServer节点消失"><a href="#4-Zookeeper上的该RegionServer节点消失" class="headerlink" title="(4) Zookeeper上的该RegionServer节点消失"></a>(4) Zookeeper上的该RegionServer节点消失</h5><h5 id="5-Master节点检测到该RegionServer下线，开启平衡器"><a href="#5-Master节点检测到该RegionServer下线，开启平衡器" class="headerlink" title="(5) Master节点检测到该RegionServer下线，开启平衡器"></a>(5) Master节点检测到该RegionServer下线，开启平衡器</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> balance_switch <span class="literal">true</span></span></span><br></pre></td></tr></table></figure>
<h5 id="6-下线的RegionServer的region服务得到重新分配"><a href="#6-下线的RegionServer的region服务得到重新分配" class="headerlink" title="(6) 下线的RegionServer的region服务得到重新分配"></a>(6) 下线的RegionServer的region服务得到重新分配</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;这种方法很大的一个缺点是该节点上的Region会离线很长时间。因为假如该RegionServer上有大量Region的话，因为Region的关闭是顺序执行的，第一个关闭的Region得等到和最后一个Region关闭并Assigned后一起上线。这是一个相当漫长的时间。每个Region Assigned需要4s，也就是说光Assigned就至少需要2个小时。该关闭方法比较传统，需要花费一定的时间，而且会造成部分region短暂的不可用。</p>
<h4 id="2-另一种方案："><a href="#2-另一种方案：" class="headerlink" title="2.另一种方案："></a>2.另一种方案：</h4><h5 id="1-新方法"><a href="#1-新方法" class="headerlink" title="(1)新方法"></a>(1)新方法</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;自0.90.2之后，HBase添加了一个新的方法，即“graceful_stop”,只需要在HBase Master节点执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/graceful_stop.sh &lt;RegionServer-hostname&gt;</span></span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;该命令会自动关闭Load Balancer，然后Assigned Region，之后会将该节点关闭。除此之外，你还可以查看remove的过程，已经assigned了多少个Region，还剩多少个Region，每个Region 的Assigned耗时</p>
<h5 id="2-开启负载平衡器"><a href="#2-开启负载平衡器" class="headerlink" title="(2)开启负载平衡器"></a>(2)开启负载平衡器</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hbase&gt;</span><span class="bash"> balance_switch <span class="literal">false</span></span></span><br></pre></td></tr></table></figure>

<h3 id="三-Hbase集群出问题如何重置-学习的时候"><a href="#三-Hbase集群出问题如何重置-学习的时候" class="headerlink" title="三.Hbase集群出问题如何重置(学习的时候)"></a>三.Hbase集群出问题如何重置(学习的时候)</h3><h4 id="1-将zookeeper中的hbase结点删除"><a href="#1-将zookeeper中的hbase结点删除" class="headerlink" title="1.将zookeeper中的hbase结点删除"></a>1.将zookeeper中的hbase结点删除</h4><h4 id="2-删除hdfs上的hbase目录"><a href="#2-删除hdfs上的hbase目录" class="headerlink" title="2.删除hdfs上的hbase目录"></a>2.删除hdfs上的hbase目录</h4><h4 id="3-重新启动hbase"><a href="#3-重新启动hbase" class="headerlink" title="3.重新启动hbase"></a>3.重新启动hbase</h4> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/19/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/21/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> Movle
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="https://img-blog.csdnimg.cn/20200609161448519.jpg" alt="Movle"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>
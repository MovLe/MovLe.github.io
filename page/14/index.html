<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Movle</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="https://img-blog.csdnimg.cn/20200609161448519.jpg" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="https://img-blog.csdnimg.cn/2020060916514052.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Movle</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['种一棵树，最好的时机是十年前，其次是现在', '人必有痴，而后有成', '今天，我没有浑浑噩噩的度过'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Hive之函数"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E4%B9%8B%E5%87%BD%E6%95%B0/"
    >Hive之函数</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E4%B9%8B%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2019-07-15T12:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-系统自带的函数"><a href="#一-系统自带的函数" class="headerlink" title="一.系统自带的函数"></a>一.系统自带的函数</h3><h4 id="1-查看系统自带的函数"><a href="#1-查看系统自带的函数" class="headerlink" title="1.查看系统自带的函数"></a>1.查看系统自带的函数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> show <span class="built_in">functions</span>;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThjNDgzZWU2Y2QwYmZhNGMucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-显示自带的函数的用法"><a href="#2-显示自带的函数的用法" class="headerlink" title="2.显示自带的函数的用法"></a>2.显示自带的函数的用法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc <span class="keyword">function</span> upper;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-详细显示自带的函数的用法"><a href="#3-详细显示自带的函数的用法" class="headerlink" title="3.详细显示自带的函数的用法"></a>3.详细显示自带的函数的用法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc <span class="keyword">function</span> extended upper;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU5NTk5OTI2ZDE1OGFkMzIucG5n?x-oss-process=image/format,png"></p>
<h3 id="二-自定义函数"><a href="#二-自定义函数" class="headerlink" title="二. 自定义函数"></a>二. 自定义函数</h3><h4 id="1-Hive-自带了一些函数，比如：max-min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。"><a href="#1-Hive-自带了一些函数，比如：max-min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。" class="headerlink" title="1.Hive 自带了一些函数，比如：max/min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。"></a>1.Hive 自带了一些函数，比如：max/min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。</h4><h4 id="2-当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined-function）。"><a href="#2-当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined-function）。" class="headerlink" title="2.当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）。"></a>2.当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）。</h4><h4 id="3-根据用户自定义函数类别分为以下三种："><a href="#3-根据用户自定义函数类别分为以下三种：" class="headerlink" title="3.根据用户自定义函数类别分为以下三种："></a>3.根据用户自定义函数类别分为以下三种：</h4><h5 id="1-UDF-User-Defined-Function"><a href="#1-UDF-User-Defined-Function" class="headerlink" title="(1)UDF(User-Defined-Function)"></a>(1)UDF(User-Defined-Function)</h5><pre><code>    一进一出
</code></pre>
<h5 id="2-UDAF-User-Defined-Aggregation-Function"><a href="#2-UDAF-User-Defined-Aggregation-Function" class="headerlink" title="(2)UDAF(User-Defined Aggregation Function)"></a>(2)UDAF(User-Defined Aggregation Function)</h5><pre><code>    聚集函数，多进一出
    类似于：count/max/min
</code></pre>
<h5 id="3-UDTF-User-Defined-Table-Generating-Functions"><a href="#3-UDTF-User-Defined-Table-Generating-Functions" class="headerlink" title="(3)UDTF(User-Defined Table-Generating Functions)"></a>(3)UDTF(User-Defined Table-Generating Functions)</h5><pre><code>    一进多出
    如lateral view explore()
</code></pre>
<h4 id="4-官方文档地址"><a href="#4-官方文档地址" class="headerlink" title="4.官方文档地址"></a>4.官方文档地址</h4><p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/HivePlugins">https://cwiki.apache.org/confluence/display/Hive/HivePlugins</a></p>
<h4 id="5-编程步骤："><a href="#5-编程步骤：" class="headerlink" title="5.编程步骤："></a>5.编程步骤：</h4><h5 id="1-继承org-apache-hadoop-hive-ql-UDF"><a href="#1-继承org-apache-hadoop-hive-ql-UDF" class="headerlink" title="(1)继承org.apache.hadoop.hive.ql.UDF"></a>(1)继承org.apache.hadoop.hive.ql.UDF</h5><h5 id="2-需要实现evaluate函数；evaluate函数支持重载；"><a href="#2-需要实现evaluate函数；evaluate函数支持重载；" class="headerlink" title="(2)需要实现evaluate函数；evaluate函数支持重载；"></a>(2)需要实现evaluate函数；evaluate函数支持重载；</h5><h5 id="3-在hive的命令行窗口创建函数"><a href="#3-在hive的命令行窗口创建函数" class="headerlink" title="(3)在hive的命令行窗口创建函数"></a>(3)在hive的命令行窗口创建函数</h5><h6 id="a-添加jar"><a href="#a-添加jar" class="headerlink" title="(a)添加jar"></a>(a)添加jar</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add jar linux_jar_path</span><br></pre></td></tr></table></figure>
<h6 id="b-创建function，"><a href="#b-创建function，" class="headerlink" title="(b)创建function，"></a>(b)创建function，</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create [temporary] function [dbname.]function_name AS class_name;</span><br></pre></td></tr></table></figure>
<h5 id="4-在hive的命令行窗口删除函数"><a href="#4-在hive的命令行窗口删除函数" class="headerlink" title="(4)在hive的命令行窗口删除函数"></a>(4)在hive的命令行窗口删除函数</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Drop [temporary] function [if exists] [dbname.]function_name;</span><br></pre></td></tr></table></figure>
<h4 id="6-注意事项"><a href="#6-注意事项" class="headerlink" title="6.注意事项"></a>6.注意事项</h4><h5 id="1-UDF必须要有返回类型，可以返回null，但是返回类型不能为void；"><a href="#1-UDF必须要有返回类型，可以返回null，但是返回类型不能为void；" class="headerlink" title="(1)UDF必须要有返回类型，可以返回null，但是返回类型不能为void；"></a>(1)UDF必须要有返回类型，可以返回null，但是返回类型不能为void；</h5><h3 id="三-自定义UDF函数开发案例"><a href="#三-自定义UDF函数开发案例" class="headerlink" title="三. 自定义UDF函数开发案例"></a>三. 自定义UDF函数开发案例</h3><h4 id="1-创建一个maven工程"><a href="#1-创建一个maven工程" class="headerlink" title="1.创建一个maven工程:"></a>1.创建一个maven工程:</h4><h4 id="2-将hive的jar包解压后，将apache-hive-1-2-1-bin-lib文件下的jar包都拷贝到java工程中。"><a href="#2-将hive的jar包解压后，将apache-hive-1-2-1-bin-lib文件下的jar包都拷贝到java工程中。" class="headerlink" title="2.将hive的jar包解压后，将apache-hive-1.2.1-bin\lib文件下的jar包都拷贝到java工程中。"></a>2.将hive的jar包解压后，将apache-hive-1.2.1-bin\lib文件下的jar包都拷贝到java工程中。</h4><h4 id="3-添加pomy依赖："><a href="#3-添加pomy依赖：" class="headerlink" title="3.添加pomy依赖："></a>3.添加pomy依赖：</h4><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hive/hive-metastore --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-metastore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hive/hive-jdbc --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hive/hive-exec --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-exec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hive/hive-common --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-创建一个类"><a href="#4-创建一个类" class="headerlink" title="4.创建一个类"></a>4.创建一个类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> HiveUDF;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lower</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">evaluate</span> <span class="params">(<span class="keyword">final</span> String s)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> s.toString().toLowerCase();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-打成jar包上传到服务器-opt-module-jars-Hive-1-0-SNAPSHOT-jar"><a href="#5-打成jar包上传到服务器-opt-module-jars-Hive-1-0-SNAPSHOT-jar" class="headerlink" title="5.打成jar包上传到服务器/opt/module/jars/Hive-1.0-SNAPSHOT.jar"></a>5.打成jar包上传到服务器/opt/module/jars/Hive-1.0-SNAPSHOT.jar</h4><h5 id="1-打包："><a href="#1-打包：" class="headerlink" title="(1)打包："></a>(1)打包：</h5><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTZhNDEzZmY4YTBhZDRiN2UucG5n?x-oss-process=image/format,png"></p>
<h5 id="2-上传："><a href="#2-上传：" class="headerlink" title="(2)上传："></a>(2)上传：</h5><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFlNWU1YTE2YWIyZjJkMjQucG5n?x-oss-process=image/format,png" alt="上传"></p>
<h4 id="6-将jar包添加到hive的classpath"><a href="#6-将jar包添加到hive的classpath" class="headerlink" title="6.将jar包添加到hive的classpath"></a>6.将jar包添加到hive的classpath</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; add jar /opt/module/jars/Hive-1.0-SNAPSHOT.jar ;</span><br></pre></td></tr></table></figure>
<h4 id="7-创建临时函数与开发好的java-class关联-全类名"><a href="#7-创建临时函数与开发好的java-class关联-全类名" class="headerlink" title="7.创建临时函数与开发好的java class关联(全类名)"></a>7.创建临时函数与开发好的java class关联(全类名)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create temporary function udf_lower as &quot;HiveUDF.Lower&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="8-即可在hql中使用自定义的函数strip"><a href="#8-即可在hql中使用自定义的函数strip" class="headerlink" title="8.即可在hql中使用自定义的函数strip"></a>8.即可在hql中使用自定义的函数strip</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select ename, udf_lower(ename) lowername from emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTM5NjY1NmY5Yzc4MTJiODgucG5n?x-oss-process=image/format,png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive之查询"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E4%B9%8B%E6%9F%A5%E8%AF%A2/"
    >Hive 查询</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E4%B9%8B%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time datetime="2019-07-15T11:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-基本查询（Select…From）"><a href="#一-基本查询（Select…From）" class="headerlink" title="一.基本查询（Select…From）"></a>一.基本查询（Select…From）</h3><h4 id="1-全表和特定列查询"><a href="#1-全表和特定列查询" class="headerlink" title="1.全表和特定列查询"></a>1.全表和特定列查询</h4><h5 id="1-全表查询"><a href="#1-全表查询" class="headerlink" title="(1).全表查询"></a>(1).全表查询</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp;</span><br></pre></td></tr></table></figure>
<h5 id="2-选择特定列查询"><a href="#2-选择特定列查询" class="headerlink" title="(2).选择特定列查询"></a>(2).选择特定列查询</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select empno, ename from emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQwMGMzMGVhYTRjM2YxNTYucG5n?x-oss-process=image/format,png"></p>
<p>注意：</p>
<ul>
<li>SQL 语言大小写不敏感。</li>
<li>SQL 可以写在一行或者多行</li>
<li>关键字不能被缩写也不能分行</li>
<li>各子句一般要分行写。</li>
<li>使用缩进提高语句的可读性。</li>
</ul>
<h4 id="2-列别名"><a href="#2-列别名" class="headerlink" title="2. 列别名"></a>2. 列别名</h4><h5 id="1-重命名一个列。"><a href="#1-重命名一个列。" class="headerlink" title="(1).重命名一个列。"></a>(1).重命名一个列。</h5><h5 id="2-便于计算。"><a href="#2-便于计算。" class="headerlink" title="(2).便于计算。"></a>(2).便于计算。</h5><h5 id="3-紧跟列名，也可以在列名和别名之间加入关键字‘AS’"><a href="#3-紧跟列名，也可以在列名和别名之间加入关键字‘AS’" class="headerlink" title="(3).紧跟列名，也可以在列名和别名之间加入关键字‘AS’"></a>(3).紧跟列名，也可以在列名和别名之间加入关键字‘AS’</h5><h5 id="4-案例实操"><a href="#4-案例实操" class="headerlink" title="(4).案例实操"></a>(4).案例实操</h5><h6 id="a-查询名称和部门"><a href="#a-查询名称和部门" class="headerlink" title="(a)查询名称和部门"></a>(a)查询名称和部门</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select ename AS name, deptno dn from emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTlhNmE5NjY3MThlZGQ4MjcucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-算术运算符"><a href="#3-算术运算符" class="headerlink" title="3.算术运算符"></a>3.算术运算符</h4><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">A+B</td>
<td align="center">A和B 相加</td>
</tr>
<tr>
<td align="center">A-B</td>
<td align="center">A减去B</td>
</tr>
<tr>
<td align="center">A*B</td>
<td align="center">A和B相乘</td>
</tr>
<tr>
<td align="center">A/B</td>
<td align="center">A除以B</td>
</tr>
<tr>
<td align="center">A%B</td>
<td align="center">A对B取余/模</td>
</tr>
<tr>
<td align="center">A&amp;B</td>
<td align="center">A和B按位取与</td>
</tr>
<tr>
<td align="center">A|B</td>
<td align="center">A和B按位取或</td>
</tr>
<tr>
<td align="center">A^B</td>
<td align="center">A和B按位取异或</td>
</tr>
<tr>
<td align="center">~A</td>
<td align="center">A按位取反</td>
</tr>
</tbody></table>
<h5 id="1-案例实操"><a href="#1-案例实操" class="headerlink" title="(1)案例实操"></a>(1)案例实操</h5><p>查询出所有员工的薪水后加1显示。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select sal +1 from emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWVhMTMxNDJlZDc5MzY3NzkucG5n?x-oss-process=image/format,png"></p>
<h4 id="4-常用函数"><a href="#4-常用函数" class="headerlink" title="4.常用函数"></a>4.常用函数</h4><h5 id="1-求总行数（count）"><a href="#1-求总行数（count）" class="headerlink" title="(1).求总行数（count）"></a>(1).求总行数（count）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select count(1) cnt from emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWYzYmEzOTQ3ZDMzNzgwM2MucG5n?x-oss-process=image/format,png"></p>
<h5 id="2-求工资的最大值（max）"><a href="#2-求工资的最大值（max）" class="headerlink" title="(2).求工资的最大值（max）"></a>(2).求工资的最大值（max）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select max(sal) max_sal from emp;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTM2MDYxYTZjNDA0ODc5NmYucG5n?x-oss-process=image/format,png"></p>
<h5 id="3-求工资的最小值（min）"><a href="#3-求工资的最小值（min）" class="headerlink" title="(3).求工资的最小值（min）"></a>(3).求工资的最小值（min）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select min(sal) min_sal from emp;</span><br></pre></td></tr></table></figure>
<h5 id="4-求工资的总和（sum）"><a href="#4-求工资的总和（sum）" class="headerlink" title="(4).求工资的总和（sum）"></a>(4).求工资的总和（sum）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select sum(sal) sum_sal from emp; </span><br></pre></td></tr></table></figure>
<h5 id="5-求工资的平均值（avg）"><a href="#5-求工资的平均值（avg）" class="headerlink" title="(5).求工资的平均值（avg）"></a>(5).求工资的平均值（avg）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select avg(sal) avg_sal from emp;</span><br></pre></td></tr></table></figure>
<h4 id="5-Limit语句"><a href="#5-Limit语句" class="headerlink" title="5.Limit语句"></a>5.Limit语句</h4><p>典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp limit 5;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThjODQ0ZjFkZTk2N2I3ZjIucG5n?x-oss-process=image/format,png"></p>
<h3 id="二-Where语句"><a href="#二-Where语句" class="headerlink" title="二.Where语句"></a>二.Where语句</h3><h4 id="0-定义"><a href="#0-定义" class="headerlink" title="0.定义"></a>0.定义</h4><h5 id="1-使用WHERE子句，将不满足条件的行过滤掉。"><a href="#1-使用WHERE子句，将不满足条件的行过滤掉。" class="headerlink" title="(1).使用WHERE子句，将不满足条件的行过滤掉。"></a>(1).使用WHERE子句，将不满足条件的行过滤掉。</h5><h5 id="2-WHERE子句紧随FROM子句。"><a href="#2-WHERE子句紧随FROM子句。" class="headerlink" title="(2).WHERE子句紧随FROM子句。"></a>(2).WHERE子句紧随FROM子句。</h5><h5 id="3-案例实操"><a href="#3-案例实操" class="headerlink" title="(3).案例实操"></a>(3).案例实操</h5><p>查询出薪水大于1000的所有员工</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select ename , sal from emp where sal &gt; 1000;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTY3NTU1NGI0YTU1YTk1NjgucG5n?x-oss-process=image/format,png"></p>
<h4 id="1-比较运算符（Between-In-Is-Null）"><a href="#1-比较运算符（Between-In-Is-Null）" class="headerlink" title="1.比较运算符（Between/In/ Is Null）"></a>1.比较运算符（Between/In/ Is Null）</h4><h5 id="1-下面表中描述了谓词操作符，这些操作符同样可以用于JOIN…ON和HAVING语句中。"><a href="#1-下面表中描述了谓词操作符，这些操作符同样可以用于JOIN…ON和HAVING语句中。" class="headerlink" title="(1).下面表中描述了谓词操作符，这些操作符同样可以用于JOIN…ON和HAVING语句中。"></a>(1).下面表中描述了谓词操作符，这些操作符同样可以用于JOIN…ON和HAVING语句中。</h5><table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">支持的数据类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">A=B</td>
<td align="center">基本数据类型</td>
<td align="center">如果A等于B则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A&lt;=&gt;B</td>
<td align="center">基本数据类型</td>
<td align="center">如果A和B都为NULL，则返回TRUE，其他的和等号（=）操作符的结果一致，如果任一为NULL则结果为NULL</td>
</tr>
<tr>
<td align="center">A&lt;&gt;B, A!=B</td>
<td align="center">基本数据类型</td>
<td align="center">A或者B为NULL则返回NULL；如果A不等于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A&lt;B</td>
<td align="center">基本数据类型</td>
<td align="center">A或者B为NULL，则返回NULL；如果A小于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A&lt;=B</td>
<td align="center">基本数据类型</td>
<td align="center">A或者B为NULL，则返回NULL；如果A小于等于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A&gt;B</td>
<td align="center">基本数据类型</td>
<td align="center">A或者B为NULL，则返回NULL；如果A大于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A&gt;=B</td>
<td align="center">基本数据类型</td>
<td align="center">A或者B为NULL，则返回NULL；如果A大于等于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A [NOT] BETWEEN B AND C</td>
<td align="center">基本数据类型</td>
<td align="center">如果A，B或者C任一为NULL，则结果为NULL。如果A的值大于等于B而且小于或等于C，则结果为TRUE，反之为FALSE。如果使用NOT关键字则可达到相反的效果。</td>
</tr>
<tr>
<td align="center">A IS NULL</td>
<td align="center">所有数据类型</td>
<td align="center">如果A等于NULL，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">A IS NOT NULL</td>
<td align="center">所有数据类型</td>
<td align="center">如果A不等于NULL，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td align="center">IN(数值1, 数值2)</td>
<td align="center">所有数据类型</td>
<td align="center">使用 IN运算显示列表中的值</td>
</tr>
<tr>
<td align="center">A [NOT] LIKE B</td>
<td align="center">STRING 类型</td>
<td align="center">B是一个SQL下的简单正则表达式，如果A与其匹配的话，则返回TRUE；反之返回FALSE。B的表达式说明如下：‘x%’表示A必须以字母‘x’开头，‘%x’表示A必须以字母’x’结尾，而‘%x%’表示A包含有字母’x’,可以位于开头，结尾或者字符串中间。如果使用NOT关键字则可达到相反的效果。</td>
</tr>
<tr>
<td align="center">A RLIKE B, A REGEXP B</td>
<td align="center">STRING 类型</td>
<td align="center">B是一个正则表达式，如果A与其匹配，则返回TRUE；反之返回FALSE。匹配使用的是JDK中的正则表达式接口实现的，因为正则也依据其中的规则。例如，正则表达式必须和整个字符串A相匹配，而不是只需与其字符串匹配。</td>
</tr>
</tbody></table>
<h5 id="2-案例实操"><a href="#2-案例实操" class="headerlink" title="(2).案例实操"></a>(2).案例实操</h5><h6 id="a-查询出薪水等于5000的所有员工"><a href="#a-查询出薪水等于5000的所有员工" class="headerlink" title="(a)查询出薪水等于5000的所有员工"></a>(a)查询出薪水等于5000的所有员工</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal =5000;</span><br></pre></td></tr></table></figure>
<h6 id="b-查询工资在500到1000的员工信息，注意between-…-and-是闭区间"><a href="#b-查询工资在500到1000的员工信息，注意between-…-and-是闭区间" class="headerlink" title="(b)查询工资在500到1000的员工信息，注意between … and 是闭区间"></a>(b)查询工资在500到1000的员工信息，注意between … and 是闭区间</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal between 500 and 1000;</span><br></pre></td></tr></table></figure>
<h6 id="c-查询comm-奖金-为空的所有员工信息"><a href="#c-查询comm-奖金-为空的所有员工信息" class="headerlink" title="(c )查询comm(奖金)为空的所有员工信息"></a>(c )查询comm(奖金)为空的所有员工信息</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where comm is null;</span><br></pre></td></tr></table></figure>

<h6 id="d-查询工资是1500和5000的员工信息"><a href="#d-查询工资是1500和5000的员工信息" class="headerlink" title="(d)查询工资是1500和5000的员工信息"></a>(d)查询工资是1500和5000的员工信息</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal IN (1500, 5000);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ2NmNmYmIwMWNlNmVjYTkucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-Like和RLike"><a href="#2-Like和RLike" class="headerlink" title="2.Like和RLike"></a>2.Like和RLike</h4><h5 id="1-使用LIKE运算选择类似的值"><a href="#1-使用LIKE运算选择类似的值" class="headerlink" title="(1).使用LIKE运算选择类似的值"></a>(1).使用LIKE运算选择类似的值</h5><h5 id="2-选择条件可以包含字符或数字"><a href="#2-选择条件可以包含字符或数字" class="headerlink" title="(2).选择条件可以包含字符或数字:"></a>(2).选择条件可以包含字符或数字:</h5><ul>
<li><p>% 代表零个或多个字符(任意个字符)。</p>
</li>
<li><p>_ 代表一个字符。</p>
</li>
</ul>
<h5 id="3-RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大的语言来指定匹配条件。"><a href="#3-RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大的语言来指定匹配条件。" class="headerlink" title="(3).RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大的语言来指定匹配条件。"></a>(3).RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大的语言来指定匹配条件。</h5><h5 id="4-案例实操-1"><a href="#4-案例实操-1" class="headerlink" title="(4).案例实操"></a>(4).案例实操</h5><h6 id="a-查找以2开头薪水的员工信息"><a href="#a-查找以2开头薪水的员工信息" class="headerlink" title="(a)查找以2开头薪水的员工信息"></a>(a)查找以2开头薪水的员工信息</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal LIKE &#x27;2%&#x27;;</span><br></pre></td></tr></table></figure>
<h6 id="b-查找第二个数值为2的薪水的员工信息"><a href="#b-查找第二个数值为2的薪水的员工信息" class="headerlink" title="(b)查找第二个数值为2的薪水的员工信息"></a>(b)查找第二个数值为2的薪水的员工信息</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal LIKE &#x27;_2%&#x27;;</span><br></pre></td></tr></table></figure>
<h6 id="c-查找薪水中含有2的员工信息"><a href="#c-查找薪水中含有2的员工信息" class="headerlink" title="(c )查找薪水中含有2的员工信息"></a>(c )查找薪水中含有2的员工信息</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal RLIKE &#x27;[2]&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQ2NjQxZDNmNDFiYmYzYmYucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-逻辑运算符（And-Or-Not）"><a href="#3-逻辑运算符（And-Or-Not）" class="headerlink" title="3.逻辑运算符（And/Or/Not）"></a>3.逻辑运算符（And/Or/Not）</h4><table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AND</td>
<td align="center">逻辑并</td>
</tr>
<tr>
<td align="center">OR</td>
<td align="center">逻辑或</td>
</tr>
<tr>
<td align="center">NOT</td>
<td align="center">逻辑否</td>
</tr>
</tbody></table>
<p>案例实操</p>
<h5 id="1-查询薪水大于1000，部门是30"><a href="#1-查询薪水大于1000，部门是30" class="headerlink" title="(1)查询薪水大于1000，部门是30"></a>(1)查询薪水大于1000，部门是30</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal&gt;1000 and deptno=30;</span><br></pre></td></tr></table></figure>
<h5 id="2-查询薪水大于1000，或者部门是30"><a href="#2-查询薪水大于1000，或者部门是30" class="headerlink" title="(2)查询薪水大于1000，或者部门是30"></a>(2)查询薪水大于1000，或者部门是30</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where sal&gt;1000 or deptno=30;</span><br></pre></td></tr></table></figure>
<h5 id="3-查询除了20部门和30部门以外的员工信息"><a href="#3-查询除了20部门和30部门以外的员工信息" class="headerlink" title="(3)查询除了20部门和30部门以外的员工信息"></a>(3)查询除了20部门和30部门以外的员工信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp where deptno not IN(30, 20);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWRmNGVhYmEzODU2MGU0YjYucG5n?x-oss-process=image/format,png"></p>
<h3 id="三-分组"><a href="#三-分组" class="headerlink" title="三. 分组"></a>三. 分组</h3><h4 id="1-Group-By语句"><a href="#1-Group-By语句" class="headerlink" title="1.Group By语句"></a>1.Group By语句</h4><p>GROUP BY语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然后对每个组执行聚合操作。</p>
<p>案例实操：</p>
<h5 id="1-计算emp表每个部门的平均工资"><a href="#1-计算emp表每个部门的平均工资" class="headerlink" title="(1)计算emp表每个部门的平均工资"></a>(1)计算emp表每个部门的平均工资</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select t.deptno, avg(t.sal) avg_sal from emp t group by t.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWI3NWUxNDM1NTIxMTlhNGMucG5n?x-oss-process=image/format,png"></p>
<h5 id="2-计算emp每个部门中每个岗位的最高薪水"><a href="#2-计算emp每个部门中每个岗位的最高薪水" class="headerlink" title="(2)计算emp每个部门中每个岗位的最高薪水"></a>(2)计算emp每个部门中每个岗位的最高薪水</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select t.deptno, t.job, max(t.sal) max_sal from emp t group by t.deptno, t.job;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWNjYzIzODY3Y2Y4ZmNiNjEucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-Having语句"><a href="#2-Having语句" class="headerlink" title="2. Having语句"></a>2. Having语句</h4><h5 id="1-having与where不同点"><a href="#1-having与where不同点" class="headerlink" title="(1).having与where不同点"></a>(1).having与where不同点</h5><ul>
<li><p>where针对表中的列发挥作用，查询数据；having针对查询结果中的列发挥作用，筛选数据。</p>
</li>
<li><p>where后面不能写分组函数，而having后面可以使用分组函数。</p>
</li>
<li><p>having只用于group by分组统计语句。</p>
</li>
</ul>
<h5 id="2-案例实操："><a href="#2-案例实操：" class="headerlink" title="(2).案例实操："></a>(2).案例实操：</h5><h6 id="a-求每个部门的平均薪水大于2000的部门"><a href="#a-求每个部门的平均薪水大于2000的部门" class="headerlink" title="(a)求每个部门的平均薪水大于2000的部门"></a>(a)求每个部门的平均薪水大于2000的部门</h6><p>求每个部门的平均工资</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select deptno, avg(sal) from emp group by deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFmMWY0YmZlMWYxNDViMDgucG5n?x-oss-process=image/format,png"></p>
<h6 id="b-求每个部门的平均薪水大于2000的部门"><a href="#b-求每个部门的平均薪水大于2000的部门" class="headerlink" title="(b)求每个部门的平均薪水大于2000的部门"></a>(b)求每个部门的平均薪水大于2000的部门</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select deptno, avg(sal) avg_sal from emp group by deptno having avg_sal &gt; 2000;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWI1YWZiYWY5ZDk3MmQxY2YucG5n?x-oss-process=image/format,png"></p>
<h3 id="四-Join语句"><a href="#四-Join语句" class="headerlink" title="四.Join语句"></a>四.Join语句</h3><h4 id="1-等值Join"><a href="#1-等值Join" class="headerlink" title="1.等值Join"></a>1.等值Join</h4><p>Hive支持通常的SQL JOIN语句，但是只支持等值连接，不支持非等值连接。</p>
<p>案例实操</p>
<h5 id="1-根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门编号；"><a href="#1-根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门编号；" class="headerlink" title="(1)根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门编号；"></a>(1)根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门编号；</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno, d.dname from emp e join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWEwZjA4ZTRiMDQ3ZmRkMWUucG5n?x-oss-process=image/format,png"></p>
<p>同样与</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno,e.ename,d.deptno,d.dname from emp e,dept d where e.deptno=d.deptno;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTIxZDBiZDdmNDA5ZGNkMDMucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-表的别名"><a href="#2-表的别名" class="headerlink" title="2. 表的别名"></a>2. 表的别名</h4><h5 id="1-好处"><a href="#1-好处" class="headerlink" title="(1).好处"></a>(1).好处</h5><ul>
<li>使用别名可以简化查询。</li>
<li>使用表名前缀可以提高执行效率。</li>
</ul>
<h5 id="2-案例实操-1"><a href="#2-案例实操-1" class="headerlink" title="(2).案例实操"></a>(2).案例实操</h5><p>合并员工表和部门表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTg2YTkzNGRmNTgwYmM1NDAucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-内连接"><a href="#3-内连接" class="headerlink" title="3.内连接"></a>3.内连接</h4><p>内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWEyODAwZjRhMzAyMDU3YjEucG5n?x-oss-process=image/format,png"></p>
<h4 id="4-左外连接"><a href="#4-左外连接" class="headerlink" title="4.左外连接"></a>4.左外连接</h4><p>左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e left join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ1MjdhOTg3OWM0OWMzNDIucG5n?x-oss-process=image/format,png"></p>
<h4 id="5-右外连接"><a href="#5-右外连接" class="headerlink" title="5.右外连接"></a>5.右外连接</h4><p>右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e right join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTViZjc0NDRhYjg1OTViZGYucG5n?x-oss-process=image/format,png"></p>
<h4 id="6-满外连接"><a href="#6-满外连接" class="headerlink" title="6.满外连接"></a>6.满外连接</h4><p>满外连接：将会返回所有表中符合WHERE语句条件的所有记录。如果任一表的指定字段没有符合条件的值的话，那么就使用NULL值替代。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e full join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWM0NzY4NWMyM2I5YzgyNmYucG5n?x-oss-process=image/format,png"></p>
<h4 id="7-多表连接"><a href="#7-多表连接" class="headerlink" title="7.多表连接"></a>7.多表连接</h4><p>注意：连接 n个表，至少需要n-1个连接条件。例如：连接三个表，至少需要两个连接条件。</p>
<h5 id="0-数据准备"><a href="#0-数据准备" class="headerlink" title="(0)数据准备"></a>(0)数据准备</h5><h5 id="1-创建位置表"><a href="#1-创建位置表" class="headerlink" title="(1)创建位置表"></a>(1)创建位置表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists default.location(</span><br><span class="line">loc int,</span><br><span class="line">loc_name string</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="2-导入数据"><a href="#2-导入数据" class="headerlink" title="(2)导入数据"></a>(2)导入数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/location.txt&#x27; into table default.location;</span><br></pre></td></tr></table></figure>
<h5 id="3-多表连接查询distinct"><a href="#3-多表连接查询distinct" class="headerlink" title="(3)多表连接查询distinct"></a>(3)多表连接查询distinct</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt;SELECT e.ename, d.deptno, l. loc_name</span><br><span class="line">              FROM   emp e </span><br><span class="line">              JOIN   dept d</span><br><span class="line">              ON     d.deptno = e.deptno </span><br><span class="line">              JOIN   location l</span><br><span class="line">              ON     d.loc = l.loc;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ5ZDQxZmVhZDM2NDBmYzMucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWYwZTQyNDJiNWRiNjQyZDMucG5n?x-oss-process=image/format,png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;大多数情况下，Hive会对每对JOIN连接对象启动一个MapReduce任务。本例中会首先启动一个MapReduce job对表e和表d进行连接操作，然后会再启动一个MapReduce job将第一个MapReduce job的输出和表l;进行连接操作。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的顺序执行的。</p>
<h4 id="8-笛卡尔积"><a href="#8-笛卡尔积" class="headerlink" title="8.笛卡尔积"></a>8.笛卡尔积</h4><h5 id="1-笛卡尔集会在下面条件下产生"><a href="#1-笛卡尔集会在下面条件下产生" class="headerlink" title="(1).笛卡尔集会在下面条件下产生:"></a>(1).笛卡尔集会在下面条件下产生:</h5><ul>
<li>省略连接条件</li>
<li>连接条件无效</li>
<li>所有表中的所有行互相连接</li>
</ul>
<h5 id="2-案例实操-2"><a href="#2-案例实操-2" class="headerlink" title="(2).案例实操"></a>(2).案例实操</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select empno, deptno from emp, dept;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ4YmIwMGM3Njk5YmZkM2UucG5n?x-oss-process=image/format,png"></p>
<p>FAILED: SemanticException Column deptno Found in more than One Tables/Subqueries</p>
<h4 id="9-连接谓词中不支持or"><a href="#9-连接谓词中不支持or" class="headerlink" title="9.连接谓词中不支持or"></a>9.连接谓词中不支持or</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno or e.ename=d.ename;  </span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWVmYWZiZWQyNjI1MGRjMTAucG5n?x-oss-process=image/format,png"></p>
<h3 id="五-排序"><a href="#五-排序" class="headerlink" title="五.排序"></a>五.排序</h3><h4 id="1-全局排序（Order-By）"><a href="#1-全局排序（Order-By）" class="headerlink" title="1.全局排序（Order By）"></a>1.全局排序（Order By）</h4><p>Order By：全局排序，一个MapReduce</p>
<h5 id="1-使用-ORDER-BY-子句排序"><a href="#1-使用-ORDER-BY-子句排序" class="headerlink" title="(1).使用 ORDER BY 子句排序"></a>(1).使用 ORDER BY 子句排序</h5><ul>
<li>ASC（ascend）: 升序（默认）</li>
<li>DESC（descend）: 降序</li>
</ul>
<h5 id="2-ORDER-BY-子句在SELECT语句的结尾。"><a href="#2-ORDER-BY-子句在SELECT语句的结尾。" class="headerlink" title="(2).ORDER BY 子句在SELECT语句的结尾。"></a>(2).ORDER BY 子句在SELECT语句的结尾。</h5><h5 id="3-案例实操-1"><a href="#3-案例实操-1" class="headerlink" title="(3).案例实操"></a>(3).案例实操</h5><h6 id="a-查询员工信息按工资升序排列"><a href="#a-查询员工信息按工资升序排列" class="headerlink" title="(a)查询员工信息按工资升序排列"></a>(a)查询员工信息按工资升序排列</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp order by sal;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTJlMjUyMDlmOGNkYWI4MzgucG5n?x-oss-process=image/format,png"></p>
<h6 id="b-查询员工信息按工资降序排列"><a href="#b-查询员工信息按工资降序排列" class="headerlink" title="(b)查询员工信息按工资降序排列"></a>(b)查询员工信息按工资降序排列</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp order by sal desc;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ4ODFjYTdjZGJkNGU3NzUucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-按照别名排序"><a href="#2-按照别名排序" class="headerlink" title="2.按照别名排序"></a>2.按照别名排序</h4><p>按照员工薪水的2倍排序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select ename, sal*2 twosal from emp order by twosal;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTgwMTJiNDdkZDVkNDkzNjUucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-多个列排序"><a href="#3-多个列排序" class="headerlink" title="3.多个列排序"></a>3.多个列排序</h4><p>按照部门和工资升序排序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select ename, deptno, sal from emp order by deptno, sal ;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTY5YTgwYjRlZDUyNGU1ZGEucG5n?x-oss-process=image/format,png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注：这个是先按部门号排序，部门号相同，按薪水升序排序</p>
<h4 id="4-每个MapReduce内部排序-Sort-By"><a href="#4-每个MapReduce内部排序-Sort-By" class="headerlink" title="4.每个MapReduce内部排序(Sort By)"></a>4.每个MapReduce内部排序(Sort By)</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Sort By：每个MapReduce内部进行排序，分区规则按照key的hash来运算，(区内排序)对全局结果集来说不是排序。</p>
<h5 id="1-设置reduce个数"><a href="#1-设置reduce个数" class="headerlink" title="(1).设置reduce个数"></a>(1).设置reduce个数</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set mapreduce.job.reduces=3;</span><br></pre></td></tr></table></figure>
<h5 id="2-查看设置reduce个数"><a href="#2-查看设置reduce个数" class="headerlink" title="(2).查看设置reduce个数"></a>(2).查看设置reduce个数</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set mapreduce.job.reduces;</span><br></pre></td></tr></table></figure>
<h5 id="3-根据部门编号降序查看员工信息"><a href="#3-根据部门编号降序查看员工信息" class="headerlink" title="(3).根据部门编号降序查看员工信息"></a>(3).根据部门编号降序查看员工信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp sort by empno desc;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFkNGU1YzRjMzhkZTQ5MDkucG5n?x-oss-process=image/format,png"></p>
<h5 id="4-将查询结果导入到文件中（按照部门编号降序排序）"><a href="#4-将查询结果导入到文件中（按照部门编号降序排序）" class="headerlink" title="(4).将查询结果导入到文件中（按照部门编号降序排序）"></a>(4).将查询结果导入到文件中（按照部门编号降序排序）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert overwrite local directory &#x27;/opt/module/datas/emp.txt&#x27; row format delimited fields terminated by &#x27;\t&#x27; select * from emp sort by deptno desc;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTNkYzNlODlkMDkzZjVmZDgucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWVkODYxNGI5MWZjZjZiZTMucG5n?x-oss-process=image/format,png"></p>
<h4 id="5-分区排序（Distribute-By）"><a href="#5-分区排序（Distribute-By）" class="headerlink" title="5.分区排序（Distribute By）"></a>5.分区排序（Distribute By）</h4><p>Distribute By：类似MR中partition，进行分区，结合sort by使用。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意，Hive要求DISTRIBUTE BY语句要写在SORT BY语句之前。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;对于distribute by进行测试，一定要分配多reduce进行处理，否则无法看到distribute by的效果。</p>
<p>案例实操：</p>
<h5 id="1-先按照部门编号分区，再按照员工编号降序排序。"><a href="#1-先按照部门编号分区，再按照员工编号降序排序。" class="headerlink" title="(1)先按照部门编号分区，再按照员工编号降序排序。"></a>(1)先按照部门编号分区，再按照员工编号降序排序。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set mapreduce.job.reduces=3;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; insert overwrite local directory &#x27;/opt/module/datas/distribute-result&#x27; row format delimited fields terminated by &#x27;\t&#x27; select * from emp distribute by deptno sort by empno desc;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTk5YTA3OWM1N2MxMzQ0MzkucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWNiMjM0NTM3MjNhZGQ2NTkucG5n?x-oss-process=image/format,png"></p>
<h4 id="6-Cluster-By"><a href="#6-Cluster-By" class="headerlink" title="6.Cluster By"></a>6.Cluster By</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;当distribute by和sorts by字段相同时，可以使用cluster by方式。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;cluster by除了具有distribute by的功能外还兼具sort by的功能。但是排序只能是倒序排序，不能指定排序规则为ASC或者DESC。</p>
<h5 id="1-以下两种写法等价"><a href="#1-以下两种写法等价" class="headerlink" title="(1).以下两种写法等价"></a>(1).以下两种写法等价</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert overwrite local directory &#x27;/opt/module/datas/cluster-result&#x27; row format delimited fields terminated by &#x27;\t&#x27; select * from emp cluster by deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWE3YjlmYWUxNDQ3ZjBlN2IucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTZlNjkwZDQwYTA3MGU3OTgucG5n?x-oss-process=image/format,png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp distribute by deptno sort by deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThkZjAyNmFkNjEyZmUwZjcucG5n?x-oss-process=image/format,png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意：按照部门编号分区，不一定就是固定死的数值，可以是20号和30号部门分到一个分区里面去。</p>
<h3 id="六-分桶及抽样查询"><a href="#六-分桶及抽样查询" class="headerlink" title="六.分桶及抽样查询"></a>六.分桶及抽样查询</h3><h4 id="1-分桶表数据存储"><a href="#1-分桶表数据存储" class="headerlink" title="1.分桶表数据存储"></a>1.分桶表数据存储</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;分区针对的是数据的存储路径；分桶针对的是数据文件。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;分区提供一个隔离数据和优化查询的便利方式。不过，并非所有的数据集都可形成合理的分区，特别是之前所提到过的要确定合适的划分大小这个疑虑。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;分桶是将数据集分解成更容易管理的若干部分的另一个技术。</p>
<h5 id="1-先创建分桶表，通过直接导入数据文件的方式"><a href="#1-先创建分桶表，通过直接导入数据文件的方式" class="headerlink" title="(1).先创建分桶表，通过直接导入数据文件的方式"></a>(1).先创建分桶表，通过直接导入数据文件的方式</h5><h6 id="a-数据准备"><a href="#a-数据准备" class="headerlink" title="(a)数据准备"></a>(a)数据准备</h6><h6 id="b-创建分桶表"><a href="#b-创建分桶表" class="headerlink" title="(b)创建分桶表"></a>(b)创建分桶表</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table stu_buck(id int, name string)</span><br><span class="line">clustered by(id) </span><br><span class="line">into 4 buckets</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h6 id="c-查看表结构"><a href="#c-查看表结构" class="headerlink" title="(c )查看表结构"></a>(c )查看表结构</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; desc formatted stu_buck;</span><br></pre></td></tr></table></figure>
<p>Num Buckets:            4<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBhNzExNTA1NDE5YjhhOTMucG5n?x-oss-process=image/format,png"></p>
<h6 id="d-导入数据到分桶表中"><a href="#d-导入数据到分桶表中" class="headerlink" title="(d)导入数据到分桶表中"></a>(d)导入数据到分桶表中</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/s/student.txt&#x27; into table stu_buck;</span><br></pre></td></tr></table></figure>
<h6 id="e-查看创建的分桶表中是否分成4个桶"><a href="#e-查看创建的分桶表中是否分成4个桶" class="headerlink" title="(e)查看创建的分桶表中是否分成4个桶"></a>(e)查看创建的分桶表中是否分成4个桶</h6><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWE0ZWRhNTQ1YTNlYmU4MWQucG5n?x-oss-process=image/format,png"></p>
<p>发现并没有分成4个桶。是什么原因呢？</p>
<h5 id="2-创建分桶表时，数据通过子查询的方式导入"><a href="#2-创建分桶表时，数据通过子查询的方式导入" class="headerlink" title="(2).创建分桶表时，数据通过子查询的方式导入"></a>(2).创建分桶表时，数据通过子查询的方式导入</h5><h6 id="a-先建一个普通的stu表"><a href="#a-先建一个普通的stu表" class="headerlink" title="(a)先建一个普通的stu表"></a>(a)先建一个普通的stu表</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table stu(id int, name string)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>

<h6 id="b-向普通的stu表中导入数据"><a href="#b-向普通的stu表中导入数据" class="headerlink" title="(b)向普通的stu表中导入数据"></a>(b)向普通的stu表中导入数据</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#x27;/opt/module/datas/s/student.txt&#x27; into table stu;</span><br></pre></td></tr></table></figure>
<h6 id="c-清空stu-buck表中数据"><a href="#c-清空stu-buck表中数据" class="headerlink" title="(c )清空stu_buck表中数据"></a>(c )清空stu_buck表中数据</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">truncate table stu_buck;</span><br><span class="line"></span><br><span class="line">select * from stu_buck;</span><br></pre></td></tr></table></figure>
<h6 id="d-导入数据到分桶表，通过子查询的方式"><a href="#d-导入数据到分桶表，通过子查询的方式" class="headerlink" title="(d)导入数据到分桶表，通过子查询的方式"></a>(d)导入数据到分桶表，通过子查询的方式</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into table stu_buck</span><br><span class="line">select id, name from stu;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTJkYjA5YzU5ZTE3YzQ1NTQucG5n?x-oss-process=image/format,png"></p>
<h6 id="e-发现还是只有一个分桶"><a href="#e-发现还是只有一个分桶" class="headerlink" title="(e)发现还是只有一个分桶"></a>(e)发现还是只有一个分桶</h6><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThiNjMxMjliOGRhMjA2YmYucG5n?x-oss-process=image/format,png"></p>
<h6 id="g-需要设置一个属性"><a href="#g-需要设置一个属性" class="headerlink" title="(g)需要设置一个属性"></a>(g)需要设置一个属性</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set hive.enforce.bucketing=true;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; set mapreduce.job.reduces=-1;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; truncate table stu_buck;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; insert into table stu_buck</span><br><span class="line">select id, name from stu;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTAwMTNkNDQ1ODlhY2QxNzcucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQzMmY4NTUwMWYwZDg4NjQucG5n?x-oss-process=image/format,png"></p>
<h6 id="h-查询分桶的数据"><a href="#h-查询分桶的数据" class="headerlink" title="(h)查询分桶的数据"></a>(h)查询分桶的数据</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from stu_buck;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFjNzYwZmE5ZmExNTIyYWIucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-分桶抽样查询"><a href="#2-分桶抽样查询" class="headerlink" title="2.分桶抽样查询"></a>2.分桶抽样查询</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;对于非常大的数据集，有时用户需要使用的是一个具有代表性的查询结果而不是全部结果。Hive可以通过对表进行抽样来满足这个需求。</p>
<p>查询表stu_buck中的数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from stu_buck tablesample(bucket 1 out of 4 on id);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTJkM2M0ZGY4ZGJlMGVkYTYucG5n?x-oss-process=image/format,png"></p>
<p>注：tablesample是抽样语句，语法：TABLESAMPLE(BUCKET x OUT OF y) 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from stu_buck tablesample(bucket 1 out of 3 on id);</span><br></pre></td></tr></table></figure>
<p>不是桶数的倍数或者因子也可以，但是不推荐。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;y必须是table总bucket数的倍数或者因子。hive根据y的大小，决定抽样的比例。例如，table总共分了4份，当y=2时，抽取(4/2=)2个bucket的数据，当y=8时，抽取(4/8=)1/2个bucket的数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from stu_buck tablesample(bucket 1 out of 2 on id);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU3NmFmZGM3NDhmMTlmZGYucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;x表示从哪个bucket开始抽取。例如，table总bucket数为4，tablesample(bucket 4 out of 4)，表示总共抽取（4/4=）1个bucket的数据，抽取第4个bucket的数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from stu_buck tablesample(bucket 1 out of 8 on id);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTgyNjE4MTI0N2ViZTgyMjUucG5n?x-oss-process=image/format,png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意：x的值必须小于等于y的值，否则</p>
<p>FAILED: SemanticException [Error 10061]: Numerator should not be bigger than denominator in sample clause for table stu_buck</p>
<h4 id="3-数据块抽样"><a href="#3-数据块抽样" class="headerlink" title="3.数据块抽样"></a>3.数据块抽样</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Hive提供了另外一种按照百分比进行抽样的方式，这种是基于行数的，按照输入路径下的数据块百分比进行的抽样。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from stu tablesample(0.1 percent) ;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBmNzQxZDY1ZTNiMmRiNzYucG5n?x-oss-process=image/format,png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;提示：这种抽样方式不一定适用于所有的文件格式。另外，这种抽样的最小抽样单元是一个HDFS数据块。因此，如果表的数据大小小于普通的块大小128M的话，那么将会返回所有行。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive之DML数据操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E4%B9%8BDML%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/"
    >Hive DML数据操作</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E4%B9%8BDML%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2019-07-15T10:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-数据导入"><a href="#一-数据导入" class="headerlink" title="一. 数据导入"></a>一. 数据导入</h3><h4 id="1-向表中装载数据（Load）"><a href="#1-向表中装载数据（Load）" class="headerlink" title="1.向表中装载数据（Load）"></a>1.向表中装载数据（Load）</h4><h5 id="1-语法"><a href="#1-语法" class="headerlink" title="(1).语法"></a>(1).语法</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash">load data [<span class="built_in">local</span>] inpath <span class="string">&#x27;/opt/module/datas/student.txt&#x27;</span> [overwrite] into table student [partition (partcol1=val1,…)];</span></span><br></pre></td></tr></table></figure>

<p>(a)load data:表示加载数据<br>(b)local:表示从本地加载数据到hive表；否则从HDFS加载数据到hive表<br>(c )inpath:表示加载数据的路径<br>(d)overwrite:表示覆盖表中已有数据，否则表示追加<br>(e)into table:表示加载到哪张表<br>(f)student:表示具体的表名<br>(g)partition:表示上传到指定分区</p>
<h5 id="2-实操案例"><a href="#2-实操案例" class="headerlink" title="(2).实操案例"></a>(2).实操案例</h5><h6 id="a-创建一张表"><a href="#a-创建一张表" class="headerlink" title="(a)创建一张表"></a>(a)创建一张表</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create table student (id string, name string) row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h6 id="b-加载本地文件到hive"><a href="#b-加载本地文件到hive" class="headerlink" title="(b)加载本地文件到hive"></a>(b)加载本地文件到hive</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/student.txt&#x27; into table default.student;</span><br></pre></td></tr></table></figure>
<h6 id="c-加载HDFS文件到hive中"><a href="#c-加载HDFS文件到hive中" class="headerlink" title="(c)加载HDFS文件到hive中"></a>(c)加载HDFS文件到hive中</h6><p>上传文件到HDFS</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -put /opt/module/datas/student.txt /user/movle/hive;</span><br></pre></td></tr></table></figure>

<p>加载HDFS上数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt;load data inpath &#x27;/user/movle/hive/student.txt&#x27; into table default.student;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWM1ZTVjODkyOTIyNGVhMmMucG5n?x-oss-process=image/format,png"></p>
<h6 id="d-加载数据覆盖表中已有的数据"><a href="#d-加载数据覆盖表中已有的数据" class="headerlink" title="(d)加载数据覆盖表中已有的数据"></a>(d)加载数据覆盖表中已有的数据</h6><p>上传文件到HDFS</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -put /opt/module/datas/student.txt /user/movle/hive/;</span><br></pre></td></tr></table></figure>
<p>加载数据覆盖表中已有的数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt;load data inpath &#x27;/user/movle/hive/student.txt&#x27; overwrite into table default.student;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ4ZjkxM2U4ZDJkMWIzODIucG5n?x-oss-process=image/format,png"></p>
<p>注：load hdfs的数据相当于mv文件到另一个目录中，原目录文件消失</p>
<h4 id="2-通过查询语句向表中插入数据-Insert"><a href="#2-通过查询语句向表中插入数据-Insert" class="headerlink" title="2. 通过查询语句向表中插入数据(Insert)"></a>2. 通过查询语句向表中插入数据(Insert)</h4><h5 id="1-创建一张分区表"><a href="#1-创建一张分区表" class="headerlink" title="(1)创建一张分区表"></a>(1)创建一张分区表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create table student6(id int, name string) partitioned by (month string) row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="2-基本插入数据"><a href="#2-基本插入数据" class="headerlink" title="(2)基本插入数据"></a>(2)基本插入数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert into table  student6 partition(month=&#x27;201909&#x27;) values(1,&#x27;wangwu&#x27;);</span><br></pre></td></tr></table></figure>
<h5 id="3-基本模式插入-根据单张表查询结果"><a href="#3-基本模式插入-根据单张表查询结果" class="headerlink" title="(3)基本模式插入(根据单张表查询结果)"></a>(3)基本模式插入(根据单张表查询结果)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert overwrite table student6 partition(month=&#x27;201908&#x27;)</span><br><span class="line">             select id, name from student6 where month=&#x27;201909&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTRiMTY0MGZjMjU0Mzk1NDYucG5n?x-oss-process=image/format,png"></p>
<h5 id="4-多插入模式-根据多张表查询结果"><a href="#4-多插入模式-根据多张表查询结果" class="headerlink" title="(4)多插入模式(根据多张表查询结果)"></a>(4)多插入模式(根据多张表查询结果)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; from student6</span><br><span class="line">              insert overwrite table student6 partition(month=&#x27;201907&#x27;)</span><br><span class="line">              select id, name where month=&#x27;201909&#x27;</span><br><span class="line">              insert overwrite table student6 partition(month=&#x27;201906&#x27;)</span><br><span class="line">              select id, name where month=&#x27;201909&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTY3YTY5ODA2NjU2ZDBjMTYucG5n?x-oss-process=image/format,png"></p>
<h5 id="3-查询语句中创建表并加载数据-As-Select"><a href="#3-查询语句中创建表并加载数据-As-Select" class="headerlink" title="3.查询语句中创建表并加载数据(As Select)"></a>3.查询语句中创建表并加载数据(As Select)</h5><p>详见5章创建表。<br>根据查询结果创建表（查询的结果会添加到新创建的表中）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student7</span><br><span class="line">as select id, name from student;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTRjZDNhMDAwZDYxYzFlZDQucG5n?x-oss-process=image/format,png"></p>
<h4 id="4-创建表时通过Location指定加载数据路径"><a href="#4-创建表时通过Location指定加载数据路径" class="headerlink" title="4.创建表时通过Location指定加载数据路径"></a>4.创建表时通过Location指定加载数据路径</h4><h5 id="1-创建表，并指定在hdfs上的位置"><a href="#1-创建表，并指定在hdfs上的位置" class="headerlink" title="(1).创建表，并指定在hdfs上的位置"></a>(1).创建表，并指定在hdfs上的位置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create table if not exists student5(</span><br><span class="line">              id int, name string</span><br><span class="line">              )</span><br><span class="line">              row format delimited fields terminated by &#x27;\t&#x27;</span><br><span class="line">              location &#x27;/user/hive/warehouse/student5&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="2-上传数据到hdfs上"><a href="#2-上传数据到hdfs上" class="headerlink" title="(2)上传数据到hdfs上"></a>(2)上传数据到hdfs上</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -put /opt/module/datas/student.txt  /user/hive/warehouse/student5;</span><br></pre></td></tr></table></figure>
<h5 id="3-查询数据"><a href="#3-查询数据" class="headerlink" title="(3)查询数据"></a>(3)查询数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from student5;</span><br></pre></td></tr></table></figure>
<h4 id="5-Import数据到指定Hive表中"><a href="#5-Import数据到指定Hive表中" class="headerlink" title="5.Import数据到指定Hive表中"></a>5.Import数据到指定Hive表中</h4><p>注意：先用export导出后，再将数据导入。同在HDFS上是Copy级操作<br>先导出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; export table default.student6 to &#x27;/user/hive/warehouse/export/student&#x27;;</span><br></pre></td></tr></table></figure>

<p>再导入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; import table student2 partition(month=&#x27;201909&#x27;) from &#x27;/user/hive/warehouse/export/student&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWY5NmQxZDliZWVkYWQ5NzAucG5n?x-oss-process=image/format,png"></p>
<h3 id="二-数据导出"><a href="#二-数据导出" class="headerlink" title="二. 数据导出"></a>二. 数据导出</h3><h4 id="1-Insert导出"><a href="#1-Insert导出" class="headerlink" title="1. Insert导出"></a>1. Insert导出</h4><h5 id="1-将查询的结果导出到本地-数据之间无间隔"><a href="#1-将查询的结果导出到本地-数据之间无间隔" class="headerlink" title="(1).将查询的结果导出到本地,数据之间无间隔"></a>(1).将查询的结果导出到本地,数据之间无间隔</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert overwrite local directory &#x27;/opt/module/datas/export/student&#x27;</span><br><span class="line">            select * from student;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTkzYmQ5ZTMwNTNiZGQyMWUucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTU1ZTk5M2M2ZWRjYTRlMzEucG5n?x-oss-process=image/format,png"></p>
<h5 id="2-将查询的结果格式化导出到本地-数据之间”-t”间隔"><a href="#2-将查询的结果格式化导出到本地-数据之间”-t”间隔" class="headerlink" title="(2)将查询的结果格式化导出到本地,数据之间”\t”间隔"></a>(2)将查询的结果格式化导出到本地,数据之间”\t”间隔</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert overwrite local directory &#x27;/opt/module/datas/export/student1&#x27;</span><br><span class="line">             ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;\t&#x27;             </span><br><span class="line">             select * from student;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWY3ZTY3NzA0YTlmNjM3NDQucG5n?x-oss-process=image/format,png"></p>
<h5 id="3-将查询的结果导出到HDFS上-没有local"><a href="#3-将查询的结果导出到HDFS上-没有local" class="headerlink" title="(3)将查询的结果导出到HDFS上(没有local)"></a>(3)将查询的结果导出到HDFS上(没有local)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; insert overwrite directory &#x27;/user/movle/student2&#x27;</span><br><span class="line">             ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;\t&#x27; </span><br><span class="line">             select * from student;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWZlY2VhZmNmNWU2YjllOGYucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTdjMTMwMTBiNjg5MzEzMjgucG5n?x-oss-process=image/format,png"></p>
<p>注：虽然同是HDFS，但不是copy操作</p>
<h4 id="2-Hadoop命令导出到本地"><a href="#2-Hadoop命令导出到本地" class="headerlink" title="2.Hadoop命令导出到本地"></a>2.Hadoop命令导出到本地</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -get /user/hive/warehouse/student6/month=201909/000000_0  /opt/module/datas/export/student3.txt;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTJjMWQyNWYxNTYxNGYzODYucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-Hive-Shell-命令导出"><a href="#3-Hive-Shell-命令导出" class="headerlink" title="3.Hive Shell 命令导出"></a>3.Hive Shell 命令导出</h4><p>基本语法：(hive -f/-e 执行语句或者脚本 &gt; file)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -e &#x27;select * from default.student;&#x27; &gt; /opt/module/datas/export/student4.txt;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTMwYTI0Nzk0Yzc1YjdjOTAucG5n?x-oss-process=image/format,png"></p>
<h4 id="4-Export导出到HDFS上"><a href="#4-Export导出到HDFS上" class="headerlink" title="4. Export导出到HDFS上"></a>4. Export导出到HDFS上</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; export table default.student to &#x27;/user/hive/warehouse/export/student2&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTc2MTAwOWU4YmVmYzg5NDkucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTdmODY5NzFkZDgxNzI2MjAucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTU4NzAyOWFkYzUxZmM4M2YucG5n?x-oss-process=image/format,png"></p>
<h4 id="5-Sqoop导出"><a href="#5-Sqoop导出" class="headerlink" title="5.Sqoop导出"></a>5.Sqoop导出</h4><h3 id="三-清除表中数据-Truncate"><a href="#三-清除表中数据-Truncate" class="headerlink" title="三.清除表中数据(Truncate)"></a>三.清除表中数据(Truncate)</h3><p>注意：Truncate只能删除管理表，不能删除外部表中数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; truncate table student;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive DDL数据定义"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%20DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89/"
    >Hive DDL数据定义</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%20DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89/" class="article-date">
  <time datetime="2019-07-15T09:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-创建数据库"><a href="#一-创建数据库" class="headerlink" title="一.创建数据库"></a>一.创建数据库</h3><h4 id="1-创建一个数据库，数据库在HDFS上的默认存储路径是-user-hive-warehouse-db。"><a href="#1-创建一个数据库，数据库在HDFS上的默认存储路径是-user-hive-warehouse-db。" class="headerlink" title="1.创建一个数据库，数据库在HDFS上的默认存储路径是/user/hive/warehouse/*.db。"></a>1.创建一个数据库，数据库在HDFS上的默认存储路径是/user/hive/warehouse/*.db。</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create database db_hive;</span><br></pre></td></tr></table></figure>
<p><strong>可能出现的报错：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. MetaException(message:For direct MetaStore DB connections, we don&#x27;t support retries at the client level.)</span><br></pre></td></tr></table></figure>
<p><strong>解决办法</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mo_ing/article/details/81219533">https://blog.csdn.net/mo_ing/article/details/81219533</a></p>
<p>个人解决版本：使用mysql-connector-java-5.1.27.jar，而不是mysql-connector-java-5.1.18.jar</p>
<h4 id="2-避免要创建的数据库已经存在错误，增加if-not-exists判断。（标准写法）"><a href="#2-避免要创建的数据库已经存在错误，增加if-not-exists判断。（标准写法）" class="headerlink" title="2.避免要创建的数据库已经存在错误，增加if not exists判断。（标准写法）"></a>2.避免要创建的数据库已经存在错误，增加if not exists判断。（标准写法）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> create database db_hive;</span></span><br></pre></td></tr></table></figure>
<p>FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. Database db_hive already exists</p>
<p>标准写法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create database if not exists db_hive;</span><br></pre></td></tr></table></figure>

<h4 id="3-创建一个数据库，指定数据库在HDFS上存放的位置"><a href="#3-创建一个数据库，指定数据库在HDFS上存放的位置" class="headerlink" title="3.创建一个数据库，指定数据库在HDFS上存放的位置"></a>3.创建一个数据库，指定数据库在HDFS上存放的位置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create database db_hive2 location &#x27;/db_hive2.db&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBiNGUzNTY2NjU2MTA3MWMucG5n?x-oss-process=image/format,png"></p>
<h3 id="二-修改数据库"><a href="#二-修改数据库" class="headerlink" title="二.修改数据库"></a>二.修改数据库</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;用户可以使用ALTER DATABASE命令为某个数据库的DBPROPERTIES设置键-值对属性值，来描述这个数据库的属性信息。数据库的其他元数据信息都是不可更改的，包括数据库名和数据库所在的目录位置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter database db_hive set dbproperties(&#x27;createtime&#x27;=&#x27;20190506&#x27;);</span><br></pre></td></tr></table></figure>
<p>在mysql中查看修改结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc database extended db_hive;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTgxY2E4NDU2MjczM2YyYjcucG5n?x-oss-process=image/format,png"></p>
<h3 id="三-查询数据库"><a href="#三-查询数据库" class="headerlink" title="三.查询数据库"></a>三.查询数据库</h3><h4 id="1-显示数据库"><a href="#1-显示数据库" class="headerlink" title="1.显示数据库"></a>1.显示数据库</h4><h5 id="1-显示数据库-1"><a href="#1-显示数据库-1" class="headerlink" title="(1)显示数据库"></a>(1)显示数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> show databases;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-过滤显示查询的数据库"><a href="#2-过滤显示查询的数据库" class="headerlink" title="(2)过滤显示查询的数据库"></a>(2)过滤显示查询的数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> show databases like <span class="string">&#x27;db_hive*&#x27;</span>;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ4YTEzMzkxZDQ5OThhZTEucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-查看数据库详情"><a href="#2-查看数据库详情" class="headerlink" title="2. 查看数据库详情"></a>2. 查看数据库详情</h4><h5 id="1-显示数据库信息"><a href="#1-显示数据库信息" class="headerlink" title="(1)显示数据库信息"></a>(1)显示数据库信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc database db_hive;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-显示数据库详细信息，extended"><a href="#2-显示数据库详细信息，extended" class="headerlink" title="(2)显示数据库详细信息，extended"></a>(2)显示数据库详细信息，extended</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc database extended db_hive;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTM1NDI4N2ExN2E3MjE3MGUucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-切换当前数据库"><a href="#3-切换当前数据库" class="headerlink" title="3.切换当前数据库"></a>3.切换当前数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; use db_hive;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTMxOWI2ZDkzMTQ1NTdiMGYucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h3 id="四-删除数据库"><a href="#四-删除数据库" class="headerlink" title="四.删除数据库"></a>四.删除数据库</h3><h4 id="1-删除空数据库"><a href="#1-删除空数据库" class="headerlink" title="1.删除空数据库"></a>1.删除空数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash">drop database db_hive2;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-如果删除的数据库不存在，最好采用-if-exists判断数据库是否存在"><a href="#2-如果删除的数据库不存在，最好采用-if-exists判断数据库是否存在" class="headerlink" title="2.如果删除的数据库不存在，最好采用 if exists判断数据库是否存在"></a>2.如果删除的数据库不存在，最好采用 if exists判断数据库是否存在</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> drop database db_hive2;</span></span><br></pre></td></tr></table></figure>
<p>正确做法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> drop database <span class="keyword">if</span> exists db_hive2;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBlMmVmMTgyMGQ4NTFjOTkucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-如果数据库不为空，可以采用cascade命令，强制删除"><a href="#3-如果数据库不为空，可以采用cascade命令，强制删除" class="headerlink" title="3.如果数据库不为空，可以采用cascade命令，强制删除"></a>3.如果数据库不为空，可以采用cascade命令，强制删除</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> drop database db_hive;</span></span><br></pre></td></tr></table></figure>
<p>正确做法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> drop database db_hive cascade;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThlYTEwOTk5OTJmMjNiMzkucG5n?x-oss-process=image/format,png"></p>
<h3 id="五-创建表"><a href="#五-创建表" class="headerlink" title="五.创建表"></a>五.创建表</h3><h4 id="1-建表语法"><a href="#1-建表语法" class="headerlink" title="1.建表语法"></a>1.建表语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[(col_name data_type [COMMENT col_comment], ...)] </span><br><span class="line"></span><br><span class="line">[COMMENT table_comment] </span><br><span class="line"></span><br><span class="line">[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] </span><br><span class="line"></span><br><span class="line">[CLUSTERED BY (col_name, col_name, ...) </span><br><span class="line"></span><br><span class="line">[SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] </span><br><span class="line"></span><br><span class="line">[ROW FORMAT row_format] </span><br><span class="line"></span><br><span class="line">[STORED AS file_format] </span><br><span class="line"></span><br><span class="line">[LOCATION hdfs_path]</span><br></pre></td></tr></table></figure>

<h4 id="2-字段解释说明："><a href="#2-字段解释说明：" class="headerlink" title="2..字段解释说明："></a>2..字段解释说明：</h4><h5 id="1-CREATE-TABLE-创建一个指定名字的表。"><a href="#1-CREATE-TABLE-创建一个指定名字的表。" class="headerlink" title="(1)CREATE TABLE 创建一个指定名字的表。"></a>(1)CREATE TABLE 创建一个指定名字的表。</h5><p>如果相同名字的表已经存在，则抛出异常；用户可以用 IF NOT EXISTS 选项来忽略这个异常。</p>
<h5 id="2-EXTERNAL关键字可以让用户创建一个外部表"><a href="#2-EXTERNAL关键字可以让用户创建一个外部表" class="headerlink" title="(2)EXTERNAL关键字可以让用户创建一个外部表"></a>(2)EXTERNAL关键字可以让用户创建一个外部表</h5><p>在建表的同时指定一个指向实际数据的路径(LOCATION)，Hive创建内部表时，会将数据移动到数据仓库指向的路径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。</p>
<h5 id="3-COMMENT：为表和列添加注释。"><a href="#3-COMMENT：为表和列添加注释。" class="headerlink" title="(3)COMMENT：为表和列添加注释。"></a>(3)COMMENT：为表和列添加注释。</h5><h5 id="4-PARTITIONED-BY-创建分区表"><a href="#4-PARTITIONED-BY-创建分区表" class="headerlink" title="(4)PARTITIONED BY   创建分区表"></a>(4)PARTITIONED BY   创建分区表</h5><h5 id="5-CLUSTERED-BY-创建分桶表"><a href="#5-CLUSTERED-BY-创建分桶表" class="headerlink" title="(5)CLUSTERED BY  创建分桶表"></a>(5)CLUSTERED BY  创建分桶表</h5><h5 id="6-SORTED-BY-不常用"><a href="#6-SORTED-BY-不常用" class="headerlink" title="(6)SORTED BY    不常用"></a>(6)SORTED BY    不常用</h5><h5 id="7-ROW-FORMAT"><a href="#7-ROW-FORMAT" class="headerlink" title="(7)ROW FORMAT"></a>(7)ROW FORMAT</h5><p>DELIMITED [FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char] [MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char] | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, …)]</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;用户在建表的时候可以自定义SerDe或者使用自带的SerDe。如果没有指定ROW FORMAT 或者ROW FORMAT DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表的具体的列的数据。</p>
<h5 id="8-STORED-AS指定存储文件类型"><a href="#8-STORED-AS指定存储文件类型" class="headerlink" title="(8)STORED AS指定存储文件类型"></a>(8)STORED AS指定存储文件类型</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;常用的存储文件类型：SEQUENCEFILE(二进制序列文件)、TEXTFILE(文本)、RCFILE(列式存储格式文件)<br>&nbsp;&nbsp;&nbsp;&nbsp;如果文件数据是纯文本，可以使用STORED AS TEXTFILE。如果数据需要压缩，使用 STORED AS SEQUENCEFILE。</p>
<h5 id="9-LOCATION-：指定表在HDFS上的存储位置。"><a href="#9-LOCATION-：指定表在HDFS上的存储位置。" class="headerlink" title="(9)LOCATION ：指定表在HDFS上的存储位置。"></a>(9)LOCATION ：指定表在HDFS上的存储位置。</h5><h5 id="10-LIKE允许用户复制现有的表结构，但是不复制数据。"><a href="#10-LIKE允许用户复制现有的表结构，但是不复制数据。" class="headerlink" title="(10)LIKE允许用户复制现有的表结构，但是不复制数据。"></a>(10)LIKE允许用户复制现有的表结构，但是不复制数据。</h5><h3 id="六-管理表"><a href="#六-管理表" class="headerlink" title="六.管理表"></a>六.管理表</h3><h4 id="1-理论"><a href="#1-理论" class="headerlink" title="1.理论"></a>1.理论</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或少地）控制着数据的生命周期。Hive默认情况下会将这些表的数据存储在由配置项hive.metastore.warehouse.dir(例如，/user/hive/warehouse)所定义的目录的子目录下。   当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享数据。</p>
<h4 id="2-案例实操"><a href="#2-案例实操" class="headerlink" title="2.案例实操"></a>2.案例实操</h4><h5 id="1-普通创建表"><a href="#1-普通创建表" class="headerlink" title="(1)普通创建表"></a>(1)普通创建表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student2(</span><br><span class="line"></span><br><span class="line">id int, name string</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;</span><br><span class="line"></span><br><span class="line">stored as textfile</span><br><span class="line"></span><br><span class="line">location &#x27;/user/hive/warehouse/student2&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="2-根据查询结果创建表（查询的结果会添加到新创建的表中）"><a href="#2-根据查询结果创建表（查询的结果会添加到新创建的表中）" class="headerlink" title="(2)根据查询结果创建表（查询的结果会添加到新创建的表中）"></a>(2)根据查询结果创建表（查询的结果会添加到新创建的表中）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student3</span><br><span class="line">as select id from student;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTI0NTA4Mzc0MWMwMzU3OTQucG5n?x-oss-process=image/format,png"></p>
<h5 id="3-根据已经存在的表结构创建表"><a href="#3-根据已经存在的表结构创建表" class="headerlink" title="(3)根据已经存在的表结构创建表"></a>(3)根据已经存在的表结构创建表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student4 like student;</span><br></pre></td></tr></table></figure>

<h5 id="4-查询表的类型"><a href="#4-查询表的类型" class="headerlink" title="(4)查询表的类型"></a>(4)查询表的类型</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; desc formatted student4;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQ5ZDQ2NjQ3MGIxZWZlNTkucG5n?x-oss-process=image/format,png"></p>
<h3 id="七-外部表"><a href="#七-外部表" class="headerlink" title="七. 外部表"></a>七. 外部表</h3><h4 id="1-理论-1"><a href="#1-理论-1" class="headerlink" title="1.理论"></a>1.理论</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;因为表是外部表，所以Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这份数据，不过描述表的元数据信息会被删除掉。</p>
<h4 id="2-管理表和外部表的使用场景："><a href="#2-管理表和外部表的使用场景：" class="headerlink" title="2.管理表和外部表的使用场景："></a>2.管理表和外部表的使用场景：</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT+INSERT进入内部表。</p>
<h4 id="3-案例实操"><a href="#3-案例实操" class="headerlink" title="3.案例实操"></a>3.案例实操</h4><p>分别创建部门和员工外部表，并向表中导入数据。</p>
<h5 id="1-原始数据"><a href="#1-原始数据" class="headerlink" title="(1)原始数据"></a>(1)原始数据</h5><h5 id="2-建表语句"><a href="#2-建表语句" class="headerlink" title="(2)建表语句"></a>(2)建表语句</h5><p>创建部门表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create external table if not exists default.dept(</span><br><span class="line">deptno int,</span><br><span class="line">dname string,</span><br><span class="line">loc int</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTU5YWY5OTI0MjIwZGViZmYucG5n?x-oss-process=image/format,png"><br>创建员工表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create external table if not exists default.emp(</span><br><span class="line">empno int,</span><br><span class="line">ename string,</span><br><span class="line">job string,</span><br><span class="line">mgr int,</span><br><span class="line">hiredate string, </span><br><span class="line">sal double, </span><br><span class="line">comm double,</span><br><span class="line">deptno int)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="3-查看创建的表"><a href="#3-查看创建的表" class="headerlink" title="(3)查看创建的表"></a>(3)查看创建的表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; show tables;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTNiMTI0NzZjZWEzYWZmNWMucG5n?x-oss-process=image/format,png" alt="查看创建的表"></p>
<h5 id="4-向外部表中导入数据"><a href="#4-向外部表中导入数据" class="headerlink" title="(4)向外部表中导入数据"></a>(4)向外部表中导入数据</h5><p>导入数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/emp.txt&#x27; into table default.emp;</span><br></pre></td></tr></table></figure>
<p>查询结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; select * from dept;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWRkZjliMWFhOTQ1YjQ1NDMucG5n?x-oss-process=image/format,png"></p>
<h5 id="5-查看表格式化数据"><a href="#5-查看表格式化数据" class="headerlink" title="(5)查看表格式化数据"></a>(5)查看表格式化数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; desc formatted dept;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTgzNGYzNDM4NzYxZmFiN2EucG5n?x-oss-process=image/format,png"></p>
<h3 id="八-分区表"><a href="#八-分区表" class="headerlink" title="八.分区表"></a>八.分区表</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;分区表实际上就是对应一个HDFS文件系统上的独立的文件夹，该文件夹下是该分区所有的数据文件。Hive中的分区就是分目录，把一个大的数据集根据业务需要分割成小的数据集。在查询时通过WHERE子句中的表达式选择查询所需要的指定的分区，这样的查询效率会提高很多。</p>
<h4 id="1-分区表基本操作"><a href="#1-分区表基本操作" class="headerlink" title="1.分区表基本操作"></a>1.分区表基本操作</h4><h5 id="1-引入分区表（需要根据日期对日志进行管理）"><a href="#1-引入分区表（需要根据日期对日志进行管理）" class="headerlink" title="(1)引入分区表（需要根据日期对日志进行管理）"></a>(1)引入分区表（需要根据日期对日志进行管理）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/user/hive/warehouse/log_partition/20190702/20190702.log</span><br><span class="line"></span><br><span class="line">/user/hive/warehouse/log_partition/20190703/20190703.log</span><br><span class="line"></span><br><span class="line">/user/hive/warehouse/log_partition/20190704/20190704.log</span><br></pre></td></tr></table></figure>
<h5 id="2-创建分区表语法"><a href="#2-创建分区表语法" class="headerlink" title="(2)创建分区表语法"></a>(2)创建分区表语法</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create table dept_partition(</span><br><span class="line">               deptno int, dname string, loc string</span><br><span class="line">               )</span><br><span class="line">               partitioned by (month string)</span><br><span class="line">               row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="3-加载数据到分区表中"><a href="#3-加载数据到分区表中" class="headerlink" title="(3)加载数据到分区表中"></a>(3)加载数据到分区表中</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept_partition partition(month=&#x27;201909&#x27;);</span><br><span class="line"></span><br><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept_partition partition(month=&#x27;201908&#x27;);</span><br><span class="line"></span><br><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept_partition partition(month=&#x27;201907&#x27;);</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTIwNWRjM2RkZDg0ODk3NWIucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWJjNGFmM2RiZThhYTgxMzcucG5n?x-oss-process=image/format,png"></p>
<h5 id="4-查询分区表中数据"><a href="#4-查询分区表中数据" class="headerlink" title="(4)查询分区表中数据"></a>(4)查询分区表中数据</h5><p>单分区查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition where month=&#x27;201909&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBiZTg5MGUyM2U2NWQxMzUucG5n?x-oss-process=image/format,png"></p>
<p>多分区联合查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition where month=&#x27;201909&#x27;</span><br><span class="line">              union</span><br><span class="line">              select * from dept_partition where month=&#x27;201908&#x27;</span><br><span class="line">              union</span><br><span class="line">              select * from dept_partition where month=&#x27;201907&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBjODAxYmRkYTMyZDlkYjgucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWI5MWRmZGY0ZjJhNWYyM2MucG5n?x-oss-process=image/format,png"></p>
<h5 id="5-增加分区"><a href="#5-增加分区" class="headerlink" title="(5)增加分区"></a>(5)增加分区</h5><p>创建单个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition add partition(month=&#x27;201906&#x27;) ;</span><br></pre></td></tr></table></figure>
<p>同时创建多个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt;  alter table dept_partition add partition(month=&#x27;201905&#x27;) partition(month=&#x27;201904&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQzNDQ2M2NiNGRlM2EyZWYucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU1MTZkNDRjMzI0YTVhZjMucG5n?x-oss-process=image/format,png"></p>
<p>注：增加多个分区之间用空格” “隔开，删除多个分区用”,”隔开</p>
<h5 id="6-删除分区"><a href="#6-删除分区" class="headerlink" title="(6)删除分区"></a>(6)删除分区</h5><p>删除单个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition drop partition (month=&#x27;201904&#x27;);</span><br></pre></td></tr></table></figure>
<p>同时删除多个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition drop partition (month=&#x27;201905&#x27;), partition (month=&#x27;201906&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTIyNjI0ZTc2MDg3MTBlMDMucG5n?x-oss-process=image/format,png"></p>
<h5 id="7-查看分区表有多少分区"><a href="#7-查看分区表有多少分区" class="headerlink" title="(7)查看分区表有多少分区"></a>(7)查看分区表有多少分区</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> show partitions dept_partition;</span></span><br></pre></td></tr></table></figure>
<h5 id="8-查看分区表结构"><a href="#8-查看分区表结构" class="headerlink" title="(8)查看分区表结构"></a>(8)查看分区表结构</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc formatted dept_partition;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWQxZmZmZWRhNjFkMWRjN2EucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-分区表注意事项"><a href="#2-分区表注意事项" class="headerlink" title="2.分区表注意事项"></a>2.分区表注意事项</h4><h5 id="1-创建二级分区表"><a href="#1-创建二级分区表" class="headerlink" title="(1).创建二级分区表"></a>(1).创建二级分区表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create table dept_partition2(</span><br><span class="line">               deptno int, dname string, loc string</span><br><span class="line">               )</span><br><span class="line">               partitioned by (month string, day string)</span><br><span class="line">               row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="2-正常的加载数据"><a href="#2-正常的加载数据" class="headerlink" title="(2).正常的加载数据"></a>(2).正常的加载数据</h5><h6 id="a-加载数据到二级分区表中"><a href="#a-加载数据到二级分区表中" class="headerlink" title="(a)加载数据到二级分区表中"></a>(a)加载数据到二级分区表中</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept_partition2 partition(month=&#x27;201909&#x27;, day=&#x27;13&#x27;);</span><br></pre></td></tr></table></figure>
<h6 id="b-查询分区数据"><a href="#b-查询分区数据" class="headerlink" title="(b)查询分区数据"></a>(b)查询分区数据</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition2 where month=&#x27;201909&#x27; and day=&#x27;13&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFiYzAwMmY0MmE1ZmJlZGEucG5n?x-oss-process=image/format,png"></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTI5MTdlZjI3NTY3NzM5OGMucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-把数据直接上传到分区目录上，让分区表和数据产生关联的两种方式"><a href="#3-把数据直接上传到分区目录上，让分区表和数据产生关联的两种方式" class="headerlink" title="3.把数据直接上传到分区目录上，让分区表和数据产生关联的两种方式"></a>3.把数据直接上传到分区目录上，让分区表和数据产生关联的两种方式</h4><h5 id="1-方式一：上传数据后修复"><a href="#1-方式一：上传数据后修复" class="headerlink" title="(1)方式一：上传数据后修复"></a>(1)方式一：上传数据后修复</h5><p>上传数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201909/day=12;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201909/day=12;</span><br></pre></td></tr></table></figure>

<p>查询数据（查询不到刚上传的数据）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition2 where month=&#x27;201909&#x27; and day=&#x27;12&#x27;;</span><br></pre></td></tr></table></figure>
<p>执行修复命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash">msck repair table dept_partition2;</span></span><br></pre></td></tr></table></figure>
<p>再次查询数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition2 where month=&#x27;201909&#x27; and day=&#x27;12&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTMwNzIzNGJhZmYzMGMxZDIucG5n?x-oss-process=image/format,png"></p>
<h5 id="2-方式二：上传数据后添加分区"><a href="#2-方式二：上传数据后添加分区" class="headerlink" title="(2)方式二：上传数据后添加分区"></a>(2)方式二：上传数据后添加分区</h5><p>上传数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201909/day=11;</span><br><span class="line"></span><br><span class="line">hive (default)&gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201909/day=11;</span><br></pre></td></tr></table></figure>
<p>执行添加分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition2 add partition(month=&#x27;201909&#x27;, day=&#x27;11&#x27;);</span><br></pre></td></tr></table></figure>
<p>查询数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition2 where month=&#x27;201909&#x27; and day=&#x27;11&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWUyNDhjNWVhOTY1ZGRlNmEucG5n?x-oss-process=image/format,png"></p>
<h5 id="3-方式三：上传数据后load数据到分区"><a href="#3-方式三：上传数据后load数据到分区" class="headerlink" title="(3)方式三：上传数据后load数据到分区"></a>(3)方式三：上传数据后load数据到分区</h5><p>创建目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201909/day=10;</span><br></pre></td></tr></table></figure>
<p>上传数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table dept_partition2 partition(month=&#x27;201909&#x27;,day=&#x27;10&#x27;);</span><br></pre></td></tr></table></figure>
<p>查询数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from dept_partition2 where month=&#x27;201909&#x27; and day=&#x27;10&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTc3MjE3MjlmMzY3NzQyNGQucG5n?x-oss-process=image/format,png"></p>
<h3 id="九-修改表"><a href="#九-修改表" class="headerlink" title="九.修改表"></a>九.修改表</h3><h4 id="1-重命名表"><a href="#1-重命名表" class="headerlink" title="1.重命名表"></a>1.重命名表</h4><h5 id="1-语法"><a href="#1-语法" class="headerlink" title="(1).语法"></a>(1).语法</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name RENAME TO new_table_name</span><br></pre></td></tr></table></figure>
<h5 id="2-实操案例"><a href="#2-实操案例" class="headerlink" title="(2).实操案例"></a>(2).实操案例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition2 rename to dept_partition4;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTU4MmQ2MGJjZmFjZGE3N2YucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-增加和删除表分区"><a href="#2-增加和删除表分区" class="headerlink" title="2. 增加和删除表分区"></a>2. 增加和删除表分区</h4><p>详见1.6.1分区表基本操作。同上</p>
<h4 id="3-增加-修改-替换列信息"><a href="#3-增加-修改-替换列信息" class="headerlink" title="3. 增加/修改/替换列信息"></a>3. 增加/修改/替换列信息</h4><h5 id="1-语法-1"><a href="#1-语法-1" class="headerlink" title="(1).语法"></a>(1).语法</h5><p>更新列</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]</span><br></pre></td></tr></table></figure>

<p>增加和替换列</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...) </span><br></pre></td></tr></table></figure>
<p>注：ADD是代表新增一字段，字段位置在所有列后面(partition列前)，REPLACE则是表示替换表中所有字段。</p>
<h5 id="2-实操案例-1"><a href="#2-实操案例-1" class="headerlink" title="(2).实操案例"></a>(2).实操案例</h5><h6 id="a-查询表结构"><a href="#a-查询表结构" class="headerlink" title="(a)查询表结构"></a>(a)查询表结构</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> desc dept_partition;</span></span><br></pre></td></tr></table></figure>
<h6 id="b-添加列"><a href="#b-添加列" class="headerlink" title="(b)添加列"></a>(b)添加列</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition add columns(deptdesc string);</span><br></pre></td></tr></table></figure>
<h6 id="c-查询表结构"><a href="#c-查询表结构" class="headerlink" title="(c )查询表结构"></a>(c )查询表结构</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash">desc dept_partition;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWZjMzZhZWI2NmE4YTUyNjMucG5n?x-oss-process=image/format,png"></p>
<h6 id="d-更新列"><a href="#d-更新列" class="headerlink" title="(d)更新列"></a>(d)更新列</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition change column deptdesc desc int;</span><br></pre></td></tr></table></figure>
<h6 id="e-查询表结构"><a href="#e-查询表结构" class="headerlink" title="(e)查询表结构"></a>(e)查询表结构</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash">desc dept_partition;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LThiODRiNjc1ODEwN2U5OTQucG5n?x-oss-process=image/format,png"></p>
<h6 id="f-替换列"><a href="#f-替换列" class="headerlink" title="(f)替换列"></a>(f)替换列</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; alter table dept_partition replace columns(deptno string, dname string, loc string);</span><br></pre></td></tr></table></figure>
<h6 id="g-查询表结构"><a href="#g-查询表结构" class="headerlink" title="(g)查询表结构"></a>(g)查询表结构</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash">desc dept_partition;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBhMDEzYzJmMWQzNDgwYTUucG5n?x-oss-process=image/format,png"></p>
<h3 id="十-删除表"><a href="#十-删除表" class="headerlink" title="十.删除表"></a>十.删除表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; drop table dept_partition;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive将本地文件导入Hive案例"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E5%B0%86%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5Hive%E6%A1%88%E4%BE%8B/"
    >Hive将本地文件导入Hive案例</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E5%B0%86%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5Hive%E6%A1%88%E4%BE%8B/" class="article-date">
  <time datetime="2019-07-15T08:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="0-需求："><a href="#0-需求：" class="headerlink" title="0.需求："></a>0.需求：</h4><p>将本地/opt/module/datas/student.txt这个目录下的数据导入到hive的student(id int, name string)表中。</p>
<h4 id="1-数据准备：在-opt-module-datas-student-txt这个目录下准备数据"><a href="#1-数据准备：在-opt-module-datas-student-txt这个目录下准备数据" class="headerlink" title="1.数据准备：在/opt/module/datas/student.txt这个目录下准备数据"></a>1.数据准备：在/opt/module/datas/student.txt这个目录下准备数据</h4><h5 id="1-在-opt-module-目录下创建datas"><a href="#1-在-opt-module-目录下创建datas" class="headerlink" title="(1)在/opt/module/目录下创建datas"></a>(1)在/opt/module/目录下创建datas</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir datas</span><br></pre></td></tr></table></figure>
<h5 id="2-在-opt-module-datas-目录下创建student-txt文件并添加数据"><a href="#2-在-opt-module-datas-目录下创建student-txt文件并添加数据" class="headerlink" title="(2)在/opt/module/datas/目录下创建student.txt文件并添加数据"></a>(2)在/opt/module/datas/目录下创建student.txt文件并添加数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch student.txt</span><br><span class="line">vi student.txt</span><br></pre></td></tr></table></figure>
<p>添加内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1001	zhangshan</span><br><span class="line">1002	lishi</span><br><span class="line">1003	zhaoliu</span><br></pre></td></tr></table></figure>
<p>注意以tab键间隔。</p>
<h4 id="2-Hive实际操作"><a href="#2-Hive实际操作" class="headerlink" title="2.Hive实际操作"></a>2.Hive实际操作</h4><h5 id="1-启动hive"><a href="#1-启动hive" class="headerlink" title="(1)启动hive"></a>(1)启动hive</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive</span><br></pre></td></tr></table></figure>
<h5 id="2-显示数据库"><a href="#2-显示数据库" class="headerlink" title="(2)显示数据库"></a>(2)显示数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
<h5 id="3-使用default数据库"><a href="#3-使用default数据库" class="headerlink" title="(3)使用default数据库"></a>(3)使用default数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use default;</span><br></pre></td></tr></table></figure>
<h5 id="4-显示default数据库中的表"><a href="#4-显示default数据库中的表" class="headerlink" title="(4)显示default数据库中的表"></a>(4)显示default数据库中的表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>
<h5 id="5-删除已创建的student表"><a href="#5-删除已创建的student表" class="headerlink" title="(5)删除已创建的student表"></a>(5)删除已创建的student表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table student;</span><br></pre></td></tr></table></figure>
<h5 id="6-创建student表-并声明文件分隔符’-t’"><a href="#6-创建student表-并声明文件分隔符’-t’" class="headerlink" title="(6)创建student表, 并声明文件分隔符’\t’"></a>(6)创建student表, 并声明文件分隔符’\t’</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table student(id int, name string) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>
<h5 id="7-加载-opt-module-datas-student-txt-文件到student数据库表中。"><a href="#7-加载-opt-module-datas-student-txt-文件到student数据库表中。" class="headerlink" title="(7)加载/opt/module/datas/student.txt 文件到student数据库表中。"></a>(7)加载/opt/module/datas/student.txt 文件到student数据库表中。</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#x27;/opt/module/datas/student.txt&#x27; into table student;</span><br></pre></td></tr></table></figure>
<h5 id="8-Hive查询结果"><a href="#8-Hive查询结果" class="headerlink" title="(8)Hive查询结果"></a>(8)Hive查询结果</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWIxOWRjMWI0YTNiM2Q5ZjcucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<p><strong>可能是编码的问题吧，留个坑</strong><br>在hdfs中就是正常的，所以应该是格式问题</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQyYjVjMmZmYzQ3YzQ0ZjYucG5n?x-oss-process=image/format,png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive参数配置方式"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F/"
    >Hive参数配置方式</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F/" class="article-date">
  <time datetime="2019-07-15T07:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-查看当前所有的配置信息"><a href="#1-查看当前所有的配置信息" class="headerlink" title="1.查看当前所有的配置信息"></a>1.查看当前所有的配置信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTcxYjk1MzhhMzViZjU4NWQucG5n?x-oss-process=image/format,png"></p>
<h4 id="2-参数的配置三种方式"><a href="#2-参数的配置三种方式" class="headerlink" title="2.参数的配置三种方式"></a>2.参数的配置三种方式</h4><h5 id="1-配置文件方式"><a href="#1-配置文件方式" class="headerlink" title="(1)配置文件方式"></a>(1)配置文件方式</h5><ul>
<li>默认配置文件：hive-default.xml </li>
<li>用户自定义配置文件：hive-site.xml</li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本机启动的所有Hive进程都有效。</p>
<h5 id="2-命令行参数方式"><a href="#2-命令行参数方式" class="headerlink" title="(2)命令行参数方式"></a>(2)命令行参数方式</h5><p>启动Hive时，可以在命令行添加-hiveconf param=value来设定参数。<br>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -hiveconf mapred.reduce.tasks=10;</span><br></pre></td></tr></table></figure>
<p>注意：仅对本次hive启动有效<br>查看参数设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set mapred.reduce.tasks;</span><br></pre></td></tr></table></figure>
<p>显示为：mapred.reduce.tasks=10<br>默认mapred.reduce.tasks=-1</p>
<h5 id="3-参数声明方式"><a href="#3-参数声明方式" class="headerlink" title="(3)参数声明方式"></a>(3)参数声明方式</h5><p>可以在HQL中使用SET关键字设定参数<br>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set mapred.reduce.tasks=10;</span><br></pre></td></tr></table></figure>
<p>注意：仅对本次hive启动有效。<br>查看参数设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; set mapred.reduce.tasks;</span><br></pre></td></tr></table></figure>
<p>上述三种设定方式的优先级依次递增。即配置文件&lt;命令行参数&lt;参数声明。注意某些系统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话建立以前已经完成了。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive常见属性配置"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/"
    >Hive常见属性配置</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2019-07-15T06:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-Hive数据仓库位置配置"><a href="#1-Hive数据仓库位置配置" class="headerlink" title="1.Hive数据仓库位置配置"></a>1.Hive数据仓库位置配置</h4><h5 id="1-Default数据仓库的最原始位置是在hdfs上的：-user-hive-warehouse路径下"><a href="#1-Default数据仓库的最原始位置是在hdfs上的：-user-hive-warehouse路径下" class="headerlink" title="(1)Default数据仓库的最原始位置是在hdfs上的：/user/hive/warehouse路径下"></a>(1)Default数据仓库的最原始位置是在hdfs上的：/user/hive/warehouse路径下</h5><h5 id="2-在仓库目录下，没有对默认的数据库default创建文件夹。如果某张表属于default数据库，直接在数据仓库目录下创建一个文件夹。"><a href="#2-在仓库目录下，没有对默认的数据库default创建文件夹。如果某张表属于default数据库，直接在数据仓库目录下创建一个文件夹。" class="headerlink" title="(2)在仓库目录下，没有对默认的数据库default创建文件夹。如果某张表属于default数据库，直接在数据仓库目录下创建一个文件夹。"></a>(2)在仓库目录下，没有对默认的数据库default创建文件夹。如果某张表属于default数据库，直接在数据仓库目录下创建一个文件夹。</h5><h5 id="3-修改default数据仓库原始位置-将hive-default-xml-template如下配置信息拷贝到hive-site-xml文件中"><a href="#3-修改default数据仓库原始位置-将hive-default-xml-template如下配置信息拷贝到hive-site-xml文件中" class="headerlink" title="(3)修改default数据仓库原始位置(将hive-default.xml.template如下配置信息拷贝到hive-site.xml文件中)"></a>(3)修改default数据仓库原始位置(将hive-default.xml.template如下配置信息拷贝到hive-site.xml文件中)</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>location of default database for the warehouse<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置同组用户有执行权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -chmod g+w /user/hive/warehouse</span><br></pre></td></tr></table></figure>
<h4 id="2-查询后信息显示配置"><a href="#2-查询后信息显示配置" class="headerlink" title="2.查询后信息显示配置"></a>2.查询后信息显示配置</h4><h5 id="1-在hive-site-xml文件中添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置。"><a href="#1-在hive-site-xml文件中添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置。" class="headerlink" title="(1)在hive-site.xml文件中添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置。"></a>(1)在hive-site.xml文件中添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置。</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.header<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.current.db<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-重新启动hive，对比配置前后差异"><a href="#2-重新启动hive，对比配置前后差异" class="headerlink" title="(2)重新启动hive，对比配置前后差异"></a>(2)重新启动hive，对比配置前后差异</h5><p>(a)配置前<br>(b)配置后</p>
<h4 id="3-Hive运行日志信息配置"><a href="#3-Hive运行日志信息配置" class="headerlink" title="3 Hive运行日志信息配置"></a>3 Hive运行日志信息配置</h4><h5 id="1-Hive的log默认存放在-tmp-itstar-hive-log目录下-当前用户名下"><a href="#1-Hive的log默认存放在-tmp-itstar-hive-log目录下-当前用户名下" class="headerlink" title="(1)Hive的log默认存放在/tmp/itstar/hive.log目录下(当前用户名下)"></a>(1)Hive的log默认存放在/tmp/itstar/hive.log目录下(当前用户名下)</h5><h5 id="2-修改hive的log存放日志到-opt-module-hive-logs"><a href="#2-修改hive的log存放日志到-opt-module-hive-logs" class="headerlink" title="(2)修改hive的log存放日志到/opt/module/hive/logs"></a>(2)修改hive的log存放日志到/opt/module/hive/logs</h5><h6 id="a-修改-opt-module-hive-conf-hive-log4j-properties-template文件名称为hive-log4j-properties"><a href="#a-修改-opt-module-hive-conf-hive-log4j-properties-template文件名称为hive-log4j-properties" class="headerlink" title="(a)修改/opt/module/hive/conf/hive-log4j.properties.template文件名称为hive-log4j.properties"></a>(a)修改/opt/module/hive/conf/hive-log4j.properties.template文件名称为hive-log4j.properties</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line"></span><br><span class="line">mv hive-log4j.properties.template hive-log4j.properties</span><br></pre></td></tr></table></figure>
<h6 id="b-在hive-log4j-properties文件中修改log存放位置"><a href="#b-在hive-log4j-properties文件中修改log存放位置" class="headerlink" title="(b)在hive-log4j.properties文件中修改log存放位置"></a>(b)在hive-log4j.properties文件中修改log存放位置</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive.log.dir=/opt/module/hive/logs</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive基本操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"
    >Hive基本操作</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2019-07-15T05:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-Hive基本操作"><a href="#一-Hive基本操作" class="headerlink" title="一.Hive基本操作"></a>一.Hive基本操作</h3><h4 id="1-启动hive"><a href="#1-启动hive" class="headerlink" title="1.启动hive"></a>1.启动hive</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive</span><br></pre></td></tr></table></figure>
<h4 id="2-查看数据库"><a href="#2-查看数据库" class="headerlink" title="2.查看数据库"></a>2.查看数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
<h4 id="3-打开默认数据库"><a href="#3-打开默认数据库" class="headerlink" title="3.打开默认数据库"></a>3.打开默认数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use default;</span><br></pre></td></tr></table></figure>
<h4 id="4-显示default数据库中的表"><a href="#4-显示default数据库中的表" class="headerlink" title="4.显示default数据库中的表"></a>4.显示default数据库中的表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>
<h4 id="5-创建一张表"><a href="#5-创建一张表" class="headerlink" title="5.创建一张表"></a>5.创建一张表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table student(id int, name string) ;</span><br></pre></td></tr></table></figure>
<h4 id="6-显示数据库中有几张表"><a href="#6-显示数据库中有几张表" class="headerlink" title="6.显示数据库中有几张表"></a>6.显示数据库中有几张表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>
<h4 id="7-查看表的结构"><a href="#7-查看表的结构" class="headerlink" title="7.查看表的结构"></a>7.查看表的结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc student;</span><br></pre></td></tr></table></figure>
<h4 id="8-向表中插入数据"><a href="#8-向表中插入数据" class="headerlink" title="8.向表中插入数据"></a>8.向表中插入数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into student values(1001,&quot;ss1&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="9-查询表中数据"><a href="#9-查询表中数据" class="headerlink" title="9.查询表中数据"></a>9.查询表中数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student;</span><br></pre></td></tr></table></figure>
<h4 id="10-退出hive"><a href="#10-退出hive" class="headerlink" title="10.退出hive"></a>10.退出hive</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit;</span><br></pre></td></tr></table></figure>
<h3 id="二-hive常用交互命令"><a href="#二-hive常用交互命令" class="headerlink" title="二.hive常用交互命令"></a>二.hive常用交互命令</h3><h4 id="1-“-e”不进入hive的交互窗口执行sql语句"><a href="#1-“-e”不进入hive的交互窗口执行sql语句" class="headerlink" title="1.“-e”不进入hive的交互窗口执行sql语句"></a>1.“-e”不进入hive的交互窗口执行sql语句</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -e &quot;select id from student;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTYwZTJiNzBhOGYxZDQ1OTMucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h4 id="2-“-f”执行脚本中sql语句"><a href="#2-“-f”执行脚本中sql语句" class="headerlink" title="2.“-f”执行脚本中sql语句"></a>2.“-f”执行脚本中sql语句</h4><h5 id="1-在-opt-module-datas目录下创建hivef-sql文件"><a href="#1-在-opt-module-datas目录下创建hivef-sql文件" class="headerlink" title="(1)在/opt/module/datas目录下创建hivef.sql文件"></a>(1)在/opt/module/datas目录下创建hivef.sql文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch hive.sql</span><br></pre></td></tr></table></figure>
<p>文件中写入正确的sql语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student;</span><br></pre></td></tr></table></figure>

<h5 id="2-执行文件中的sql语句"><a href="#2-执行文件中的sql语句" class="headerlink" title="(2)执行文件中的sql语句"></a>(2)执行文件中的sql语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -f /opt/module/datas/hive.sql</span><br></pre></td></tr></table></figure>

<h5 id="3-执行文件中的sql语句并将结果写入文件中-注：可能含有其他的表信息，如表头"><a href="#3-执行文件中的sql语句并将结果写入文件中-注：可能含有其他的表信息，如表头" class="headerlink" title="(3)执行文件中的sql语句并将结果写入文件中(注：可能含有其他的表信息，如表头)"></a>(3)执行文件中的sql语句并将结果写入文件中(注：可能含有其他的表信息，如表头)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -f /opt/module/datas/hive.sql  &gt; /opt/module/datas/hive_result.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQ3ZDc5NDlhOTc3NjczMzgucG5n?x-oss-process=image/format,png"></p>
<h3 id="三-Hive其他命令操作"><a href="#三-Hive其他命令操作" class="headerlink" title="三.Hive其他命令操作"></a>三.Hive其他命令操作</h3><h4 id="1-退出hive窗口："><a href="#1-退出hive窗口：" class="headerlink" title="1.退出hive窗口："></a>1.退出hive窗口：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit;</span><br><span class="line">quit;</span><br></pre></td></tr></table></figure>
<p>在新版的oracle中没区别了，在以前的版本是有的：<br>exit:先隐性提交数据，再退出；<br>quit:不提交数据，退出；</p>
<h4 id="2-在hive-cli命令窗口中如何查看hdfs文件系统"><a href="#2-在hive-cli命令窗口中如何查看hdfs文件系统" class="headerlink" title="2.在hive cli命令窗口中如何查看hdfs文件系统"></a>2.在hive cli命令窗口中如何查看hdfs文件系统</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs -ls /;</span><br></pre></td></tr></table></figure>
<h4 id="3-在hive-cli命令窗口中如何查看linux本地系统"><a href="#3-在hive-cli命令窗口中如何查看linux本地系统" class="headerlink" title="3.在hive cli命令窗口中如何查看linux本地系统"></a>3.在hive cli命令窗口中如何查看linux本地系统</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! ls /opt/module/datas;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTVjNDU2MjE5ZTRhODE0MjIucG5n?x-oss-process=image/format,png"></p>
<h4 id="4-查看在hive中输入的所有历史命令"><a href="#4-查看在hive中输入的所有历史命令" class="headerlink" title="4.查看在hive中输入的所有历史命令"></a>4.查看在hive中输入的所有历史命令</h4><h5 id="1-进入到当前用户的根目录-root或-home-itstar"><a href="#1-进入到当前用户的根目录-root或-home-itstar" class="headerlink" title="(1)进入到当前用户的根目录/root或/home/itstar"></a>(1)进入到当前用户的根目录/root或/home/itstar</h5><h5 id="2-查看-hivehistory文件"><a href="#2-查看-hivehistory文件" class="headerlink" title="(2)查看. hivehistory文件"></a>(2)查看. hivehistory文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat .hivehistory</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTExYjlkMjUyMWVmYjMyMDkucG5n?x-oss-process=image/format,png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive安装配置"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"
    >Hive安装部署</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2019-07-15T04:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="1-前提："><a href="#1-前提：" class="headerlink" title="1.前提："></a>1.前提：</h4><ul>
<li>mysql已安装</li>
<li>hadoop集群已配置</li>
</ul>
<h4 id="2-步骤"><a href="#2-步骤" class="headerlink" title="2.步骤"></a>2.步骤</h4><h5 id="1-把apache-hive-1-2-1-bin-tar-gz上传到linux的-opt-software目录下"><a href="#1-把apache-hive-1-2-1-bin-tar-gz上传到linux的-opt-software目录下" class="headerlink" title="(1)把apache-hive-1.2.1-bin.tar.gz上传到linux的/opt/software目录下"></a>(1)把apache-hive-1.2.1-bin.tar.gz上传到linux的/opt/software目录下</h5><h5 id="2-解压apache-hive-1-2-1-bin-tar-gz到-opt-module-目录下面"><a href="#2-解压apache-hive-1-2-1-bin-tar-gz到-opt-module-目录下面" class="headerlink" title="(2)解压apache-hive-1.2.1-bin.tar.gz到/opt/module/目录下面"></a>(2)解压apache-hive-1.2.1-bin.tar.gz到/opt/module/目录下面</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /opt/module/</span><br></pre></td></tr></table></figure>
<h5 id="3-修改apache-hive-1-2-1-bin的名称为hive-1-2-1"><a href="#3-修改apache-hive-1-2-1-bin的名称为hive-1-2-1" class="headerlink" title="(3)修改apache-hive-1.2.1-bin的名称为hive-1.2.1"></a>(3)修改apache-hive-1.2.1-bin的名称为hive-1.2.1</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module</span><br><span class="line"></span><br><span class="line">mv apache-hive-1.2.1-bin/ hive-1.2.1</span><br></pre></td></tr></table></figure>

<h5 id="4-修改环境变量："><a href="#4-修改环境变量：" class="headerlink" title="(4)修改环境变量："></a>(4)修改环境变量：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure>
<p>添加内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HIVE_HOME=/opt/module/hive-1.2.1</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWFjNDUxZDNiMGRiOWU2MzUucG5n?x-oss-process=image/format,png"></p>
<p>使环境变量生效：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h5 id="5-修改-opt-module-hive-conf目录下的hive-env-sh-template名称为hive-env-sh"><a href="#5-修改-opt-module-hive-conf目录下的hive-env-sh-template名称为hive-env-sh" class="headerlink" title="(5)修改/opt/module/hive/conf目录下的hive-env.sh.template名称为hive-env.sh"></a>(5)修改/opt/module/hive/conf目录下的hive-env.sh.template名称为hive-env.sh</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv hive-env.sh.template hive-env.sh</span><br></pre></td></tr></table></figure>
<h5 id="6-配置hive-env-sh文件"><a href="#6-配置hive-env-sh文件" class="headerlink" title="(6)配置hive-env.sh文件"></a>(6)配置hive-env.sh文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi hive-env.sh</span><br></pre></td></tr></table></figure>
<p>配置HADOOP_HOME路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_HOME=/opt/module/hadoop-2.8.4</span><br><span class="line">export HIVE_CONF_DIR=/opt/module/hive-1.2.1/conf</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTFlMDZkYmY1Mjk0NzdmNzQucG5n?x-oss-process=image/format,png"></p>
<h5 id="7-注：Hive的log默认存放在-tmp-itstar-hive-log目录下（当前用户名下）。"><a href="#7-注：Hive的log默认存放在-tmp-itstar-hive-log目录下（当前用户名下）。" class="headerlink" title="(7)注：Hive的log默认存放在/tmp/itstar/hive.log目录下（当前用户名下）。"></a>(7)注：Hive的log默认存放在/tmp/itstar/hive.log目录下（当前用户名下）。</h5><h6 id="a-修改hive的log存放日志到-opt-module-hive-logs"><a href="#a-修改hive的log存放日志到-opt-module-hive-logs" class="headerlink" title="(a)修改hive的log存放日志到/opt/module/hive/logs"></a>(a)修改hive的log存放日志到/opt/module/hive/logs</h6><h6 id="b-修改conf-hive-log4j-properties-template文件名称为hive-log4j-properties"><a href="#b-修改conf-hive-log4j-properties-template文件名称为hive-log4j-properties" class="headerlink" title="(b)修改conf/hive-log4j.properties.template文件名称为hive-log4j.properties"></a>(b)修改conf/hive-log4j.properties.template文件名称为hive-log4j.properties</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line"></span><br><span class="line">mv hive-log4j.properties.template hive-log4j.properties</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWU4YzhlMGEzMzUyNDlkMzUucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h6 id="c-在hive-log4j-properties文件中修改log存放位置"><a href="#c-在hive-log4j-properties文件中修改log存放位置" class="headerlink" title="(c )在hive-log4j.properties文件中修改log存放位置"></a>(c )在hive-log4j.properties文件中修改log存放位置</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hive-1.2.1</span><br><span class="line"></span><br><span class="line">mkdir logs</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTExOWJhNzFlZTQ2OTUwMTkucG5n?x-oss-process=image/format,png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hive-1.2.1/conf</span><br><span class="line"></span><br><span class="line">vi hive-log4j.properties </span><br></pre></td></tr></table></figure>
<p>修改内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive.log.dir=/opt/module/hive-1.2.1/logs</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTY3ZDFiZTUxNWE0OWQwNjUucG5n?x-oss-process=image/format,png"></p>
<h5 id="8-Hadoop-配置"><a href="#8-Hadoop-配置" class="headerlink" title="(8)Hadoop 配置"></a>(8)Hadoop 配置</h5><h6 id="a-必须启动hdfs和yarn"><a href="#a-必须启动hdfs和yarn" class="headerlink" title="(a)必须启动hdfs和yarn"></a>(a)必须启动hdfs和yarn</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-dfs.sh</span><br><span class="line"></span><br><span class="line">sbin/start-yarn.sh</span><br></pre></td></tr></table></figure>
<h6 id="b-在HDFS上创建-tmp和-user-hive-warehouse两个目录并修改他们的同组权限可写"><a href="#b-在HDFS上创建-tmp和-user-hive-warehouse两个目录并修改他们的同组权限可写" class="headerlink" title="(b)在HDFS上创建/tmp和/user/hive/warehouse两个目录并修改他们的同组权限可写"></a>(b)在HDFS上创建/tmp和/user/hive/warehouse两个目录并修改他们的同组权限可写</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /tmp</span><br><span class="line">hadoop fs -mkdir -p /user/hive/warehouse</span><br><span class="line"></span><br><span class="line">hadoop fs -chmod g+w /tmp</span><br><span class="line">hadoop fs -chmod g+w /user/hive/warehouse</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTVlMjk4OTRjNjM4MTYyZjQucG5n?x-oss-process=image/format,png" alt="image.png"></p>
<h5 id="9-将hive元数据配置到mysql"><a href="#9-将hive元数据配置到mysql" class="headerlink" title="(9).将hive元数据配置到mysql"></a>(9).将hive元数据配置到mysql</h5><h6 id="a-将mysql-connector-java-5-1-27-jar上传到-opt-module-hive-1-2-1-lib中："><a href="#a-将mysql-connector-java-5-1-27-jar上传到-opt-module-hive-1-2-1-lib中：" class="headerlink" title="(a)将mysql-connector-java-5.1.27.jar上传到/opt/module/hive-1.2.1/lib中："></a>(a)将mysql-connector-java-5.1.27.jar上传到/opt/module/hive-1.2.1/lib中：</h6><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTdmNTU2MmQ4YjJiMWM5OTUucG5n?x-oss-process=image/format,png"></p>
<h6 id="b-创建hive-site-xml"><a href="#b-创建hive-site-xml" class="headerlink" title="(b)创建hive-site.xml"></a>(b)创建hive-site.xml</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hive-1.2.1/conf</span><br><span class="line"></span><br><span class="line">touch hive-site.xml</span><br><span class="line"></span><br><span class="line">vi hive-site.xml</span><br></pre></td></tr></table></figure>

<p>添加内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://hadoop1:3306/metastore1?createDatabaseIfNotExist=true<span class="symbol">&amp;amp;</span>characterEncoding=utf-8<span class="symbol">&amp;amp;</span>useSSL=false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>000000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：最好是在mysql所在的服务器中安装hive</p>
<h6 id="c-配置完毕后，如果启动hive异常，可以重新启动虚拟机。-重启后，别忘了启动hadoop集群"><a href="#c-配置完毕后，如果启动hive异常，可以重新启动虚拟机。-重启后，别忘了启动hadoop集群" class="headerlink" title="(c ).配置完毕后，如果启动hive异常，可以重新启动虚拟机。(重启后，别忘了启动hadoop集群)"></a>(c ).配置完毕后，如果启动hive异常，可以重新启动虚拟机。(重启后，别忘了启动hadoop集群)</h6><h6 id="d-在hive的bin目录下执行"><a href="#d-在hive的bin目录下执行" class="headerlink" title="(d)在hive的bin目录下执行"></a>(d)在hive的bin目录下执行</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./schematool -dbType mysql -initSchema</span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWJiNGMzNjdiOTcwNjM5ZDQucG5n?x-oss-process=image/format,png"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTUyMGY2ZTI5Nzg5OTE5YmIucG5n?x-oss-process=image/format,png" alt="创建成功"></p>
<h5 id="10-添加其他配置信息："><a href="#10-添加其他配置信息：" class="headerlink" title="(10).添加其他配置信息："></a>(10).添加其他配置信息：</h5><p>命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/module/hive-1.2.1/conf/hive-site.xml</span><br></pre></td></tr></table></figure>

<p>添加内容：</p>
<h6 id="a-修改default数据仓库原始位置"><a href="#a-修改default数据仓库原始位置" class="headerlink" title="(a)修改default数据仓库原始位置"></a>(a)修改default数据仓库原始位置</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>location of default database for the warehouse<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="b-添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置"><a href="#b-添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置" class="headerlink" title="(b)添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置"></a>(b)添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.header<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.current.db<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTBlMzIzNGUwYjNjMTMxMGUucG5n?x-oss-process=image/format,png" alt="配置"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTVlMmZiOGFkYjQ0MzA5NmQucG5n?x-oss-process=image/format,png" alt="配置后启动hive"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" rel="tag">安装部署</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Hive基本概念"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/07/15/Hive%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"
    >Hive基本概念</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/07/15/Hive%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" class="article-date">
  <time datetime="2019-07-15T03:00:00.000Z" itemprop="datePublished">2019-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hive/">Hive</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="一-Hive基本概念："><a href="#一-Hive基本概念：" class="headerlink" title="一.Hive基本概念："></a>一.Hive基本概念：</h3><h4 id="1-Hive"><a href="#1-Hive" class="headerlink" title="1. Hive"></a>1. Hive</h4><h5 id="1-官网：http-hive-apache-org"><a href="#1-官网：http-hive-apache-org" class="headerlink" title="(1).官网：http://hive.apache.org/"></a>(1).官网：<a target="_blank" rel="noopener" href="http://hive.apache.org/">http://hive.apache.org/</a></h5><h5 id="2-Apache-HiveTM数据仓库软件有助于使用SQL读取，编写和管理驻留在分布式存储中的-大型数据集。可以将结构投影到已存储的数据中。提供了命令行工具和JDBC驱动程序以-将用户连接到Hive。"><a href="#2-Apache-HiveTM数据仓库软件有助于使用SQL读取，编写和管理驻留在分布式存储中的-大型数据集。可以将结构投影到已存储的数据中。提供了命令行工具和JDBC驱动程序以-将用户连接到Hive。" class="headerlink" title="(2).Apache HiveTM数据仓库软件有助于使用SQL读取，编写和管理驻留在分布式存储中的 大型数据集。可以将结构投影到已存储的数据中。提供了命令行工具和JDBC驱动程序以 将用户连接到Hive。"></a>(2).Apache HiveTM数据仓库软件有助于使用SQL读取，编写和管理驻留在分布式存储中的 大型数据集。可以将结构投影到已存储的数据中。提供了命令行工具和JDBC驱动程序以 将用户连接到Hive。</h5><h5 id="3-hive提供了SQL查询功能-hdfs分布式存储"><a href="#3-hive提供了SQL查询功能-hdfs分布式存储" class="headerlink" title="(3).hive提供了SQL查询功能 hdfs分布式存储"></a>(3).hive提供了SQL查询功能 hdfs分布式存储</h5><h5 id="4-hive本质HQL转化为MapReduce程序。"><a href="#4-hive本质HQL转化为MapReduce程序。" class="headerlink" title="(4).hive本质HQL转化为MapReduce程序。"></a>(4).hive本质HQL转化为MapReduce程序。</h5><h5 id="5-环境前提："><a href="#5-环境前提：" class="headerlink" title="(5).环境前提："></a>(5).环境前提：</h5><ul>
<li>启动hdfs集群</li>
<li>启动yarn集群</li>
</ul>
<p>如果想用hive的话，需要提前安装部署好hadoop集群。</p>
<h4 id="2-为什么要学习Hive"><a href="#2-为什么要学习Hive" class="headerlink" title="2.为什么要学习Hive"></a>2.为什么要学习Hive</h4><h5 id="1-简化开发"><a href="#1-简化开发" class="headerlink" title="(1).简化开发"></a>(1).简化开发</h5><h5 id="2-优势："><a href="#2-优势：" class="headerlink" title="(2).优势："></a>(2).优势：</h5><h6 id="a-操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）"><a href="#a-操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）" class="headerlink" title="(a)操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）"></a>(a)操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）</h6><h6 id="b-避免了去写MapReduce，减少开发人员的学习成本。"><a href="#b-避免了去写MapReduce，减少开发人员的学习成本。" class="headerlink" title="(b)避免了去写MapReduce，减少开发人员的学习成本。"></a>(b)避免了去写MapReduce，减少开发人员的学习成本。</h6><h6 id="c-Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合"><a href="#c-Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合" class="headerlink" title="(c )Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合"></a>(c )Hive的执行延迟比较高，<strong>因此Hive常用于数据分析，对实时性要求不高的场合</strong></h6><h6 id="d-Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高"><a href="#d-Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高" class="headerlink" title="(d)Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高"></a>(d)Hive优势在于处理大数据，<strong>对于处理小数据没有优势，因为Hive的执行延迟比较高</strong></h6><h6 id="e-Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。"><a href="#e-Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。" class="headerlink" title="(e)Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。"></a>(e)Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</h6><h4 id="3-劣势："><a href="#3-劣势：" class="headerlink" title="3.劣势："></a>3.劣势：</h4><h5 id="1-Hive的HQL表达能力有限"><a href="#1-Hive的HQL表达能力有限" class="headerlink" title="(1)Hive的HQL表达能力有限"></a>(1)Hive的HQL表达能力有限</h5><ul>
<li>迭代式算法无法表达</li>
<li>数据挖掘方面不擅长</li>
</ul>
<h5 id="2-Hive的效率比较低"><a href="#2-Hive的效率比较低" class="headerlink" title="(2)Hive的效率比较低"></a>(2)Hive的效率比较低</h5><ul>
<li>Hive自动生成的MapReduce作业，通常情况下不够智能化</li>
<li>Hive调优比较困难，粒度较粗</li>
</ul>
<h4 id="3-Hive架构原理："><a href="#3-Hive架构原理：" class="headerlink" title="3.Hive架构原理："></a>3.Hive架构原理：</h4><p>sql-&gt;转换-&gt;mapreduce-&gt;job</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTYxZTllNDdlZjQ0MmM2NGIucG5n?x-oss-process=image/format,png" alt="Hive架构原理"></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTQ4MTE5MzczZDk2MmM2MDQucG5n?x-oss-process=image/format,png" alt="Hive架构"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;如图中所示，Hive通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将执行返回的结果输出到用户交互接口。</p>
<h5 id="1-用户接口：Client"><a href="#1-用户接口：Client" class="headerlink" title="(1).用户接口：Client"></a>(1).用户接口：Client</h5><p>CLI(hive shell)、JDBC/ODBC(java访问hive)、WEBUI(浏览器访问hive)</p>
<h5 id="2-元数据：Metastore"><a href="#2-元数据：Metastore" class="headerlink" title="(2).元数据：Metastore"></a>(2).元数据：Metastore</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等；<br>&nbsp;&nbsp;&nbsp;&nbsp;默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore</p>
<h5 id="3-Hadoop"><a href="#3-Hadoop" class="headerlink" title="(3).Hadoop"></a>(3).Hadoop</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;使用HDFS进行存储，使用MapReduce进行计算。</p>
<h5 id="4-驱动器：Driver"><a href="#4-驱动器：Driver" class="headerlink" title="(4).驱动器：Driver"></a>(4).驱动器：Driver</h5><h6 id="a-解析器-SQL-Parser-："><a href="#a-解析器-SQL-Parser-：" class="headerlink" title="(a)解析器(SQL Parser)："></a>(a)解析器(SQL Parser)：</h6><p>将SQL字符串转换成抽象语法树AST，这一步一般都用第三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL语义是否有误。</p>
<h6 id="b-编译器-Physical-Plan-："><a href="#b-编译器-Physical-Plan-：" class="headerlink" title="(b)编译器(Physical Plan)："></a>(b)编译器(Physical Plan)：</h6><p>将AST编译生成逻辑执行计划。</p>
<h6 id="c-优化器-Query-Optimizer-："><a href="#c-优化器-Query-Optimizer-：" class="headerlink" title="(c )优化器(Query Optimizer)："></a>(c )优化器(Query Optimizer)：</h6><p>对逻辑执行计划进行优化。</p>
<h6 id="d-执行器-Execution-："><a href="#d-执行器-Execution-：" class="headerlink" title="(d)执行器(Execution)："></a>(d)执行器(Execution)：</h6><p>把逻辑执行计划转换成可以运行的物理计划。对于Hive来说，就是MR/Spark。</p>
<h4 id="4-Hive和数据库比较"><a href="#4-Hive和数据库比较" class="headerlink" title="4.Hive和数据库比较"></a>4.Hive和数据库比较</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;由于 Hive 采用了类似SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。</p>
<h5 id="1-查询语言"><a href="#1-查询语言" class="headerlink" title="(1).查询语言"></a>(1).查询语言</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。</p>
<h5 id="2-数据存储位置"><a href="#2-数据存储位置" class="headerlink" title="(2).数据存储位置"></a>(2).数据存储位置</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;Hive 是建立在 Hadoop 之上的，所有 Hive 的数据都是存储在 HDFS 中的。而数据库则可以将数据保存在块设备或者本地文件系统中。</p>
<h5 id="3-数据更新"><a href="#3-数据更新" class="headerlink" title="(3). 数据更新"></a>(3). 数据更新</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中不支持对数据的改写和添加，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需要经常进行修改的，因此可以使用 INSERT INTO …  VALUES 添加数据，使用 UPDATE … SET修改数据。</p>
<h5 id="4-索引"><a href="#4-索引" class="headerlink" title="(4). 索引"></a>(4). 索引</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;Hive在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些Key建立索引。Hive要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了 Hive 不适合在线数据查询。</p>
<h5 id="5-执行"><a href="#5-执行" class="headerlink" title="(5). 执行"></a>(5). 执行</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;Hive中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的。而数据库通常有自己的执行引擎。</p>
<h5 id="6-执行延迟"><a href="#6-执行延迟" class="headerlink" title="(6). 执行延迟"></a>(6). 执行延迟</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导致 Hive 执行延迟高的因素是 MapReduce框架。由于MapReduce 本身具有较高的延迟，因此在利用MapReduce 执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，Hive的并行计算显然能体现出优势。</p>
<h5 id="7-可扩展性"><a href="#7-可扩展性" class="headerlink" title="(7).可扩展性"></a>(7).可扩展性</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;由于Hive是建立在Hadoop之上的，因此Hive的可扩展性是和Hadoop的可扩展性是一致的(世界上最大的Hadoop 集群在 Yahoo!，2009年的规模在4000 台节点左右)。而数据库由于 ACID 语义的严格限制，扩展行非常有限。目前最先进的并行数据库Oracle在理论上的扩展能力也只有100台左右。</p>
<h5 id="8-数据规模"><a href="#8-数据规模" class="headerlink" title="(8). 数据规模"></a>(8). 数据规模</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模的数据；对应的，数据库可以支持的数据规模较小。</p>
<h3 id="二-Hive数据类型"><a href="#二-Hive数据类型" class="headerlink" title="二.Hive数据类型"></a>二.Hive数据类型</h3><h4 id="1-基本数据类型"><a href="#1-基本数据类型" class="headerlink" title="1.基本数据类型"></a>1.基本数据类型</h4><table>
<thead>
<tr>
<th align="center">Hive数据类型</th>
<th align="center">Java数据类型</th>
<th align="center">长度</th>
<th align="center">例子</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TINYINT</td>
<td align="center">byte</td>
<td align="center">1byte有符号整数</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">SMALINT</td>
<td align="center">short</td>
<td align="center">2byte有符号整数</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">INT</td>
<td align="center">int</td>
<td align="center">4byte有符号整数</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">BIGINT</td>
<td align="center">long</td>
<td align="center">8byte有符号整数</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">BOOLEAN</td>
<td align="center">boolean</td>
<td align="center">布尔类型，true或者false</td>
<td align="center">TRUE  FALSE</td>
</tr>
<tr>
<td align="center">FLOAT</td>
<td align="center">float</td>
<td align="center">单精度浮点数</td>
<td align="center">3.14159</td>
</tr>
<tr>
<td align="center">DOUBLE</td>
<td align="center">double</td>
<td align="center">双精度浮点数</td>
<td align="center">3.14159</td>
</tr>
<tr>
<td align="center">STRING</td>
<td align="center">string</td>
<td align="center">字符系列。可以指定字符集。可以使用单引号或者双引号</td>
<td align="center">‘now is the time’ “for all good men”</td>
</tr>
<tr>
<td align="center">TIMESTAMP</td>
<td align="center"></td>
<td align="center">时间类型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BINARY</td>
<td align="center"></td>
<td align="center">字节数组</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>&nbsp;&nbsp;&nbsp;&nbsp;对于Hive的String类型相当于数据库的varchar类型，该类型是一个可变的字符串，不过它不能 其中最多能存储多少个字符，理论上它可以存储2GB的字符数。</p>
<h4 id="2-集合数据类型"><a href="#2-集合数据类型" class="headerlink" title="2.集合数据类型"></a>2.集合数据类型</h4><table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">描述</th>
<th align="center">语法示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">STRUCT</td>
<td align="center">和c语言中的struct类似，都可以通过“点”符号访问元素内容。例如，如果某个列的数据类型是STRUCT{first STRING, last STRING},那么第1个元素可以通过字段.first来引用</td>
<td align="center">struct()</td>
</tr>
<tr>
<td align="center">MAP</td>
<td align="center">MAP是一组键-值对元组集合，使用数组表示法可以访问数据。例如，如果某个列的数据类型是MAP，其中键-&gt;值对是’first’-&gt;’John’和’last’-&gt;’Doe’，那么可以通过字段名[‘last’]获取最后一个元素</td>
<td align="center">map()</td>
</tr>
<tr>
<td align="center">ARRAY</td>
<td align="center">数组是一组具有相同类型和名称的变量的集合。这些变量称为数组的元素，每个数组元素都有一个编号，编号从零开始。例如，数组值为[‘John’, ‘Doe’]，那么第2个元素可以通过数组名[1]进行引用</td>
<td align="center">Array()</td>
</tr>
</tbody></table>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Hive有三种复杂数据类型ARRAY、MAP 和 STRUCT。ARRAY和MAP与Java中的Array和Map类似，而STRUCT与C语言中的Struct类似，它封装了一个命名字段集合，复杂数据类型允许任意层次的嵌套。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table heheee(`来试试` string,`来试试1` string,`来试试2` string) row format delimited fields terminated by &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>案例实操</strong></p>
<h5 id="1-假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格式为"><a href="#1-假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格式为" class="headerlink" title="(1)假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格式为"></a>(1)假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格式为</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;songsong&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;friends&quot;</span>: [<span class="string">&quot;bingbing&quot;</span> , <span class="string">&quot;lili&quot;</span>] ,       <span class="comment">//列表Array, </span></span><br><span class="line">    <span class="attr">&quot;children&quot;</span>: &#123;                      <span class="comment">//键值Map,</span></span><br><span class="line">        <span class="attr">&quot;xiao song&quot;</span>: <span class="number">18</span> ,</span><br><span class="line">        <span class="attr">&quot;xiaoxiao song&quot;</span>: <span class="number">19</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;address&quot;</span>: &#123;                      <span class="comment">//结构Struct,</span></span><br><span class="line">        <span class="attr">&quot;street&quot;</span>: <span class="string">&quot;hai dian qu&quot;</span> ,</span><br><span class="line">        <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;beijing&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-基于上述数据结构，我们在Hive里创建对应的表，并导入数据。"><a href="#2-基于上述数据结构，我们在Hive里创建对应的表，并导入数据。" class="headerlink" title="(2)基于上述数据结构，我们在Hive里创建对应的表，并导入数据。"></a>(2)基于上述数据结构，我们在Hive里创建对应的表，并导入数据。</h5><p>创建本地测试文件test.txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/datas/</span><br><span class="line"></span><br><span class="line">touch text.txt</span><br></pre></td></tr></table></figure>
<p>添加内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">songsong,bingbing_lili,xiao song:18_xiaoxiao song:19,hai dian qu_beijing</span><br><span class="line"></span><br><span class="line">yangyang,caicai_susu,xiao yang:18_xiaoxiao yang:19,chao yang_beijing</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTcxNmExMWVlMzA4MTQxM2IucG5n?x-oss-process=image/format,png"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意，MAP，STRUCT和ARRAY里的元素间关系都可以用同一个字符表示，这里用“_”。</p>
<h5 id="3-Hive上创建测试表test"><a href="#3-Hive上创建测试表test" class="headerlink" title="(3)Hive上创建测试表test"></a>(3)Hive上创建测试表test</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table test(</span><br><span class="line">name string,</span><br><span class="line">friends array&lt;string&gt;,</span><br><span class="line">children map&lt;string, int&gt;,</span><br><span class="line">address struct&lt;street:string, city:string&gt;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#x27;,&#x27;</span><br><span class="line">collection items terminated by &#x27;_&#x27;</span><br><span class="line">map keys terminated by &#x27;:&#x27;</span><br><span class="line">lines terminated by &#x27;\n&#x27;;</span><br></pre></td></tr></table></figure>

<p>字段解释：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">row format delimited fields terminated by &#x27;,&#x27;     -- 列分隔符</span><br><span class="line">collection items terminated by &#x27;_&#x27;  	          --MAP STRUCT 和 ARRAY 的分隔符(数据分割符号)</span><br><span class="line">map keys terminated by &#x27;:&#x27;				          -- MAP中的key与value的分隔符</span><br><span class="line">lines terminated by &#x27;\n&#x27;;					      -- 行分隔符</span><br></pre></td></tr></table></figure>

<h5 id="4-导入文本数据到测试表"><a href="#4-导入文本数据到测试表" class="headerlink" title="(4)导入文本数据到测试表"></a>(4)导入文本数据到测试表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#x27;/opt/module/datas/text.txt&#x27; into table test;</span><br></pre></td></tr></table></figure>
<h5 id="5-访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式"><a href="#5-访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式" class="headerlink" title="(5)访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式"></a>(5)访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select friends[1],children[&#x27;xiao song&#x27;],address.city from test where name=&quot;songsong&quot;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LWJkZDgzYzNiZjk5ZjM4NjUucG5n?x-oss-process=image/format,png"></p>
<p>如果起别名：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select friends[1] as pengyou from test where name=&quot;songsong&quot;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy80MzkxNDA3LTFmMWY3MDg3ZmFlMGQ3MTAucG5n?x-oss-process=image/format,png"></p>
<h4 id="3-类型转化"><a href="#3-类型转化" class="headerlink" title="3.类型转化"></a>3.类型转化</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Hive的原子数据类型是可以进行隐式转换的，类似于Java的类型转换，例如某表达式使用INT类型，TINYINT会自动转换为INT类型，但是Hive不会进行反向转化，例如，某表达式使用TINYINT类型，INT不会自动转换为TINYINT类型，它会返回错误，除非使用CAST操作。</p>
<h5 id="1-隐式类型转换规则如下。"><a href="#1-隐式类型转换规则如下。" class="headerlink" title="(1).隐式类型转换规则如下。"></a>(1).隐式类型转换规则如下。</h5><h6 id="a-任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成INT，INT可以转换成BIGINT。"><a href="#a-任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成INT，INT可以转换成BIGINT。" class="headerlink" title="(a)任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成INT，INT可以转换成BIGINT。"></a>(a)任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成INT，INT可以转换成BIGINT。</h6><h6 id="b-所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。"><a href="#b-所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。" class="headerlink" title="(b)所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。"></a>(b)所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。</h6><h6 id="c-TINYINT、SMALLINT、INT都可以转换为FLOAT。"><a href="#c-TINYINT、SMALLINT、INT都可以转换为FLOAT。" class="headerlink" title="(c )TINYINT、SMALLINT、INT都可以转换为FLOAT。"></a>(c )TINYINT、SMALLINT、INT都可以转换为FLOAT。</h6><h6 id="d-BOOLEAN类型不可以转换为任何其它的类型。"><a href="#d-BOOLEAN类型不可以转换为任何其它的类型。" class="headerlink" title="(d)BOOLEAN类型不可以转换为任何其它的类型。"></a>(d)BOOLEAN类型不可以转换为任何其它的类型。</h6><h5 id="2-可以使用CAST操作显示进行数据类型转换，"><a href="#2-可以使用CAST操作显示进行数据类型转换，" class="headerlink" title="(2).可以使用CAST操作显示进行数据类型转换，"></a>(2).可以使用CAST操作显示进行数据类型转换，</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;例如CAST(‘1’ AS INT)将把字符串’1’ 转换成整数1；如果强制类型转换失败，如执行CAST(‘X’ AS INT)，表达式返回空值 NULL。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/13/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/15/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> Movle
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="https://img-blog.csdnimg.cn/20200609161448519.jpg" alt="Movle"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>